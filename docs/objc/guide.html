<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Behavior Graph</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Behavior Graph</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_the_basics">The Basics</a>
<ul class="sectlevel2">
<li><a href="#_login_button">Login button</a></li>
<li><a href="#_a_behavior_is_a_unit_of_functionality">A behavior is a unit of functionality</a></li>
<li><a href="#_a_resource_is_a_unit_of_state">A resource is a unit of state</a></li>
<li><a href="#_extents_are_collections_of_related_behaviors_and_resources">Extents are collections of related behaviors and resources</a></li>
<li><a href="#_bgstate_resources_retain_information">BGState resources retain information</a></li>
<li><a href="#_demands_are_the_resources_a_behavior_depends_on">Demands are the resources a behavior depends on</a></li>
<li><a href="#_input_happens_via_actions">Input happens via actions</a></li>
<li><a href="#_updating_a_resource_causes_its_demanding_behaviors_to_be_activated">Updating a resource causes its demanding behaviors to be activated</a></li>
<li><a href="#_the_next_activated_behavior_will_run_after_the_current_action_or_behavior_completes">The next activated behavior will run after the current action or behavior completes</a></li>
<li><a href="#_side_effects_create_output_in_the_environment">Side effects create output in the environment</a></li>
<li><a href="#_behavior_graph_is_a_graph">Behavior Graph is a graph</a></li>
<li><a href="#_there_is_a_graph_instance">There is a graph instance</a></li>
<li><a href="#_an_event_is_a_single_run_through_the_graph">An Event is a single run through the graph</a></li>
</ul>
</li>
<li><a href="#_getting_deeper">Getting Deeper</a>
<ul class="sectlevel2">
<li><a href="#_complete_login_page_example">Complete login page example</a></li>
<li><a href="#_behaviors_are_units_of_state_management">Behaviors are units of state management</a></li>
<li><a href="#_resource_updates_activate_behaviors">Resource updates activate behaviors</a></li>
<li><a href="#_updates_filter_for_equality">Updates filter for equality</a></li>
<li><a href="#_moment_resources_capture_transient_knowledge">Moment resources capture transient knowledge</a></li>
<li><a href="#_moments_activate_behaviors_when_they_happen">Moments activate behaviors when they happen</a></li>
<li><a href="#_state_changes_can_be_queried">State changes can be queried</a></li>
<li><a href="#_updates_activate_behaviors">Updates activate behaviors</a></li>
<li><a href="#_updates_can_only_come_from_actions_or_behaviors">Updates can only come from actions or behaviors</a></li>
</ul>
</li>
<li><a href="#_how_it_works">How it Works</a>
<ul class="sectlevel2">
<li><a href="#_behavior_graph_is_a_bipartite_directed_acyclic_graph">Behavior Graph is a bipartite directed acyclic graph</a></li>
<li><a href="#_behavior_graph_runs_code_in_the_correct_order">Behavior Graph runs code in the correct order</a></li>
<li><a href="#_graph_cycles_are_not_permitted">Graph cycles are not permitted</a></li>
</ul>
</li>
<li><a href="#_fixing_problems">Fixing Problems</a>
<ul class="sectlevel2">
<li><a href="#_state_resources_have_trace_values">State resources have trace values</a></li>
<li><a href="#_use_the_debug_console_to_track_down_cycles">Use the debug console to track down cycles</a></li>
<li><a href="#_complex_behaviors_can_make_it_easier_to_create_cycles">Complex behaviors can make it easier to create cycles</a></li>
<li><a href="#_side_effect_blocks_run_after_all_behaviors">Side effect blocks run after all behaviors</a></li>
<li><a href="#_side_effect_blocks_are_run_in_the_order_they_are_created">Side effect blocks are run in the order they are created</a></li>
<li><a href="#_events_are_serialized">Events are serialized</a></li>
<li><a href="#_events_are_synchronized_onto_the_same_thread">Events are synchronized onto the same thread</a></li>
<li><a href="#_actions_blocks_are_run_synchronously">Actions blocks are run synchronously</a></li>
<li><a href="#_side_effects_cant_be_strictly_enforced">Side effects can&#8217;t be strictly enforced</a></li>
<li><a href="#_action_blocks_can_have_optional_synchrony_but_not_the_default">Action blocks can have optional synchrony (but not the default)</a></li>
<li><a href="#_events_have_sequence_numbers">Events have sequence numbers</a></li>
<li><a href="#_events_have_timestamps">Events have timestamps</a></li>
</ul>
</li>
<li><a href="#_architecting_systems">Architecting Systems</a>
<ul class="sectlevel2">
<li><a href="#_video_chat_example">Video Chat Example</a></li>
<li><a href="#_extents_capture_lifetimes">Extents capture lifetimes</a></li>
<li><a href="#_extents_exclusively_own_behaviors_and_resources">Extents exclusively own behaviors and resources</a></li>
<li><a href="#_resources_are_named_and_assigned_to_extent_member_variables">Resources are named and assigned to extent member variables</a></li>
<li><a href="#_behaviors_are_typically_unnamed">Behaviors are typically unnamed</a></li>
<li><a href="#_behaviors_and_resources_are_added_to_and_removed_from_a_graph_via_extents">Behaviors and resources are added to and removed from a graph via extents</a></li>
<li><a href="#_behaviors_always_activate_in_the_same_event_that_their_extent_is_added_to_a_graph">Behaviors always activate in the same event that their extent is added to a graph</a></li>
<li><a href="#_extents_are_the_execution_context_for_behaviors_and_sideeffects">Extents are the execution context for behaviors and sideEffects</a></li>
<li><a href="#_resources_and_behaviors_can_link_across_extents">Resources and behaviors can link across extents</a></li>
<li><a href="#_store_related_extents_in_a_collection_resource">Store related extents in a collection resource</a></li>
<li><a href="#_relink_behaviors_dynamically">Relink behaviors dynamically</a></li>
<li><a href="#_supplies_can_also_be_relinked_dynamically">Supplies can also be relinked dynamically</a></li>
<li><a href="#_updating_links_will_cause_dependent_behaviors_to_activate">Updating links will cause dependent behaviors to activate</a></li>
<li><a href="#_removed_resources_and_behaviors_are_automatically_removed_from_demands_and_supplies">Removed resources and behaviors are automatically removed from demands and supplies</a></li>
<li><a href="#_removed_behaviors_will_not_run_in_the_event_they_are_removed">Removed behaviors will not run in the event they are removed</a></li>
<li><a href="#_a_program_may_have_multiple_instances_of_a_graph">A program may have multiple instances of a graph</a></li>
<li><a href="#_independent_graphs_may_communicate_through_message_passing">Independent graphs may communicate through message passing</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_the_basics"><a class="link" href="#_the_basics">The Basics</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_login_button"><a class="link" href="#_login_button">Login button</a></h3>
<div id="login_example1" class="exampleblock">
<div class="title">Example 1. Login page example</div>
<div class="content">
<div class="paragraph">
<p>Our first example implements a standard login page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/login_ui.png" alt="Login Page">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A login button should be enabled if a valid email and password have been entered.</p>
</li>
<li>
<p>A valid email has standard email formatting.</p>
</li>
<li>
<p>A valid password is non-empty.</p>
</li>
<li>
<p>As the user types into those fields, the enabled state of the login button will update automatically.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_a_behavior_is_a_unit_of_functionality"><a class="link" href="#_a_behavior_is_a_unit_of_functionality">A behavior is a unit of functionality</a></h3>
<div class="paragraph">
<p><strong>Behaviors</strong> are the fundamental unit of composition when using Behavior Graph.
They are blocks of code along with the dependency relationships they are involved in.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Here is the behavior that implements our <a href="#login_example1">Login page example</a>.
It gets run whenever the email and password fields change.
It validates those fields and updates the enabled state of the login button accordingly.</p>
</div>
<div id="login_behavior" class="listingblock">
<div class="title">Login behavior</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
</pre></td><td class="code"><pre><span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">self</span><span class="p">.</span><span class="n">email</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">password</span><span class="p">]</span>
                 <span class="nl">supplies:</span><span class="nb">nil</span>
                 <span class="nl">runBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">NSString</span> <span class="o">*</span><span class="n">email</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">email</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">password</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">password</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="n">BOOL</span> <span class="n">hasPassword</span> <span class="o">=</span> <span class="n">password</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">BOOL</span> <span class="n">loginEnabled</span> <span class="o">=</span> <span class="p">[</span><span class="n">extent</span> <span class="nf">validEmailAddress</span><span class="p">:</span><span class="n">email</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">hasPassword</span><span class="p">;</span>
    <span class="p">[</span><span class="n">extent</span> <span class="nf">sideEffect</span><span class="p">:</span><span class="s">@"enable login button"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">extent</span><span class="p">.</span><span class="n">login</span><span class="p">.</span><span class="n">loginButton</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">loginEnabled</span><span class="p">;</span>
    <span class="p">}];</span>

<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The bulk of your code will comprise of many behaviors similar to this one.
Without worrying too much about some unfamiliar details, keep in mind that code inside a behavior is normal code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Conventional programming constructs: property access, method calls, and boolean expressions.</p>
</li>
<li>
<p>Platform standard API calls for interacting with the environment</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_a_resource_is_a_unit_of_state"><a class="link" href="#_a_resource_is_a_unit_of_state">A resource is a unit of state</a></h3>
<div class="paragraph">
<p><strong>Resources</strong> carry state in a controlled manner.
Resources store information about the system you are modeling.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">Login behavior</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
</pre></td><td class="code"><pre><span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">self</span><span class="p">.</span><span class="n">email</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">password</span><span class="p">]</span>
                 <span class="nl">supplies:</span><span class="nb">nil</span>
                 <span class="nl">runBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">NSString</span> <span class="o">*</span><span class="n">email</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">email</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">password</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">password</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="n">BOOL</span> <span class="n">hasPassword</span> <span class="o">=</span> <span class="n">password</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">BOOL</span> <span class="n">loginEnabled</span> <span class="o">=</span> <span class="p">[</span><span class="n">extent</span> <span class="nf">validEmailAddress</span><span class="p">:</span><span class="n">email</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">hasPassword</span><span class="p">;</span>
    <span class="p">[</span><span class="n">extent</span> <span class="nf">sideEffect</span><span class="p">:</span><span class="s">@"enable login button"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">extent</span><span class="p">.</span><span class="n">login</span><span class="p">.</span><span class="n">loginButton</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">loginEnabled</span><span class="p">;</span>
    <span class="p">}];</span>

<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Line 1 of  references the <code>email</code> and <code>password</code> properties.
These are both resources.</p>
</li>
<li>
<p>Lines 5 and 6 access the same properties via the <code>extent</code> object passed into the block.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>email</code> contains the current textual content of the email UI element.
<code>password</code> plays a similar role.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extents_are_collections_of_related_behaviors_and_resources"><a class="link" href="#_extents_are_collections_of_related_behaviors_and_resources">Extents are collections of related behaviors and resources</a></h3>
<div class="paragraph">
<p><strong>Extents</strong> are specialized containers for behaviors and resources.
You must subclass <code>BGExtent</code>.
On your subclass:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Define resources as properties.</p>
</li>
<li>
<p>Initialize resources in the initializer.</p>
</li>
<li>
<p>Create behaviors in the initializer.</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><a href="#login_example1">Login page example</a> needs only a single extent, <code>LoginExtent</code>.
<code>email</code> and <code>password</code> are defined as properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="k">@class</span> <span class="nc">LoginExtent</span><span class="p">;</span>
<span class="k">@interface</span> <span class="nc">LoginExtent</span> <span class="p">:</span> <span class="nc">BGExtent</span><span class="o">&lt;</span><span class="n">LoginExtent</span><span class="o">*&gt;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">BGState</span><span class="o">&lt;</span><span class="n">NSString</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="n">email</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">BGState</span><span class="o">&lt;</span><span class="n">NSString</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="n">password</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>BGState</code> is a resource subtype for retaining state.
Here they are specialized on the type <code>NSString</code> for holding the contents of their respective text fields.
Inside the initializer we create the graph elements</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre><span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithGraph</span><span class="p">:(</span><span class="n">BGGraph</span> <span class="o">*</span><span class="p">)</span><span class="nv">graph</span> <span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">initWithGraph</span><span class="p">:</span><span class="n">graph</span><span class="p">];</span>

    <span class="n">_email</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">stateWithValue</span><span class="p">:</span><span class="s">@""</span><span class="p">];</span>
    <span class="n">_password</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">stateWithValue</span><span class="p">:</span><span class="s">@""</span><span class="p">];</span>

    <span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">self</span><span class="p">.</span><span class="n">email</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">password</span><span class="p">]</span>
                     <span class="nl">supplies:</span><span class="nb">nil</span>
                     <span class="nl">runBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Remember to specify your <code>BGExtent</code> subclass with the generic parameter as the subclass itself.
This unusual syntax is an instance of the <a href="https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern">curiously recurring template pattern</a>.
It is a known technique which lets us be more precise with our types without having to override some common methods, specifically <code>behaviorWithDemands:</code> and <code>sideEffect:</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_bgstate_resources_retain_information"><a class="link" href="#_bgstate_resources_retain_information">BGState resources retain information</a></h3>
<div class="paragraph">
<p><code>BGState</code> is a type of resource.
It is generic on the type of its contents.</p>
</div>
<div class="paragraph">
<p>Initial contents are supplied in the initializer.</p>
</div>
<div class="paragraph">
<p>Use the <code>value</code> property to access its contents.</p>
</div>
<div class="paragraph">
<p>Calling <code>updateValue:</code> on it will update those contents.
The contents will remain the same until <code>updateValue:</code> is called again with different information.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Objective-C "implements" generics with pointer types.
Therefore storing native types such as booleans and numbers in instances of <code>BGState</code> requires the use of Objective-C&#8217;s boxed types such as <code>NSNumber</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_demands_are_the_resources_a_behavior_depends_on"><a class="link" href="#_demands_are_the_resources_a_behavior_depends_on">Demands are the resources a behavior depends on</a></h3>
<div class="paragraph">
<p>A behavior has read-only access to a set of resources it depends on called <strong>demands</strong>.
Behavior Graph uses this dependency information to run the behavior at the correct time.</p>
</div>
<div class="paragraph">
<p>You must explicitly set the demands on a behavior either when creating a behavior or via the <code>setDemands</code> method.</p>
</div>
<div class="paragraph">
<p>Accessing the <code>value</code> property from inside a behavior without specifying it as a demand will raise an error.</p>
</div>
<div class="paragraph">
<p>Calling <code>updateValue:</code> on a demanded resource will also raise an error.
It is read-only.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>In order to determine if the login button should be enabled, our login behavior needs access the information stored in the <code>email</code> and <code>password</code> resources.</p>
</div>
<div class="listingblock">
<div class="title">Login behavior</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
</pre></td><td class="code"><pre><span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">self</span><span class="p">.</span><span class="n">email</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">password</span><span class="p">]</span>
                 <span class="nl">supplies:</span><span class="nb">nil</span>
                 <span class="nl">runBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">NSString</span> <span class="o">*</span><span class="n">email</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">email</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">password</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">password</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="n">BOOL</span> <span class="n">hasPassword</span> <span class="o">=</span> <span class="n">password</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">BOOL</span> <span class="n">loginEnabled</span> <span class="o">=</span> <span class="p">[</span><span class="n">extent</span> <span class="nf">validEmailAddress</span><span class="p">:</span><span class="n">email</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">hasPassword</span><span class="p">;</span>
    <span class="p">[</span><span class="n">extent</span> <span class="nf">sideEffect</span><span class="p">:</span><span class="s">@"enable login button"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">extent</span><span class="p">.</span><span class="n">login</span><span class="p">.</span><span class="n">loginButton</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">loginEnabled</span><span class="p">;</span>
    <span class="p">}];</span>

<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Line 1 initializes the behavior with an array containing these resources as demands.</p>
</li>
<li>
<p>Lines 5 and 6 are able to access the stored contents of <code>email</code> and <code>password</code> via the <code>value</code> property.
This is because they are listed as demands in line 1.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_input_happens_via_actions"><a class="link" href="#_input_happens_via_actions">Input happens via actions</a></h3>
<div class="paragraph">
<p>The <strong>environment</strong> is everything that is not part of your Behavior Graph subsystem.
In order to track changes to that environment, you program must create new <strong>actions</strong> via the <code>action</code> method on the graph object.
Inside that you are able to update the contents of resources.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>As the user types into the email and password fields, we want our program to react by updating the enabled state of the login button.
Those UI fields are part of the environment.
So we write handlers for those fields which will create new actions as those fields change.</p>
</div>
<div id="login_actions" class="listingblock">
<div class="title">Login actions</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
</pre></td><td class="code"><pre><span class="k">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="nf">didUpdateEmailField</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">graph</span> <span class="nf">action</span><span class="p">:</span><span class="s">@"update email"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loginExtent</span><span class="p">.</span><span class="n">email</span> <span class="nf">updateValue</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">emailField</span><span class="p">.</span><span class="n">text</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="nf">didUpdatePasswordField</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">graph</span> <span class="nf">action</span><span class="p">:</span><span class="s">@"update password"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loginExtent</span><span class="p">.</span><span class="n">password</span> <span class="nf">updateValue</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">passwordField</span><span class="p">.</span><span class="n">text</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Line 1 is a typical callback method that is called from the UI framework when the email text field is updated.</p>
</li>
<li>
<p>Line 2 creates a new action block.</p>
</li>
<li>
<p>Line 3 updates the contents of the <code>email</code> resource using the <code>updateValue:</code> method.
This is the same resource instance that is accessed in <a href="#login_behavior">Login behavior</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Action blocks are initialized with an optional string called the <strong>impulse</strong>.
The impulse is a debugging aid to help answer the question, "why is this happening?".
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_updating_a_resource_causes_its_demanding_behaviors_to_be_activated"><a class="link" href="#_updating_a_resource_causes_its_demanding_behaviors_to_be_activated">Updating a resource causes its demanding behaviors to be activated</a></h3>
<div class="paragraph">
<p>Calling <code>updateValue:</code> on a resource will change the information stored in that resource.
When the value changes, any behavior that demands that resource will be <strong>activated</strong>.
Activated behaviors are put into an internal queue to run in the correct order.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Each time the user types characters into the email field, the <code>didUpdateEmailField</code> will run, creating a new action block.</p>
</li>
<li>
<p>When that action block runs, the <code>email</code> resource will update to contain the current contents of the email field.</p>
</li>
<li>
<p>The <a href="#login_behavior">Login behavior</a> demands the <code>email</code> resource, so it activates.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_next_activated_behavior_will_run_after_the_current_action_or_behavior_completes"><a class="link" href="#_the_next_activated_behavior_will_run_after_the_current_action_or_behavior_completes">The next activated behavior will run after the current action or behavior completes</a></h3>
<div class="paragraph">
<p>After the current action or behavior block completes, the Behavior Graph will check if any there are any activated behaviors on its internal queue.
If so it will remove the top one from the queue and run it.
This will continue until there are no more activated behaviors on the queue.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>After the action block completes in <a href="#login_actions">Login actions</a>, the activated behavior <a href="#login_behavior">Login behavior</a> will run.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_side_effects_create_output_in_the_environment"><a class="link" href="#_side_effects_create_output_in_the_environment">Side effects create output in the environment</a></h3>
<div class="paragraph">
<p>While a behavior is running, it may determine that changing circumstances warrant a reaction in the environment.
Create this mechanism for output by calling <code>sideEffect:</code> on the current extent.</p>
</div>
<div class="paragraph">
<p>All interactions with the environment that do something should happen through <strong>side effects</strong>.
This lets the Behavior Graph runtime postpone changes to the environment until after any state changes.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">Login behavior</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
</pre></td><td class="code"><pre><span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">self</span><span class="p">.</span><span class="n">email</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">password</span><span class="p">]</span>
                 <span class="nl">supplies:</span><span class="nb">nil</span>
                 <span class="nl">runBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">NSString</span> <span class="o">*</span><span class="n">email</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">email</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">password</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">password</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="n">BOOL</span> <span class="n">hasPassword</span> <span class="o">=</span> <span class="n">password</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">BOOL</span> <span class="n">loginEnabled</span> <span class="o">=</span> <span class="p">[</span><span class="n">extent</span> <span class="nf">validEmailAddress</span><span class="p">:</span><span class="n">email</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">hasPassword</span><span class="p">;</span>
    <span class="p">[</span><span class="n">extent</span> <span class="nf">sideEffect</span><span class="p">:</span><span class="s">@"enable login button"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">extent</span><span class="p">.</span><span class="n">login</span><span class="p">.</span><span class="n">loginButton</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">loginEnabled</span><span class="p">;</span>
    <span class="p">}];</span>

<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Line 10 creates a side effect.</p>
</li>
<li>
<p>The next line updates the <code>enabled</code> state of the UI element by making a call directly to the platform user interface API.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The string parameter to <code>sideEffect:</code> is an aid for debugging.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_behavior_graph_is_a_graph"><a class="link" href="#_behavior_graph_is_a_graph">Behavior Graph is a graph</a></h3>
<div class="paragraph">
<p><strong>Behavior Graph diagrams</strong> provide a compact visual overview of the elements involved in your system.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>With our actions, resources, behavior, and side effect, <a href="#login_example1">Login page example</a> takes on the distinctive characteristics of a graph.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/login_simple_diagram.png" alt="Login Diagram">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>email</code> and <code>password</code> rectangles are resources.</p>
</li>
<li>
<p>The dashed boxes around them are actions.</p>
</li>
<li>
<p>The dashed box around <code>enable login button</code> is a side effect.</p>
</li>
<li>
<p>The solid box around it is the behavior.
That behavior demands those resources as indicated by the connecting lines.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_there_is_a_graph_instance"><a class="link" href="#_there_is_a_graph_instance">There is a graph instance</a></h3>
<div class="paragraph">
<p>A program will need at least one instance of <code>BGGraph</code>.
This object connects all behaviors, resources, and extents involved in your system.
It is responsible for running behavior code blocks in the correct order and ensuring relationships are valid.</p>
</div>
<div class="paragraph">
<p>Create a single instance of <code>BGGraph</code> and make it available to any object which will work with Behavior Graph code.
Then add your extent instances inside an action and the <code>addToGraph</code> method.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>In the root application code, we create an instance of the <code>LoginExtent</code> and add it to our graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="n">_graph</span> <span class="o">=</span> <span class="p">[[</span><span class="n">BGGraph</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
<span class="n">_loginExtent</span> <span class="o">=</span> <span class="p">[[</span><span class="n">LoginExtent</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithGraph</span><span class="p">:</span><span class="n">_graph</span><span class="p">];</span>
<span class="p">[</span><span class="n">_graph</span> <span class="nf">action</span><span class="p">:</span><span class="s">@"new login page"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loginExtent</span> <span class="nf">addToGraph</span><span class="p">];</span>
<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Line 2 creates a new action on this graph object inside which we add our <code>LoginExtent</code> instance.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_an_event_is_a_single_run_through_the_graph"><a class="link" href="#_an_event_is_a_single_run_through_the_graph">An Event is a single run through the graph</a></h3>
<div class="paragraph">
<p>An <strong>event</strong> begins with the running of an action block.
The behavior graph will continue to run activated behaviors until there are none left.
It will then run side effects in the order they were created.
When there are no remaining side effects, the event will complete.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Assume the user has just typed a character into the email text field which now contains the letters "sal":</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>didUpdateEmailField</code> method is called, which creates a new action.</p>
</li>
<li>
<p>The graph object will run the action block.</p>
</li>
<li>
<p>Inside the action block the <code>email</code> resource is updated to contain the string "sal"/</p>
</li>
<li>
<p>The updated resource activates the login behavior.</p>
</li>
<li>
<p>The action block completes.</p>
</li>
<li>
<p>The graph object sees only one behavior has been activated and runs it.</p>
</li>
<li>
<p>The behavior code block runs, determines email is invalid and creates a side effect to disable the login button.</p>
</li>
<li>
<p>The behavior code block completes.</p>
</li>
<li>
<p>With no more activated behaviors, the graph object runs the only side effect.</p>
</li>
<li>
<p>The side effect block runs the code to disable the login button.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This is all part of a single event.
When the user types an additional character a new event will run.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_deeper"><a class="link" href="#_getting_deeper">Getting Deeper</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_complete_login_page_example"><a class="link" href="#_complete_login_page_example">Complete login page example</a></h3>
<div id="login_example2" class="exampleblock">
<div class="title">Example 2. Complete login page</div>
<div class="content">
<div class="paragraph">
<p>We can extend our prior example to include the asynchronous interactions for logging in.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/login_ui_complete.png" alt="Complete login page">
</div>
</div>
<div class="paragraph">
<p>This Behavior Graph diagram includes the additional elements and relationships to support the following additional features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clicking on the login button, when enabled, will make a remote API call with the user&#8217;s credentials.</p>
</li>
<li>
<p>While the login API call is being made the button will disable.</p>
</li>
<li>
<p>Tapping the return key will also initiate a login.</p>
</li>
<li>
<p>Tapping the return key while the login button is disabled will not login.</p>
</li>
<li>
<p>If the API call returns an error, the login button will reenable.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_behaviors_are_units_of_state_management"><a class="link" href="#_behaviors_are_units_of_state_management">Behaviors are units of state management</a></h3>
<div class="paragraph">
<p>The most common role of a behavior is to synthesize new information based on its demands.</p>
</div>
<div class="paragraph">
<p>It stores this information in resources called it&#8217;s <strong>supplies</strong>.
These are resources to which it has read-write access.</p>
</div>
<div class="paragraph">
<p>A behavior can call <code>updateValue:</code> and access the <code>value</code> property on any resource that it supplies.</p>
</div>
<div class="paragraph">
<p>A behavior can supply any number of resources.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>This behavior reacts to changes to the email text field by updating its <code>emailValid</code> resource based on the contents of the <code>email</code> resource.</p>
</div>
<div id="login_email_valid" class="listingblock">
<div class="title">Login email valid</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
</pre></td><td class="code"><pre><span class="n">_emailValid</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">stateWithValue</span><span class="p">:</span><span class="nb">@NO</span><span class="p">];</span>
<span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">self</span><span class="p">.</span><span class="n">email</span><span class="p">]</span>
                 <span class="nl">supplies:</span><span class="p">@[</span><span class="n">self</span><span class="p">.</span><span class="n">emailValid</span><span class="p">]</span>
                 <span class="nl">runBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">NSString</span> <span class="o">*</span><span class="n">email</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">email</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="n">BOOL</span> <span class="n">emailValid</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">validEmailAddress</span><span class="p">:</span><span class="n">email</span><span class="p">];</span>
    <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">emailValid</span> <span class="nf">updateValue</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="n">emailValid</span><span class="p">)];</span>

<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Line 1 initializes the <code>emailValid</code> resource, a <code>BGState</code> resource on the <code>LoginExtent</code> object.
Its initial value is <code>@NO</code>.</p>
</li>
<li>
<p>The behaviorWithDemands: method includes <code>emailValid</code> in its list of supplied resources in its second parameter.</p>
</li>
<li>
<p>Line 8 calls <code>updateValue:</code> to update the contents of <code>emailValid</code>.
Note that we use <code>@(emailValid)</code> to provide the boxed <code>NSNumber*</code> form of the boolean value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>passwordValid</code> receives a similar treatment.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resource_updates_activate_behaviors"><a class="link" href="#_resource_updates_activate_behaviors">Resource updates activate behaviors</a></h3>
<div class="paragraph">
<p>The primary reason a behavior runs during any given event is that one or more of its demanded resources has updated.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>As the user types into the email text field, the <code>email</code> resource updates.
When it updates, the behavior that supplies <code>emailValid</code> activates.
It will be run during the same event.</p>
</div>
<div class="paragraph">
<p>The similar behavior that supplies <code>passwordValid</code> will not activate during this event.
Therefore it will not run.
This is because the <code>password</code> resource did not update.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_updates_filter_for_equality"><a class="link" href="#_updates_filter_for_equality">Updates filter for equality</a></h3>
<div class="paragraph">
<p><code>updateValue:</code> changes the contents of a resource if the new value does not equal the current value.
If the contents are the same, say updating from <code>@NO</code> to <code>@NO</code>, then this version of <code>updateValue:</code> does nothing.
Therefore no demanding behavior will activate.
Behavior Graph uses the standard platform equality check inside <code>updateValue:</code>.</p>
</div>
<div class="paragraph">
<p>There is also a <code>updateValueForce</code> method which will always register as an update without doing an internal equality check.
Using this, any demanding behaviors will always be activated.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">Login email valid</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
</pre></td><td class="code"><pre><span class="n">_emailValid</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">stateWithValue</span><span class="p">:</span><span class="nb">@NO</span><span class="p">];</span>
<span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">self</span><span class="p">.</span><span class="n">email</span><span class="p">]</span>
                 <span class="nl">supplies:</span><span class="p">@[</span><span class="n">self</span><span class="p">.</span><span class="n">emailValid</span><span class="p">]</span>
                 <span class="nl">runBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">NSString</span> <span class="o">*</span><span class="n">email</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">email</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="n">BOOL</span> <span class="n">emailValid</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">validEmailAddress</span><span class="p">:</span><span class="n">email</span><span class="p">];</span>
    <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">emailValid</span> <span class="nf">updateValue</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="n">emailValid</span><span class="p">)];</span>

<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On line 1, the <code>emailValid</code> resource is initialized with <code>@NO</code>.
As the user begins to type into the email text field it will not be a valid email.</p>
</li>
<li>
<p>Line 8 calls <code>updateValue:</code> on <code>emailValid</code>. Setting it to <code>@NO</code> again will do nothing because we filter out the equality.
The login enabling behavior which demands this resource will not activate.</p>
</li>
<li>
<p>When the user finally types in a valid email, <code>emailValid</code> will change to <code>@YES</code>, which will activate and subsequently run the login enabling behavior.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Equality in programming is a nuanced topic, to say the least.
If the default method does not work for you, skip the equality check and perform your own.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_moment_resources_capture_transient_knowledge"><a class="link" href="#_moment_resources_capture_transient_knowledge">Moment resources capture transient knowledge</a></h3>
<div class="paragraph">
<p>In contrast to State resources, Moment resources capture information about what is happening only during the current event.
A button click or a key press are moments.</p>
</div>
<div class="paragraph">
<p>Moments are instances of <code>BGMoment</code>.</p>
</div>
<div class="paragraph">
<p>Calling <code>update</code> on a moment instance inside an action or supplying behavior will capture the idea that it happened.</p>
</div>
<div class="paragraph">
<p>Querying a moment&#8217;s <code>justUpdated</code> property will determine if the moment happened during the current event.</p>
</div>
<div class="paragraph">
<p>Some moments may contain no information beyond merely happening, such as a button click.
Other moments, such as a successful network response, may also have additional information that you will wish to capture.
A moment instance will be generic on the type of its contents.
Pass in this additional information as a parameter to the <code>update</code> method.
Query this information using the <code>value</code> property.</p>
</div>
<div class="paragraph">
<p>Moments are transient.
The contents are only available during the event that they happen.
They will be forgotten at the end of the event.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><code>loginClick</code> and <code>returnKey</code> are both moments that update when the user clicks on the button or taps the return key.
Neither has any additional contents.</p>
</div>
<div id="login_complete_click" class="listingblock">
<div class="title">Login click</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="k">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="nf">loginButtonClicked</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">graph</span> <span class="nf">action</span><span class="p">:</span><span class="s">@"login button"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loginExtent</span><span class="p">.</span><span class="n">loginClick</span> <span class="nf">update</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Behavior Graph diagrams show moments as resources with a cutout in the top right corner.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_moments_activate_behaviors_when_they_happen"><a class="link" href="#_moments_activate_behaviors_when_they_happen">Moments activate behaviors when they happen</a></h3>
<div class="paragraph">
<p>Similar to a state change in state resources, when a moment happens it is considered updated.
Any behaviors that demand it will activate.</p>
</div>
<div class="paragraph">
<p>Behaviors that demand moments will frequently check <code>justUpdated</code> to determine how to react during the current event.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>This behavior decides when to log in and updates the logging in state.
<code>loggingIn</code> is a state resource, while <code>loginComplete</code> captures the moment know our login API call has succeeded.</p>
</div>
<div id="login_login" class="listingblock">
<div class="title">Logging in behavior</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre><span class="n">_loginClick</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="n">_returnKey</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="n">_loginComplete</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">self</span><span class="p">.</span><span class="n">loginClick</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">returnKey</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">loginComplete</span><span class="p">]</span>
                 <span class="nl">supplies:</span><span class="p">@[</span><span class="n">self</span><span class="p">.</span><span class="n">loggingIn</span><span class="p">]</span>
                 <span class="nl">runBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">extent</span><span class="p">.</span><span class="n">loginClick</span><span class="p">.</span><span class="n">justUpdated</span> <span class="o">||</span> <span class="n">extent</span><span class="p">.</span><span class="n">returnKey</span><span class="p">.</span><span class="n">justUpdated</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="n">extent</span><span class="p">.</span><span class="n">loginEnabled</span><span class="p">.</span><span class="n">traceValue</span><span class="p">.</span><span class="n">boolValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Start login</span>
        <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">loggingIn</span> <span class="nf">updateValue</span><span class="p">:</span><span class="nb">@YES</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">extent</span><span class="p">.</span><span class="n">loginComplete</span><span class="p">.</span><span class="n">justUpdated</span> <span class="o">&amp;&amp;</span>
               <span class="n">extent</span><span class="p">.</span><span class="n">loggingIn</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">boolValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Complete login</span>
        <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">loggingIn</span> <span class="nf">updateValue</span><span class="p">:</span><span class="nb">@NO</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">([</span><span class="n">extent</span><span class="p">.</span><span class="n">loggingIn</span> <span class="nf">justUpdatedTo</span><span class="p">:</span><span class="nb">@YES</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">extent</span> <span class="nf">sideEffect</span><span class="p">:</span><span class="s">@"login api call"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">extent</span> <span class="nf">login</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">email</span><span class="p">.</span><span class="n">value</span> <span class="nf">password</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">password</span><span class="p">.</span><span class="n">value</span> <span class="n">complete</span><span class="o">:^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">extent</span> <span class="nf">action</span><span class="p">:</span><span class="s">@"login complete"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
                    <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">loginComplete</span> <span class="nf">updateValue</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="n">success</span><span class="p">)];</span>
                <span class="p">}];</span>
            <span class="p">}];</span>
        <span class="p">}];</span>
    <span class="p">}</span>

<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The first clause of the <code>if</code> statement responds to clicking the login button or pressing the return key to start the login API call.</p>
</li>
<li>
<p>The second clause responds to the completed network call, putting us in a logged in state.</p>
</li>
<li>
<p>Lastly if we have just entered the logging in state, we will initiate that API call.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_state_changes_can_be_queried"><a class="link" href="#_state_changes_can_be_queried">State changes can be queried</a></h3>
<div class="paragraph">
<p>State resources have a <code>justUpdated</code> property.
It is only true during the event in which a successful <code>updateValue:</code> occurs.</p>
</div>
<div class="paragraph">
<p>For more precision, there are also <code>justUpdatedTo:</code> and <code>justUpdatedTo:from:</code> methods.
This check can be done in the same behavior that supplies the resource or any behavior that demands it.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Line 11 of <a href="#login_login">Logging in behavior</a> updates the value of <code>loggingIn</code> to @YES when the user clicks the button or presses the return key.</p>
</li>
<li>
<p>Line 18 then checks that same resource via <code>justUpdatedTo:</code> in order to determine if the system should do the actual side effect of calling the login API method.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_updates_activate_behaviors"><a class="link" href="#_updates_activate_behaviors">Updates activate behaviors</a></h3>
<div class="paragraph">
<p>A typical behavior graph program will consist of many state and moment resources.
It is useful to be able to talk about the general idea behind "happening" or "changing".
This term is called <strong>updating</strong>.</p>
</div>
<div class="paragraph">
<p>When a resource updates, any behaviors that demand it will be activated.</p>
</div>
<div class="paragraph">
<p>Updates can only be checked for inside a behavior if that behavior demands or supplies that resource.
Doing otherwise is an error</p>
</div>
</div>
<div class="sect2">
<h3 id="_updates_can_only_come_from_actions_or_behaviors"><a class="link" href="#_updates_can_only_come_from_actions_or_behaviors">Updates can only come from actions or behaviors</a></h3>
<div class="paragraph">
<p>If the update comes from a behavior, that resource must be supplied by that behavior.
A resource may be supplied by <em>only one behavior</em>.</p>
</div>
<div class="paragraph">
<p>If a resource is not supplied by a behavior may it be updated inside an action.</p>
</div>
<div class="paragraph">
<p>These rules guarantee that a resource will be updated only once per event.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_it_works"><a class="link" href="#_how_it_works">How it Works</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_behavior_graph_is_a_bipartite_directed_acyclic_graph"><a class="link" href="#_behavior_graph_is_a_bipartite_directed_acyclic_graph">Behavior Graph is a bipartite directed acyclic graph</a></h3>
<div class="paragraph">
<p>The graph of the Behavior Graph contains two node types, resources and behaviors, making it a bipartite graph.</p>
</div>
<div class="paragraph">
<p>Edges are the links between resources and behaviors.</p>
</div>
<div id="graph_example" class="exampleblock">
<div class="title">Example 3. Graph example</div>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="../images/graph_example.png" alt="Graph example">
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Specifically this is a dataflow dependency graph which has a few simple rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resources can only point to (demanded by) behaviors</p>
</li>
<li>
<p>Behaviors can only point to (supply) resources</p>
</li>
<li>
<p>A resource can be demanded by any number of behaviors (B1 demands R2 and B2 demands R2)</p>
</li>
<li>
<p>A behavior can supply to 0 or more resources (B1 supplies R5 and R4)</p>
</li>
<li>
<p>A resource can be supplied by either:</p>
<div class="ulist">
<ul>
<li>
<p>0 behaviors (R1 has no supplier, therefore it is updated in an action)</p>
</li>
<li>
<p>1 behavior (R5 is supplied only by B1)</p>
</li>
</ul>
</div>
</li>
<li>
<p>No cycles are permitted</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These rules combine to guarantee that during any event, each behavior will be run no more than once, and each resource will update in at most one place.</p>
</div>
</div>
<div class="sect2">
<h3 id="_behavior_graph_runs_code_in_the_correct_order"><a class="link" href="#_behavior_graph_runs_code_in_the_correct_order">Behavior Graph runs code in the correct order</a></h3>
<div class="paragraph">
<p>The value proposition for the Behavior Graph comes down to letting the computer manage control flow.
Control flow means deciding what code should run next.</p>
</div>
<div class="paragraph">
<p>After completing an action or behavior, the Behavior Graph will select the next behavior off the queue to run.
However there may be multiple behaviors on that queue waiting to run.
Behavior Graph uses a priority queue based on the topological ordering of all the behaviors in the graph.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>We can see how this matters looking at <a href="#graph_example">Graph example</a>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When <strong>R1</strong> is updated, the graph knows that <strong>B1</strong> should be run next.</p>
</li>
<li>
<p>When <strong>R2</strong> is updated however, both <strong>B1</strong> and <strong>B2</strong> are activated.</p>
</li>
<li>
<p>The graph must run <strong>B1</strong> first because <strong>B1</strong> may update <strong>R5</strong> which is another demand of <strong>B2</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_graph_cycles_are_not_permitted"><a class="link" href="#_graph_cycles_are_not_permitted">Graph cycles are not permitted</a></h3>
<div class="paragraph">
<p>Behavior Graph will throw an error when a graph cycle is detected as extents are added to the graph.
However, cycles can be easy to create.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Referring to <a href="#login_login">Logging in behavior</a>, a potential cyclical error occurs with <code>returnKey</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pressing the return key, when login is enabled, should put the system in a logging in state.</p>
</li>
<li>
<p>When the system is in a logging in state, the login button should be disabled.</p>
</li>
<li>
<p>When login is disabled, the return key should no longer work.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The dependency chain for this looks like:
<code>returnKey &#8594; loggingIn behavior &#8594; loggingIn &#8594; loginEnabled behavior &#8594; loginEnabled &#8594; loggingIn behavior (cycle)</code></p>
</div>
<div class="paragraph">
<p>Our solution is to recognize that when pressing the return key, the system is not interested in what state <code>loginEnabled</code> will enter during that event, but what it was as the event begins.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pressing the return key should not try to log the user in again if loginEnabled is @NO.</p>
</li>
<li>
<p>If it is @YES then the user can log in at which point it will become @NO.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_fixing_problems"><a class="link" href="#_fixing_problems">Fixing Problems</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_state_resources_have_trace_values"><a class="link" href="#_state_resources_have_trace_values">State resources have trace values</a></h3>
<div class="paragraph">
<p>Use trace values to break cycles.</p>
</div>
<div class="paragraph">
<p>Calling <code>traceValue</code> on a state resource inside a behavior will return its contents as they are at the beginning of the event.
If at some point during the same event the contents change from an update, the <code>traceValue</code> will continue to return the value that it was before that update.</p>
</div>
<div class="paragraph">
<p>Accessing the <code>traceValue</code> of a resource does not require it to be listed in the demands list of the behavior.</p>
</div>
<div class="paragraph">
<p>It is important to remember that <code>traceValue</code> is different than the prior value.
It is only the prior value if it updated during this event.
After the event ends, <code>traceValue</code> and <code>value</code> will return the same contents.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">Logging in behavior</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre><span class="n">_loginClick</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="n">_returnKey</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="n">_loginComplete</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">self</span><span class="p">.</span><span class="n">loginClick</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">returnKey</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">loginComplete</span><span class="p">]</span>
                 <span class="nl">supplies:</span><span class="p">@[</span><span class="n">self</span><span class="p">.</span><span class="n">loggingIn</span><span class="p">]</span>
                 <span class="nl">runBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">extent</span><span class="p">.</span><span class="n">loginClick</span><span class="p">.</span><span class="n">justUpdated</span> <span class="o">||</span> <span class="n">extent</span><span class="p">.</span><span class="n">returnKey</span><span class="p">.</span><span class="n">justUpdated</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="n">extent</span><span class="p">.</span><span class="n">loginEnabled</span><span class="p">.</span><span class="n">traceValue</span><span class="p">.</span><span class="n">boolValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Start login</span>
        <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">loggingIn</span> <span class="nf">updateValue</span><span class="p">:</span><span class="nb">@YES</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">extent</span><span class="p">.</span><span class="n">loginComplete</span><span class="p">.</span><span class="n">justUpdated</span> <span class="o">&amp;&amp;</span>
               <span class="n">extent</span><span class="p">.</span><span class="n">loggingIn</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">boolValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Complete login</span>
        <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">loggingIn</span> <span class="nf">updateValue</span><span class="p">:</span><span class="nb">@NO</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">([</span><span class="n">extent</span><span class="p">.</span><span class="n">loggingIn</span> <span class="nf">justUpdatedTo</span><span class="p">:</span><span class="nb">@YES</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">extent</span> <span class="nf">sideEffect</span><span class="p">:</span><span class="s">@"login api call"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">extent</span> <span class="nf">login</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">email</span><span class="p">.</span><span class="n">value</span> <span class="nf">password</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">password</span><span class="p">.</span><span class="n">value</span> <span class="n">complete</span><span class="o">:^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">extent</span> <span class="nf">action</span><span class="p">:</span><span class="s">@"login complete"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
                    <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">loginComplete</span> <span class="nf">updateValue</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="n">success</span><span class="p">)];</span>
                <span class="p">}];</span>
            <span class="p">}];</span>
        <span class="p">}];</span>
    <span class="p">}</span>

<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Line 9 accesses <code>loginEnabled.traceValue</code> to prevent a potential cycle.
It is not listed in the demands and Behavior Graph will not throw an error.</p>
</div>
<div class="paragraph">
<p>The behavior graph diagram in <a href="#login_example2">Complete login page</a> renders the dependency between <code>loginEnabled</code> and the behavior that supplies <code>loggingIn</code> with a dotted line to show the connection.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>In Behavior Graph diagrams, trace value dependencies are drawn as a dotted line and point to the lower portion of the behavior to visually separate them from other dependencies.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_the_debug_console_to_track_down_cycles"><a class="link" href="#_use_the_debug_console_to_track_down_cycles">Use the debug console to track down cycles</a></h3>
<div class="paragraph">
<p>Cycles that span many behaviors and extents are not always obvious.
The console will print the sequence of behaviors and resources that create the cycle.
Use this information to help determine where the chain can be broken.</p>
</div>
<div class="paragraph">
<p>You can call <code>cycleStringForBehavior</code> on the instance of the BGGraph to print or step through these objects.</p>
</div>
</div>
<div class="sect2">
<h3 id="_complex_behaviors_can_make_it_easier_to_create_cycles"><a class="link" href="#_complex_behaviors_can_make_it_easier_to_create_cycles">Complex behaviors can make it easier to create cycles</a></h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Combining many different demands and supplies in the same behavior can be practical and sometimes necessary.
However, these behaviors also make it easier to create graph cycles during the development phase.
Separating out independent functionality into different behaviors can often free up cycles.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_side_effect_blocks_run_after_all_behaviors"><a class="link" href="#_side_effect_blocks_run_after_all_behaviors">Side effect blocks run after all behaviors</a></h3>
<div class="paragraph">
<p>Behaviors may create side effects.
By design, those side effects do not run until there are no more activated behaviors in the queue, ie the end of the event.</p>
</div>
<div class="exampleblock">
<div class="content">
<div id="login_complete_enable" class="listingblock">
<div class="title">Login Enable</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="n">_loginEnabled</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">stateWithValue</span><span class="p">:</span><span class="nb">@NO</span><span class="p">];</span>
<span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">self</span><span class="p">.</span><span class="n">emailValid</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">passwordValid</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">loggingIn</span><span class="p">]</span>
                 <span class="nl">supplies:</span><span class="p">@[</span><span class="n">self</span><span class="p">.</span><span class="n">loginEnabled</span><span class="p">]</span>
                 <span class="nl">runBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">BOOL</span> <span class="n">enabled</span> <span class="o">=</span> <span class="p">(</span><span class="n">extent</span><span class="p">.</span><span class="n">emailValid</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">boolValue</span> <span class="o">&amp;&amp;</span>
                    <span class="n">extent</span><span class="p">.</span><span class="n">passwordValid</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">boolValue</span> <span class="o">&amp;&amp;</span>
                    <span class="o">!</span><span class="n">extent</span><span class="p">.</span><span class="n">loggingIn</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">boolValue</span><span class="p">);</span>
    <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">loginEnabled</span> <span class="nf">updateValue</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="n">enabled</span><span class="p">)];</span>
    <span class="p">[</span><span class="n">extent</span> <span class="nf">sideEffect</span><span class="p">:</span><span class="s">@"enable login button"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">extent</span><span class="p">.</span><span class="n">login</span><span class="p">.</span><span class="n">loginButton</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">loginEnabled</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">boolValue</span><span class="p">;</span>
    <span class="p">}];</span>

<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>As can be seen from the <a href="#login_example2">Complete login page</a> diagram, this behavior has no downstream dependencies and will be the last to be run.
Line 10 creates a side effect which will not be run until after this behavior completes.</p>
</div>
<div class="paragraph">
<p>Likewise when the user clicks the login button the first time, the side effect on line 20 of <a href="#login_login">Logging in behavior</a> will also not be run until this behavior completes.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>The reason for postponing the running of side effects is to ensure that unstable information doesn&#8217;t leak out into the environment.
As a side effect block runs, Behavior Graph must relinquish control flow.
That code may call out to some external library which subsequently calls back in to read the current value of a resource.
If we were in the behavior phase of an event, any number of resources may still need updating to new values.
The resources in the system are only in a stable state after all activated behaviors have been run.</p>
</div>
</div>
<div class="sect2">
<h3 id="_side_effect_blocks_are_run_in_the_order_they_are_created"><a class="link" href="#_side_effect_blocks_are_run_in_the_order_they_are_created">Side effect blocks are run in the order they are created</a></h3>
<div class="paragraph">
<p>Most systems will need some ability to maintain sequential dependencies between the code run in side effects.
For example one behavior may create the side effect for initializing a video player.
A separate behavior may create a side effect which tells the video player to play.
It is necessary to ensure the video player is created before it is told to play.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>In <a href="#login_example2">Complete login page</a>, the login call will be made before the button is disabled when the user clicks the login button.
This is because the two behaviors that create those side effects will be run in that order.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>If your code has implicit dependencies between side effect blocks, you can make them explicit by creating a dependency between their creating behaviors.
Do this by creating a resource which is supplied by the behavior that creates the first side effect and demanded by the behavior that creates the second side effect.</p>
</div>
</div>
<div class="sect2">
<h3 id="_events_are_serialized"><a class="link" href="#_events_are_serialized">Events are serialized</a></h3>
<div class="paragraph">
<p>It is possible for an action to be created while another event is currently executing when a side effect block leads to a new action and there are still side effects remaining.
However, interrupting the current event to run another one could lead to inconsistent results.
It is necessary for the entire event to work as a single transaction.</p>
</div>
<div class="paragraph">
<p>When this happens:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The new action will be placed in a queue and the current event will continue to run any remaining side effects of current event at the action creation point.</p>
</li>
<li>
<p>When the current event completes, the newly queued up action will create an event and run until completion.</p>
</li>
<li>
<p>This will continue until there are no more queued actions, at which point the code will continue.</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">Logging in behavior</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="code"><pre><span class="n">_loginClick</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="n">_returnKey</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="n">_loginComplete</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">self</span><span class="p">.</span><span class="n">loginClick</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">returnKey</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">loginComplete</span><span class="p">]</span>
                 <span class="nl">supplies:</span><span class="p">@[</span><span class="n">self</span><span class="p">.</span><span class="n">loggingIn</span><span class="p">]</span>
                 <span class="nl">runBlock:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">extent</span><span class="p">.</span><span class="n">loginClick</span><span class="p">.</span><span class="n">justUpdated</span> <span class="o">||</span> <span class="n">extent</span><span class="p">.</span><span class="n">returnKey</span><span class="p">.</span><span class="n">justUpdated</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
        <span class="n">extent</span><span class="p">.</span><span class="n">loginEnabled</span><span class="p">.</span><span class="n">traceValue</span><span class="p">.</span><span class="n">boolValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Start login</span>
        <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">loggingIn</span> <span class="nf">updateValue</span><span class="p">:</span><span class="nb">@YES</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">extent</span><span class="p">.</span><span class="n">loginComplete</span><span class="p">.</span><span class="n">justUpdated</span> <span class="o">&amp;&amp;</span>
               <span class="n">extent</span><span class="p">.</span><span class="n">loggingIn</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">boolValue</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Complete login</span>
        <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">loggingIn</span> <span class="nf">updateValue</span><span class="p">:</span><span class="nb">@NO</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">([</span><span class="n">extent</span><span class="p">.</span><span class="n">loggingIn</span> <span class="nf">justUpdatedTo</span><span class="p">:</span><span class="nb">@YES</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">extent</span> <span class="nf">sideEffect</span><span class="p">:</span><span class="s">@"login api call"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">extent</span> <span class="nf">login</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">email</span><span class="p">.</span><span class="n">value</span> <span class="nf">password</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">password</span><span class="p">.</span><span class="n">value</span> <span class="n">complete</span><span class="o">:^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">extent</span> <span class="nf">action</span><span class="p">:</span><span class="s">@"login complete"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
                    <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">loginComplete</span> <span class="nf">updateValue</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="n">success</span><span class="p">)];</span>
                <span class="p">}];</span>
            <span class="p">}];</span>
        <span class="p">}];</span>
    <span class="p">}</span>

<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When the user clicks the login button, this behavior that logs the user in will activate and run.</p>
</li>
<li>
<p>Line 21 will be run during the side effect phase of the event.</p>
</li>
<li>
<p>It is possible this external <code>login</code> method may immediately call the completion block which will then create a new action on line 23.</p>
</li>
<li>
<p>The first event created by clicking the login button is still running. It needs to complete before running this new login complete action. So it will place the login complete action in the queue and continue to its next side effect which will disable the login button.</p>
</li>
<li>
<p>After running the remaining side effect, the first event will complete, and the code inside the action block created on line 23 will run.</p>
</li>
<li>
<p>This new event will run to completion.</p>
</li>
<li>
<p>Finally the stack from the initial side effect created on line 19 will complete and unwind.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_events_are_synchronized_onto_the_same_thread"><a class="link" href="#_events_are_synchronized_onto_the_same_thread">Events are synchronized onto the same thread</a></h3>
<div class="paragraph">
<p>Behavior Graph does not handle concurrency.
All events are serialized onto the same thread which can be specified when initializing the <code>BGGraph</code> object.</p>
</div>
</div>
<div class="sect2">
<h3 id="_actions_blocks_are_run_synchronously"><a class="link" href="#_actions_blocks_are_run_synchronously">Actions blocks are run synchronously</a></h3>
<div class="paragraph">
<p>When the environment creates a new action, that action block and the entire event will be run synchronously.
The line of code that follows the action will not be run until the event created by that action has run to completion.</p>
</div>
<div class="paragraph">
<p>This default matches imperative programming expectations.
If a line of code following the action block attempts to read the value of a resource, you can expect it to have been updated accordingly.
And all side effect blocks created as a result of that action will be run before that next line of code.</p>
</div>
<div class="paragraph">
<p>As mentioned previously, however, there may already be a running event or queued actions when a new action is created.
Many events may get run between the time an action is created and when its own corresponding event is run.
These events will all run to completion before the code that creates the action returns.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">Login click</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="k">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="nf">loginButtonClicked</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">graph</span> <span class="nf">action</span><span class="p">:</span><span class="s">@"login button"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">loginExtent</span><span class="p">.</span><span class="n">loginClick</span> <span class="nf">update</span><span class="p">];</span>
    <span class="p">}];</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This method creates a new action on line 2; however, we cannot guarantee that the code inside the action is run immediately.
The Behavior Graph does guarantee that all events will have completed before proceeding past line 4 and exiting this method.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_side_effects_cant_be_strictly_enforced"><a class="link" href="#_side_effects_cant_be_strictly_enforced">Side effects can&#8217;t be strictly enforced</a></h3>
<div class="paragraph">
<p>You should always create a side effect when you wish to output information to the environment.
However, strictly enforcing this policy would require wrapping every possible type of output.</p>
</div>
<div class="paragraph">
<p>Instead, the code in behavior blocks is normal imperative code.
Technically anything is possible.
In order to manage control flow, the Behavior Graph cannot handle a new synchronous action while still running behaviors during an event.</p>
</div>
<div class="paragraph">
<p>If, from inside a behavior (not side effect), you create a synchronous action or call some code that eventually leads to a synchronous action, Behavior Graph will raise an error.</p>
</div>
<div class="paragraph">
<p>Also, if, from inside a behavior (not side effect), you call some code that eventually leads to accessing a non-demanded resource, Behavior Graph will raise an error.</p>
</div>
<div class="paragraph">
<p>Instances of this error can be subtle.
Be careful when working with anything that may affect the environment directly from a behavior.
This includes memory allocation, destructors, exceptions, or any other impure code.</p>
</div>
</div>
<div class="sect2">
<h3 id="_action_blocks_can_have_optional_synchrony_but_not_the_default"><a class="link" href="#_action_blocks_can_have_optional_synchrony_but_not_the_default">Action blocks can have optional synchrony (but not the default)</a></h3>
<div class="paragraph">
<p>The safest way to create a new action is to opt out of synchrony.
To do this call <code>action:requireSync:NO</code>.</p>
</div>
<div class="paragraph">
<p>This method of creating a new action will run the action and associated event immediately if there are no events running currently.
Otherwise, it will put them on a queue to be run after the current event (and any additional queued actions) are run, returning up the call stack.</p>
</div>
<div class="paragraph">
<p>Prefer this variation whenever possible.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>A better implementation of the login side effect in <a href="#login_login">Logging in behavior</a> would opt out of synchrony.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="p">[</span><span class="n">extent</span> <span class="nf">sideEffect</span><span class="p">:</span><span class="s">@"login api call"</span> <span class="nf">block</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">LoginExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">extent</span> <span class="nf">login</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">email</span><span class="p">.</span><span class="n">value</span> <span class="nf">password</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">password</span><span class="p">.</span><span class="n">value</span> <span class="n">complete</span><span class="o">:^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">graph</span> <span class="nf">action</span><span class="p">:</span><span class="s">@"login complete"</span> <span class="nf">requireSync</span><span class="p">:</span><span class="nb">NO</span> <span class="n">runBlock</span><span class="o">:^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">loginComplete</span> <span class="nf">happen</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="n">success</span><span class="p">)];</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Line 4 uses the optional asynchronous form when creating a new action.
Opting out of synchrony here means the side effect created on line 1 will exit its call stack before starting the event associated with this new action.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_events_have_sequence_numbers"><a class="link" href="#_events_have_sequence_numbers">Events have sequence numbers</a></h3>
<div class="paragraph">
<p>When a resource is updated it retains a reference to the instance of <code>BGEvent</code> in which it was last updated.
These event instances have a monotonically increasing sequence number (every event run is +1 the prior event).
You can use these sequence numbers to compare multiple resources to determine the order they were updated.</p>
</div>
<div class="paragraph">
<p>If this <code>event</code> property is accessed inside a behavior its resource must be declared as a demand.
There is a corresponding <code>traceEvent</code> available if such a dependency creates a cycle.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>We can compare the timestamps of the <code>password</code> and <code>email</code> resources to see if one were updated more recently.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">emailChangedSincePassword</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">email</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">sequence</span> <span class="o">&gt;</span> <span class="n">self</span><span class="p">.</span><span class="n">password</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">sequence</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_events_have_timestamps"><a class="link" href="#_events_have_timestamps">Events have timestamps</a></h3>
<div class="paragraph">
<p>Each event also gets a timestamp when the event is run.</p>
</div>
<div class="paragraph">
<p>It is a common programing idiom to interweave code with timestamp parameters in order to facilitate testing and instrumentation.
By providing this information as part of each event, behaviors and side effects have easy access without the typical crosscutting burden.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>We can reference when the login happened in some security auditing code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre><span class="k">-</span> <span class="p">(</span><span class="n">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="n">loginCompletedWhen</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">loginComplete</span><span class="p">.</span><span class="n">event</span><span class="p">.</span><span class="n">timestamp</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For testing purposes you can mock out the date provider of the graph object in one place.
Override the <code>dateProvider</code> property with your own implementation of BGDateProvider.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architecting_systems"><a class="link" href="#_architecting_systems">Architecting Systems</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_video_chat_example"><a class="link" href="#_video_chat_example">Video Chat Example</a></h3>
<div class="paragraph">
<p>We will now change our example app to a hypothetical but familiar video chat experience.</p>
</div>
<div id="video_chat" class="exampleblock">
<div class="title">Example 4. Video chat</div>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="../images/video_chat_ui.png" alt="Video chat">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>There will be a grid of squares showing the live video feed for a number of participants.</p>
</li>
<li>
<p>Each participant will have a small button overlay for toggling their mute.</p>
</li>
<li>
<p>Each participant will have a small button overlay to pin that participant.</p>
</li>
<li>
<p>When a participant is pinned, that ui will appear larger than the others.</p>
</li>
<li>
<p>Only one participant can be pinned at the same time.
If there is already a pinned participant, tapping on the pin button of another will unpin the first and pin the new one.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Behavior Graph diagram for this functionality looks like this</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/video_chat_diagram.png" alt="Video Chat Diagram">
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extents_capture_lifetimes"><a class="link" href="#_extents_capture_lifetimes">Extents capture lifetimes</a></h3>
<div class="paragraph">
<p>Extents can come and go, reflecting the range of time they play a useful role in your system.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>In the <a href="#video_chat">Video chat</a> example, we will have two types of extents.</p>
</div>
<div class="paragraph">
<p>A single <code>ChatExtent</code> will be created and added to the graph every time we initiate a new chat.
It reflects the lifetime of the video chat.
Once the chat is over, it no longer plays a functioning roll and can be removed from the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="k">@class</span> <span class="nc">ChatExtent</span><span class="p">;</span>
<span class="k">@interface</span> <span class="nc">ChatExtent</span> <span class="p">:</span> <span class="nc">BGExtent</span><span class="o">&lt;</span><span class="n">ChatExtent</span><span class="o">*&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>A <code>ParticipantExtent</code> will be created each time a new participant joins the video chat.
Each chat may have multiple participants.
They may come and go at any time during the video chat.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="k">@class</span> <span class="nc">ParticipantExtent</span><span class="p">;</span>
<span class="k">@interface</span> <span class="nc">ParticipantExtent</span> <span class="p">:</span> <span class="nc">BGExtent</span><span class="o">&lt;</span><span class="n">ParticipantExtent</span><span class="o">*&gt;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extents_exclusively_own_behaviors_and_resources"><a class="link" href="#_extents_exclusively_own_behaviors_and_resources">Extents exclusively own behaviors and resources</a></h3>
<div class="paragraph">
<p>Behaviors and resources always belong to one and only one extent.</p>
</div>
<div class="paragraph">
<p>They do not exist independently from their owning extent.</p>
</div>
<div class="paragraph">
<p>You cannot create a resource on one extent and assign it to a member variable on another.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resources_are_named_and_assigned_to_extent_member_variables"><a class="link" href="#_resources_are_named_and_assigned_to_extent_member_variables">Resources are named and assigned to extent member variables</a></h3>
<div class="paragraph">
<p>You will regularly refer to resources by name via their extent.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Our mute functionality requires some resources which we declare as properties on the ParticipantExtent.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
2
</pre></td><td class="code"><pre><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">BGMoment</span> <span class="o">*</span><span class="n">muteTap</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">BGState</span><span class="o">&lt;</span><span class="n">NSNumber</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="n">muted</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>muteTap</code> is a moment resource that tracks the user tapping on the mute button.</p>
</li>
<li>
<p><code>muted</code> is a state resource that captures the local muted status of that participant.
It is an <code>NSNumber</code> to store our Objective-C boxed boolean.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will initialize and assign them in the constructor along with the behavior that links to them.</p>
</div>
<div id="participant_mute" class="listingblock">
<div class="title">Mute behavior</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
</pre></td><td class="code"><pre><span class="n">_muteTap</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="n">_muted</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">stateWithValue</span><span class="p">:</span><span class="nb">@NO</span><span class="p">];</span>
<span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">_muteTap</span><span class="p">]</span> <span class="nf">supplies</span><span class="p">:@[</span><span class="n">_muted</span><span class="p">]</span> <span class="n">runBlock</span><span class="o">:^</span><span class="p">(</span><span class="n">ParticipantExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">extent</span><span class="p">.</span><span class="n">muteTap</span><span class="p">.</span><span class="n">justUpdated</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">muted</span> <span class="nf">updateValue</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="o">!</span><span class="n">extent</span><span class="p">.</span><span class="n">muted</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">boolValue</span><span class="p">)];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">extent</span><span class="p">.</span><span class="n">muted</span><span class="p">.</span><span class="n">justUpdated</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">extent</span> <span class="nf">sideEffect</span><span class="p">:</span><span class="s">@"mute toggle"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">ParticipantExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">extent</span> <span class="nf">muteParticipant</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">muted</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">boolValue</span><span class="p">];</span>
                <span class="p">[</span><span class="n">extent</span> <span class="nf">updateMuteUI</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">muted</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">boolValue</span><span class="p">];</span>
            <span class="p">}];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>On line 3 we refer to their member variables directly when specifying the linked resources for this behavior.
On almost every line thereafter we refer to them by name via their extent.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_behaviors_are_typically_unnamed"><a class="link" href="#_behaviors_are_typically_unnamed">Behaviors are typically unnamed</a></h3>
<div class="paragraph">
<p>Initialize behaviors via the <code>BGExtent</code> factory method <code>behaviorWithDemands:</code>.</p>
</div>
<div class="paragraph">
<p>Behaviors can have their linked resources redefined dynamically.
You can optionally save the results of that method to a member variable if you wish to do this.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="n">_muteBehavior</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">_muteTap</span><span class="p">]</span> <span class="nf">supplies</span><span class="p">:@[</span><span class="n">_muted</span><span class="p">]</span> <span class="c1">//...</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_behaviors_and_resources_are_added_to_and_removed_from_a_graph_via_extents"><a class="link" href="#_behaviors_and_resources_are_added_to_and_removed_from_a_graph_via_extents">Behaviors and resources are added to and removed from a graph via extents</a></h3>
<div class="paragraph">
<p>Add behaviors and resources to the graph by adding their owning extent.
Use the <code>addToGraph</code> method of the extent object.</p>
</div>
<div class="paragraph">
<p>Adding and removing extents must happen during an event– either inside an action or behavior.
Doing otherwise will raise an error.</p>
</div>
<div class="paragraph">
<p>Behaviors which have not yet been added to the graph will not run.
Updating a resource which has not yet been added to the graph will raise an error.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>During a video chat, our system will need to handle participants joining and leaving.
We will model this by adding and removing instances of <code>ParticipantExtent</code> to the graph.</p>
</div>
<div class="paragraph">
<p>To capture this functionality, we will have a behavior that demands resources indicating that a participant has joined or left.
When these moments happen our behavior can either create and add the new extent or remove the old one.</p>
</div>
<div id="participants_add" class="listingblock">
<div class="title">Add participants</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="code"><pre><span class="n">_participantJoined</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="n">_participantDisconnected</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="n">_participants</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">stateWithValue</span><span class="p">:[</span><span class="n">NSMutableDictionary</span> <span class="nf">new</span><span class="p">]];</span>
<span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">_participantJoined</span><span class="p">,</span> <span class="n">_participantDisconnected</span><span class="p">]</span> <span class="nf">supplies</span><span class="p">:@[</span><span class="n">_participants</span><span class="p">]</span> <span class="n">runBlock</span><span class="o">:^</span><span class="p">(</span><span class="n">ChatExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">extent</span><span class="p">.</span><span class="n">participantJoined</span><span class="p">.</span><span class="n">justUpdated</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSString</span> <span class="o">*</span><span class="n">participantId</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">participantJoined</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
        <span class="n">ParticipantExtent</span> <span class="o">*</span><span class="n">participant</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ParticipantExtent</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithGraph</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">graph</span> <span class="nf">participantId</span><span class="p">:</span><span class="n">participantId</span> <span class="n">chat</span><span class="o">:</span><span class="n">extent</span><span class="p">];</span>
        <span class="p">[</span><span class="n">participant</span> <span class="nf">addToGraph</span><span class="p">];</span>
        <span class="n">extent</span><span class="p">.</span><span class="n">participants</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="nf">participantId</span><span class="p">]</span> <span class="o">=</span> <span class="n">participant</span><span class="p">;</span>
        <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">participants</span> <span class="nf">updateValueForce</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">participants</span><span class="p">.</span><span class="n">value</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">extent</span><span class="p">.</span><span class="n">participantDisconnected</span><span class="p">.</span><span class="n">justUpdated</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSString</span> <span class="o">*</span><span class="n">participantId</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">participantDisconnected</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
        <span class="n">ParticipantExtent</span> <span class="o">*</span><span class="n">participant</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">participants</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="nf">participantId</span><span class="p">];</span>
        <span class="p">[</span><span class="n">participant</span> <span class="nf">removeFromGraph</span><span class="p">];</span>
        <span class="n">extent</span><span class="p">.</span><span class="n">participants</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="nf">participantId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
        <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">participants</span> <span class="nf">updateValueForce</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">participants</span><span class="p">.</span><span class="n">value</span><span class="p">];</span>
    <span class="p">}</span>

<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each time a new participant joins our video chat, the moment resource <code>participantJoined</code> will update, activating this behavior.
In response we will create a new instance of <code>ParticipantExtent</code> on line 9.
We add it to the graph on the next line.</p>
</div>
<div class="paragraph">
<p>If the participant later disconnects we can remove it&#8217;s functionality from the graph.
Line 19 removes it from the graph.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Once an extent has been removed from the graph its elements will be removed and unlinked from any other elements still in the graph.
A removed behavior will no longer activate in response to resources it demanded.
A removed resource will no longer activate behaviors and updating it will result in an error.</p>
</div>
</div>
<div class="sect2">
<h3 id="_behaviors_always_activate_in_the_same_event_that_their_extent_is_added_to_a_graph"><a class="link" href="#_behaviors_always_activate_in_the_same_event_that_their_extent_is_added_to_a_graph">Behaviors always activate in the same event that their extent is added to a graph</a></h3>
<div class="paragraph">
<p>When programming a behavior it is important to remember that it will get run at this time.
Use this to set initial values on state resources when information is not available at initialization time.</p>
</div>
</div>
<div class="sect2">
<h3 id="_extents_are_the_execution_context_for_behaviors_and_sideeffects"><a class="link" href="#_extents_are_the_execution_context_for_behaviors_and_sideeffects">Extents are the execution context for behaviors and sideEffects</a></h3>
<div class="paragraph">
<p>Extents are reference objects.
They enable code inside behaviors and side effects to interact with other graph elements or the environment.
The extent parameter passed into behaviors and side effects is this point of reference.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Most object oriented languages predefine <code>self</code> or <code>this</code> to serve a similar role inside methods.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">Mute behavior</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
</pre></td><td class="code"><pre><span class="n">_muteTap</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="n">_muted</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">stateWithValue</span><span class="p">:</span><span class="nb">@NO</span><span class="p">];</span>
<span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">_muteTap</span><span class="p">]</span> <span class="nf">supplies</span><span class="p">:@[</span><span class="n">_muted</span><span class="p">]</span> <span class="n">runBlock</span><span class="o">:^</span><span class="p">(</span><span class="n">ParticipantExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">extent</span><span class="p">.</span><span class="n">muteTap</span><span class="p">.</span><span class="n">justUpdated</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">muted</span> <span class="nf">updateValue</span><span class="p">:</span><span class="err">@</span><span class="p">(</span><span class="o">!</span><span class="n">extent</span><span class="p">.</span><span class="n">muted</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">boolValue</span><span class="p">)];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">extent</span><span class="p">.</span><span class="n">muted</span><span class="p">.</span><span class="n">justUpdated</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">extent</span> <span class="nf">sideEffect</span><span class="p">:</span><span class="s">@"mute toggle"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">ParticipantExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">extent</span> <span class="nf">muteParticipant</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">muted</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">boolValue</span><span class="p">];</span>
                <span class="p">[</span><span class="n">extent</span> <span class="nf">updateMuteUI</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">muted</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">boolValue</span><span class="p">];</span>
            <span class="p">}];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we can see nearly every single line in both the behavior and the side effect utilize their <code>extent</code> parameter to refer to resources and call methods.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resources_and_behaviors_can_link_across_extents"><a class="link" href="#_resources_and_behaviors_can_link_across_extents">Resources and behaviors can link across extents</a></h3>
<div class="paragraph">
<p>Frequently information stored in a resource will outlive the behaviors that react to changes in that information.
To enable this, a behavior can demand or supply resources from extents different from their owning extent.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>In our <a href="#video_chat">Video chat</a>, pinning one participant means unpinning the previous one if available.
The resource which can track which participant is currently pinned must outlive any particular participant.</p>
</div>
<div class="paragraph">
<p>The central <code>ChatExtent</code> has a resource <code>pinnedParticipant</code> that stores a reference to the currently pinned <code>ParticipantExtent</code>.
Each <code>ParticipantExtent</code> instance has a behavior that demands that resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
</pre></td><td class="code"><pre><span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">_chatExtent</span><span class="p">.</span><span class="n">pinnedParticipant</span><span class="p">]</span> <span class="nf">supplies</span><span class="p">:</span><span class="nb">nil</span> <span class="n">runBlock</span><span class="o">:^</span><span class="p">(</span><span class="n">ParticipantExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">([</span><span class="n">extent</span><span class="p">.</span><span class="n">chatExtent</span><span class="p">.</span><span class="n">pinnedParticipant</span> <span class="nf">justUpdatedTo</span><span class="p">:</span><span class="n">extent</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">extent</span> <span class="nf">sideEffect</span><span class="p">:</span><span class="s">@"show as pinned"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">ParticipantExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">extent</span> <span class="nf">updatePinUI</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
        <span class="p">}];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">([</span><span class="n">extent</span><span class="p">.</span><span class="n">chatExtent</span><span class="p">.</span><span class="n">pinnedParticipant</span> <span class="nf">justUpdatedFrom</span><span class="p">:</span><span class="n">extent</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">extent</span> <span class="nf">sideEffect</span><span class="p">:</span><span class="s">@"show as normal"</span> <span class="nf">runBlock</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">ParticipantExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">extent</span> <span class="nf">updatePinUI</span><span class="p">:</span><span class="nb">NO</span><span class="p">];</span>
        <span class="p">}];</span>
    <span class="p">}</span>
<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Line 1 demands the common <code>pinnedParticipant</code> on the <code>ChatExtent</code> instance stored in the member variable <code>chatExtent</code>.</p>
</li>
<li>
<p>We wish for the UI to draw the pinned participant larger than the others.
The first clause of the if statement, checks to see if the <code>pinnedParticipant</code> became this extent and creates a side effect to enact that change.</p>
</li>
<li>
<p>The second clause checks if the pinned participant is no longer this extent, returning it to normal size.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because each <code>ParticipantExtent</code> instance demands this central resource, updating that one resource will automatically cause this behavior in each participant to update its respective UI during the same event.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_store_related_extents_in_a_collection_resource"><a class="link" href="#_store_related_extents_in_a_collection_resource">Store related extents in a collection resource</a></h3>
<div class="paragraph">
<p>Many applications naturally organize into a hierarchy of lifetimes.
These different lifetimes should be modeled with extents.</p>
</div>
<div class="paragraph">
<p>The parent extent should own a state resource containing a collection of child extents.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="title">Add participants</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="code"><pre><span class="n">_participantJoined</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="n">_participantDisconnected</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">moment</span><span class="p">];</span>
<span class="n">_participants</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">stateWithValue</span><span class="p">:[</span><span class="n">NSMutableDictionary</span> <span class="nf">new</span><span class="p">]];</span>
<span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">_participantJoined</span><span class="p">,</span> <span class="n">_participantDisconnected</span><span class="p">]</span> <span class="nf">supplies</span><span class="p">:@[</span><span class="n">_participants</span><span class="p">]</span> <span class="n">runBlock</span><span class="o">:^</span><span class="p">(</span><span class="n">ChatExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">extent</span><span class="p">.</span><span class="n">participantJoined</span><span class="p">.</span><span class="n">justUpdated</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSString</span> <span class="o">*</span><span class="n">participantId</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">participantJoined</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
        <span class="n">ParticipantExtent</span> <span class="o">*</span><span class="n">participant</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ParticipantExtent</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithGraph</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">graph</span> <span class="nf">participantId</span><span class="p">:</span><span class="n">participantId</span> <span class="n">chat</span><span class="o">:</span><span class="n">extent</span><span class="p">];</span>
        <span class="p">[</span><span class="n">participant</span> <span class="nf">addToGraph</span><span class="p">];</span>
        <span class="n">extent</span><span class="p">.</span><span class="n">participants</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="nf">participantId</span><span class="p">]</span> <span class="o">=</span> <span class="n">participant</span><span class="p">;</span>
        <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">participants</span> <span class="nf">updateValueForce</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">participants</span><span class="p">.</span><span class="n">value</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">extent</span><span class="p">.</span><span class="n">participantDisconnected</span><span class="p">.</span><span class="n">justUpdated</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSString</span> <span class="o">*</span><span class="n">participantId</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">participantDisconnected</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
        <span class="n">ParticipantExtent</span> <span class="o">*</span><span class="n">participant</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">participants</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="nf">participantId</span><span class="p">];</span>
        <span class="p">[</span><span class="n">participant</span> <span class="nf">removeFromGraph</span><span class="p">];</span>
        <span class="n">extent</span><span class="p">.</span><span class="n">participants</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="nf">participantId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
        <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">participants</span> <span class="nf">updateValueForce</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">participants</span><span class="p">.</span><span class="n">value</span><span class="p">];</span>
    <span class="p">}</span>

<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In our <a href="#video_chat">Video chat</a>, the lifetime of each participant is necessarily bounded by the lifetime of the entire chat.</p>
</div>
<div class="paragraph">
<p>On our <code>ChatExtent</code> we create a <code>participants</code> resource to hold on to them.
This state resource holds a dictionary which maps a participant id string to each participant extent.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">BGState</span><span class="o">&lt;</span><span class="n">NSMutableDictionary</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="n">participants</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the behavior that supplies this resource, we update it any time a participant joins or disconnects.</p>
</div>
<div class="paragraph">
<p>It is worth noting how we update the <code>participants</code> resource in this behavior.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On lines 12 and 20 we directly manipulate the stored dictionary.</p>
</li>
<li>
<p>On the following lines lines 13 and 21, we update using the same dictionary instance and skipping the equality check.
By skipping this equality check, we activate any behaviors which demand the resource while also keeping the same collection.
If we did not skip the equality check, the state resource would recognize that the collection was the same instance and make no update.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_relink_behaviors_dynamically"><a class="link" href="#_relink_behaviors_dynamically">Relink behaviors dynamically</a></h3>
<div class="paragraph">
<p>Behaviors may link to resources in other extents.
Those extents may come and go.
Therefore it is necessary to change their links separately from when those behaviors were initialized and added to the graph.</p>
</div>
<div class="paragraph">
<p>You may call <code>setDemands</code> and <code>setSupplies</code> on a behavior to change those links.
Once that behavior has been added to the graph, you can only call those methods from inside an action or behavior block.</p>
</div>
<div class="paragraph">
<p>It is an error to modify a behavior&#8217;s links during an event if that behavior has already run during that event.
To prevent this, the behavior that modifies the links should supply a special resource which the Behavior Graph will use for proper ordering.
The behavior which has its links modified should demand this ordering resource.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>To fully implement our pinning functionality, there will be a <code>pinTap</code> moment resource on each <code>ParticipantExtent</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno">1
</pre></td><td class="code"><pre><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">BGMoment</span> <span class="o">*</span><span class="n">pinTap</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>There will also be a behavior in the <code>ChatExtent</code> to decide which participant should be pinned.
This behavior demands the <code>pinTap</code> in each <code>ParticipantExtent</code> in order to be activated whenever any of those resources is updated.
However, because participants can come and go, we will not have access to all of these resources at initialization time.
So we will leave them out initially in the demands list when we define our pinned behavior.</p>
</div>
<div id="chat_pinned" class="listingblock">
<div class="title">Pinned Behavior</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
</pre></td><td class="code"><pre><span class="n">_pinnedParticipant</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">stateWithValue</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="n">_pinnedBehavior</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">_participants</span><span class="p">,</span> <span class="n">_participantsRelink</span><span class="p">]</span> <span class="nf">supplies</span><span class="p">:@[</span><span class="n">_pinnedParticipant</span><span class="p">]</span> <span class="n">runBlock</span><span class="o">:^</span><span class="p">(</span><span class="n">ChatExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>

    <span class="n">ParticipantExtent</span> <span class="o">*</span><span class="n">currentPinned</span> <span class="o">=</span> <span class="n">extent</span><span class="p">.</span><span class="n">pinnedParticipant</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
    <span class="n">ParticipantExtent</span> <span class="o">*</span><span class="n">newPinned</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ParticipantExtent</span> <span class="o">*</span><span class="n">participant</span> <span class="k">in</span> <span class="n">extent</span><span class="p">.</span><span class="n">participants</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="n">allValues</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">participant</span><span class="p">.</span><span class="n">pinTap</span><span class="p">.</span><span class="n">justUpdated</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">newPinned</span> <span class="o">=</span> <span class="n">participant</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">participant</span> <span class="o">==</span> <span class="n">currentPinned</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">newPinned</span> <span class="o">=</span> <span class="n">currentPinned</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">pinnedParticipant</span> <span class="nf">updateValue</span><span class="p">:</span><span class="n">newPinned</span><span class="p">];</span>

<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>On line 8, we iterate through each <code>ParticipantExtent</code> instance in the <code>participants</code> resource.</p>
</li>
<li>
<p>The next lines inspect the <code>pinTap</code> resource on each extent to determine if the user tapped on one or if it should maintain the current pinned participant.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At this point however, the behavior will not get run when a pinTap resource is updated.
Additionally it will be an error for it to access the <code>pinTap</code> resources because it does not demand them.
We will introduce an additional behavior which updates these demands as the participants change.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="objectivec"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
</pre></td><td class="code"><pre><span class="n">_participantsRelink</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">resource</span><span class="p">];</span>
<span class="p">[</span><span class="n">self</span> <span class="nf">behaviorWithDemands</span><span class="p">:@[</span><span class="n">_participants</span><span class="p">]</span> <span class="nf">supplies</span><span class="p">:@[</span><span class="n">_participantsRelink</span><span class="p">]</span> <span class="n">runBlock</span><span class="o">:^</span><span class="p">(</span><span class="n">ChatExtent</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">demands</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nf">new</span><span class="p">];</span>
    <span class="p">[</span><span class="n">demands</span> <span class="nf">addObject</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">participants</span><span class="p">];</span>
    <span class="p">[</span><span class="n">demands</span> <span class="nf">addObject</span><span class="p">:</span><span class="n">extent</span><span class="p">.</span><span class="n">participantsRelink</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ParticipantExtent</span> <span class="o">*</span><span class="n">p</span> <span class="k">in</span> <span class="n">extent</span><span class="p">.</span><span class="n">participants</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">demands</span> <span class="nf">addObject</span><span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">pinTap</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">extent</span><span class="p">.</span><span class="n">pinnedBehavior</span> <span class="nf">setDemands</span><span class="p">:</span><span class="n">demands</span><span class="p">];</span>
<span class="p">}];</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each time a new participant is added or removed (updating the <code>participants</code> resource), this behavior will activate and update the demands of <a href="#chat_pinned">Pinned Behavior</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On lines 5 and 6, <code>participants</code> and <code>participantsRelink</code> are added to the array.
They are added because they are part of the default list of demands when <a href="#chat_pinned">Pinned Behavior</a> was initialized.</p>
</li>
<li>
<p>Next we iterate through each <code>ParticipantExtent</code> instance and add its <code>pinTap</code> resource to the array.</p>
</li>
<li>
<p>Lastly line 10 updates the demands of that behavior.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note the use of <code>participantsRelink</code> resource.
It is of the base type <code>BGResource</code> which has limited functionality.
This is our ordering resource.
It has no value and is not updated.
It only exists to ensure that the demands of the <code>pinnedBehavior</code> are updated before the behavior itself is run.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_supplies_can_also_be_relinked_dynamically"><a class="link" href="#_supplies_can_also_be_relinked_dynamically">Supplies can also be relinked dynamically</a></h3>
<div class="paragraph">
<p>It is less useful in practice.
Occasionally you may wish to have the behavior on one of many child extents update a resource on the parent level.
As these extents come and go, you may need to designate a new supplier.</p>
</div>
</div>
<div class="sect2">
<h3 id="_updating_links_will_cause_dependent_behaviors_to_activate"><a class="link" href="#_updating_links_will_cause_dependent_behaviors_to_activate">Updating links will cause dependent behaviors to activate</a></h3>
<div class="paragraph">
<p>When the demands of a behavior change, that behavior is activated and run to ensure it is fully taking into account its current set of demands.</p>
</div>
<div class="paragraph">
<p>When a resource is supplied by a new behavior any behaviors that demand that resource will activate.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removed_resources_and_behaviors_are_automatically_removed_from_demands_and_supplies"><a class="link" href="#_removed_resources_and_behaviors_are_automatically_removed_from_demands_and_supplies">Removed resources and behaviors are automatically removed from demands and supplies</a></h3>
<div class="paragraph">
<p>Whenever an extent is removed from the graph all its resources and behaviors will also be removed.
Any remaining resources and behaviors will have their links to the removed elements severed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removed_behaviors_will_not_run_in_the_event_they_are_removed"><a class="link" href="#_removed_behaviors_will_not_run_in_the_event_they_are_removed">Removed behaviors will not run in the event they are removed</a></h3>
<div class="paragraph">
<p>If an activated behavior is removed before it is run, it will not be run.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_program_may_have_multiple_instances_of_a_graph"><a class="link" href="#_a_program_may_have_multiple_instances_of_a_graph">A program may have multiple instances of a graph</a></h3>
<div class="paragraph">
<p>A program or library can have any number of independent instances of a BGGraph.
Behaviors and resources cannot link across graph instances.
Extents cannot migrate between graph instances.</p>
</div>
</div>
<div class="sect2">
<h3 id="_independent_graphs_may_communicate_through_message_passing"><a class="link" href="#_independent_graphs_may_communicate_through_message_passing">Independent graphs may communicate through message passing</a></h3>
<div class="paragraph">
<p>One graph may pass information to another by creating a side effect on one which creates a new action on the other.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-10-11 11:26:00 -0700
</div>
</div>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
</body>
</html>