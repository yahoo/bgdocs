<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.97.3" />
<link rel="canonical" type="text/html" href="https://yahoo.github.io/bgdocs/docs/jvm/">
<link rel="alternate" type="application/rss&#43;xml" href="https://yahoo.github.io/bgdocs/docs/jvm/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/bgdocs/docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/bgdocs/docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/android-192x192.png" sizes="192x192">

<title>JVM and Android | Behavior Graph</title>
<meta name="description" content="">
<meta property="og:title" content="JVM and Android" />
<meta property="og:description" content="Behaior Graph Documentation" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://yahoo.github.io/bgdocs/docs/jvm/" /><meta property="og:site_name" content="Behavior Graph" />

<meta itemprop="name" content="JVM and Android">
<meta itemprop="description" content="Behaior Graph Documentation"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="JVM and Android"/>
<meta name="twitter:description" content="Behaior Graph Documentation"/>




<link rel="preload" href="/bgdocs/docs/scss/main.min.209ee91954d0f2f182770e6c71011a5580360636bcf2a9bcf7f1c3da478784ff.css" as="style">
<link href="/bgdocs/docs/scss/main.min.209ee91954d0f2f182770e6c71011a5580360636bcf2a9bcf7f1c3da478784ff.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/bgdocs/docs/">
		<span class="navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="font-weight-bold">Behavior Graph</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"></div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/bgdocs/docs/jvm/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">JVM and Android</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-6e05df3f1b107e930793d0d0567fc8d0">Getting Started</a></li>


    
  
    
    
	
<li>2: <a href="#pg-b274302065bfc46f1724630e5871c33c">Code Example</a></li>


    
  
    
    
	
<li>3: <a href="#pg-9adff9e79aca359df764122a0c51e80b">API</a></li>


    
  
    
    
	
<li>4: <a href="#pg-fac1ee0e7dbde78e1c81a6017bf959e1">Tutorial 1 - Basics</a></li>


    
  
    
    
	
<li>5: <a href="#pg-909a12945f3d5c13544a2ba04f6be058">Tutorial 2 - IO</a></li>


    
  
    
    
	
<li>6: <a href="#pg-c4acf1226b172bb0f4dcbd476150b87a">Tutorial 3 - Extents</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-6e05df3f1b107e930793d0d0567fc8d0">1 - Getting Started</h1>
    
	<p>Using Behavior Graph is as simple as downloading it via your preferred format and importing it into your source.</p>
<h2 id="downloading">Downloading</h2>
<h3 id="maven-central">Maven Central</h3>
<p>Behavior Graph is available on Maven Central @ <a href="https://search.maven.org/artifact/com.yahoo.behaviorgraph/bgjvm">com.yahoo.behaviorgraph/bgjvm</a>.</p>
<p>You may download the jar directly from there or you can include it as part of your Gradle or Maven project.</p>
<h3 id="maven">Maven</h3>
<p>Add a dependency in your pom.xml.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&lt;dependency&gt;</span>  
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&lt;groupId&gt;</span>com.yahoo.behaviorgraph<span style="color:#204a87;font-weight:bold">&lt;/groupId&gt;</span>  
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&lt;artifactId&gt;</span>bgjvm<span style="color:#204a87;font-weight:bold">&lt;/artifactId&gt;</span>  
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">&lt;version&gt;</span>0.7.0<span style="color:#204a87;font-weight:bold">&lt;/version&gt;</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&lt;/dependency&gt;</span>  
</span></span></code></pre></div><h3 id="gradle">Gradle</h3>
<p>You may add it as a dependency in your Gradle build.gradle file</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-groovy" data-lang="groovy"><span style="display:flex;"><span><span style="color:#000">dependencies</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">implementation</span> <span style="color:#4e9a06">&#39;com.yahoo.behaviorgraph:bgjvm:0.7.0&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h3 id="github">GitHub</h3>
<p>Behavior Graph is available in source form via Github @ <a href="https://github.com/yahoo/bgkotlin">yahoo/bgkotlin</a>.</p>
<h2 id="importing">Importing</h2>
<p>You can import the Behavior Graph classes using normal Java import syntax</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">behaviorgraph.*</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span></code></pre></div><h2 id="kotlin">Kotlin</h2>
<p>Behavior Graph is written in Kotlin but the API has been designed to be usable with both Java and Kotlin.</p>
<h2 id="tutorials">Tutorials</h2>
<p>It is unlikely you will get very far with Behavior Graph without working through a <a href="https://yahoo.github.io/bgdocs/docs/jvm/tutorial-1/">tutorial</a>.
Please spend some time with them to practice writing Behavior Graph code.
They don&rsquo;t take very long. We promise you will be mentally stimulated and spiritually rewarded for your time.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b274302065bfc46f1724630e5871c33c">2 - Code Example</h1>
    
	<p><em>This is a walk-through, please see the tutorials for a complete guide to learning Behavior Graph.</em></p>
<p>Let&rsquo;s see how Behavior Graph code looks like by implementing functionality from a typical login screen.</p>
<p><img src="/bgdocs/docs/images/login-ui-2.svg" alt="Login Page"></p>
<h2 id="form-validation">Form Validation</h2>
<p>As a first feature, we would like the Login button to remain disabled until the user has entered both a reasonable email and password.
If the user types in some password but an invalid email address (missing the &lsquo;@&rsquo; character, for example) the Login button will remain disabled.
Once she corrects the email address by adding an &lsquo;@&rsquo; character, the Login button should immediately enable.</p>
<p>Here is Behavior Graph code for this functionality.</p>


















<ul class="nav nav-tabs" id="tabs-1" role="tablist"><li class="nav-item">
      <a class="nav-link active tab-Java"
        id="tabs-1-0-tab" data-toggle="tab" href="#tabs-1-0" role="tab" onclick="handleClick(&#34;Java&#34;);"
        aria-controls="tabs-1-0" aria-selected="true">
        Java
      </a>
    </li></ul>


<div class="tab-content" id="tabs-1-content"><div class="tab-pane fade show active"
        id="tabs-1-0" role="tabpanel" aria-labelled-by="tabs-1-0-tab"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">com.yahoo.behaviorgraph.*</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">LoginForm</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">LoginForm</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Boolean</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">loginEnabled</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">email</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">password</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">LoginForm</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Graph</span> <span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">loginEnabled</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">emailValid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">validateEmail</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">passwordValid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">length</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">0</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">enabled</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">emailValid</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">passwordValid</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">loginEnabled</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">enabled</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">private</span> <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">validateEmail</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span> <span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8f5902;font-style:italic">// ... validate email code goes here
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span></span></span></code></pre></div></div>
  
</div>

<p>First we import Behavior Graph to have access to its primary interface objects: <code>Graph</code> and <code>Extent</code>.</p>
<p>Next we subclass <code>Extent</code> which needs to be initialized with an instance of <code>Graph</code>.
<strong>Extents</strong> are containers of Behavior Graph elements.
They also provide convenient API for creating these elements.</p>
<h3 id="resources">Resources</h3>
<p>Inside the constructor we create 3 <strong>resources</strong> using the <code>state()</code> factory method: <code>loginEnabled</code>, <code>email</code>, and <code>password</code>.
Resources are special containers of information.
For example, the <code>loginEnabled</code> resource will say if our Login button should be enabled or not.
We initialize it with <code>false</code> because it will be disabled by default.</p>
<h3 id="validation-behavior">Validation Behavior</h3>
<p>After those we define a <strong>behavior</strong>.
It will determine if the Login Button should be enabled based on the contents of the <code>email</code> and <code>password</code> resources.
They appear as parameters to the <code>demands()</code> clause of our <code>behavior()</code> factory method.
This list of resources is called the behavior&rsquo;s <strong>demands</strong>.
They contain the information the behavior depends on.</p>
<p>As stated before, behaviors are never called directly.
In specifying a behavior&rsquo;s demands, we are saying, <em>&ldquo;whenever any of these resources updates (changes), then this behavior needs to run&rdquo;.</em>
In our example, when either <code>email</code> or <code>password</code> (or both) update, this behavior will run in response.</p>
<p>The block of code specified in the <code>runs()</code> clause is the code that will run.
A typical behavior uses normal, imperative code to perform its work.
We check the validity of the email with a normal function call.
We use normal Boolean logic to determine if the Login button should be enabled.</p>
<p><code>email</code> and <code>password</code> are a specific type of resource called a <strong>state resource</strong>.
State resources are designed for saving and retrieving information.
The contents of a state resource is available via its <code>value</code> property.
A behavior must include a resources in its list of demands in order to access its <code>value</code>.
Note in the code above how we use <code>.value</code> to access what the Email resource contains in order to validate it.</p>
<h3 id="supplies">Supplies</h3>
<p>This behavior is responsible for the enabled state of the Login button.
We store this information in another state resource called <code>loginEnabled</code>.
We list this resource in the <code>supplies()</code> clause of our <code>behavior()</code>.
This list is called the behavior&rsquo;s <strong>supplies</strong>.
A behavior can read and write the contents of these resources.
We write to a state resource by calling its <code>update()</code> method.</p>
<h2 id="logging-in">Logging In</h2>
<p>We continue to develop our Login page by adding a second feature.
When the user clicks the Login button and we are not already logging in, then we would like to enter into a logging in state.
In order to prevent mistakes, when we are in a logging in state, we would also like the Login button to be disabled.</p>
<p>To implement this new feature we introduce a second behavior and make a small change to our existing behavior.</p>




















<ul class="nav nav-tabs" id="tabs-2" role="tablist"><li class="nav-item">
      <a class="nav-link active tab-Java"
        id="tabs-2-0-tab" data-toggle="tab" href="#tabs-2-0" role="tab" onclick="handleClick(&#34;Java&#34;);"
        aria-controls="tabs-2-0" aria-selected="true">
        Java
      </a>
    </li></ul>


<div class="tab-content" id="tabs-2-content"><div class="tab-pane fade show active"
        id="tabs-2-0" role="tabpanel" aria-labelled-by="tabs-2-0-tab"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">password</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#000">Moment</span> <span style="color:#000">loginClick</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Boolean</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">loggingIn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">LoginForm</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Graph</span> <span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">loggingIn</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">loginClick</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">loginClick</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">loggingIn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>                <span style="color:#000">loggingIn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">loginEnabled</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">loggingIn</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">emailValid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">validateEmail</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">passwordValid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">length</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">0</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">enabled</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">emailValid</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">passwordValid</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">loggingIn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">loginEnabled</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">enabled</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div></div>
  
</div>

<p>Our new behavior has one demand, <code>loginClick</code>.
This is a second type of resource called a <strong>moment resource</strong>.
Moments are designed to track momentary happenings such as a button click or network call returning.
We can check if a moment has just happened by accessing its <code>justUpdated()</code> property.</p>
<p>When the user clicks on the button, <code>loginClick</code> will update, and this new behavior will run.
It performs a simple Boolean check to determine if the <code>loggingIn</code> state resource needs to update to <code>true</code>.
It is allowed to update this resource because <code>loggingIn</code> is part of its supplies.</p>
<p>We also modified our previous behavior to include <code>loggingIn</code> as one of its demands.
This means it will also run when the <code>loggingIn</code> resource updates.
Now the state of <code>loginEnabled</code> depends on all three pieces of information: <code>email</code>, <code>password</code>, and <code>loggingIn</code>.</p>
<h2 id="actions">Actions</h2>
<p><img src="/bgdocs/docs/images/login-intro-graph.svg" alt="Login Behavior Graph"></p>
<p>Information comes into our system via <strong>actions</strong>.
A typical UI library will provide some type of callback or event system to capture user inputs.
In this example we will listen to a click handler to create a new action which updates the <code>loginClick</code> moment resource.</p>


















<ul class="nav nav-tabs" id="tabs-4" role="tablist"><li class="nav-item">
      <a class="nav-link active tab-Java"
        id="tabs-4-0-tab" data-toggle="tab" href="#tabs-4-0" role="tab" onclick="handleClick(&#34;Java&#34;);"
        aria-controls="tabs-4-0" aria-selected="true">
        Java
      </a>
    </li></ul>


<div class="tab-content" id="tabs-4-content"><div class="tab-pane fade show active"
        id="tabs-4-0" role="tabpanel" aria-labelled-by="tabs-4-0-tab"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">loginButton</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addActionListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">action</span><span style="color:#ce5c00;font-weight:bold">(()</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">loginForm</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">loginClick</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div></div>
  
</div>

<p>We would similarly connect <code>email</code> and <code>password</code> to their respective text fields.</p>
<p>Once the user has entered a valid email and password, the Login button will enable.
When the user subsequently clicks on the Login button, the behavior that supplies <code>loggingIn</code> will run.
It will update the <code>loggingIn</code> resource to <code>true</code>.
This in turn will cause the behavior that supplies <code>loginEnabled</code> to run.
It will update the <code>loginEnabled</code> resource to <code>false</code> (because we are logging in).</p>
<h2 id="side-effects">Side Effects</h2>
<p>In order to perform real output to the UI library, we need to create a <strong>side effect</strong>.</p>




















<ul class="nav nav-tabs" id="tabs-5" role="tablist"><li class="nav-item">
      <a class="nav-link active tab-Java"
        id="tabs-5-0-tab" data-toggle="tab" href="#tabs-5-0" role="tab" onclick="handleClick(&#34;Java&#34;);"
        aria-controls="tabs-5-0" aria-selected="true">
        Java
      </a>
    </li></ul>


<div class="tab-content" id="tabs-5-content"><div class="tab-pane fade show active"
        id="tabs-5-0" role="tabpanel" aria-labelled-by="tabs-5-0-tab"><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">loginEnabled</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">loggingIn</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">emailValid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">validateEmail</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">email</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">passwordValid</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">password</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">length</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">0</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">enabled</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">emailValid</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">passwordValid</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">loggingIn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">loginEnabled</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">enabled</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">loginButton</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setEnabled</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">loginEnabled</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div></div>
  
</div>

<p>Side effects are created directly inside behaviors.
Inside we are allowed to do anything we like.
This side effect updates the <code>enabled</code> state of the <code>loginButton</code> based on the state of the <code>loginEnabled</code> resource.
It does not run immediately, however.
Behavior Graph defers the running of side effects until after all behaviors have run.
Side effects are a practical way for Behavior Graph to create output while ensuring access to consistent state.</p>
<h2 id="learning-more">Learning More</h2>
<p>Congratulations, you have just learned all the important concepts for using Behavior Graph in your code.</p>
<p>Please don&rsquo;t be discouraged by the number of new abstractions.
This walk-through is intentionally brief.
But from here on out, it&rsquo;s mostly just nuance.</p>
<p>For a more guided tour please try out one of our tutorials for your platform.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9adff9e79aca359df764122a0c51e80b">3 - API</h1>
    
	<p>You can view the API docs in <a href="https://javadoc.io/doc/com.yahoo.behaviorgraph/bgjvm/latest/index.html">Javadoc format here</a></p>
<h1 id="types">Types</h1>
<h2 id="behavior">Behavior</h2>
<p>A behavior is a block of code together with its dependency relationships (links).
They are one of the two node types in a behavior graph.
You define behaviors using the <code>behavior()</code> factory method of an Extent.</p>
<p>Behaviors have both static and dynamic links.
You provide static links when you create the behavior.
Behavior Graph will update dynamic links per special methods on BehaviorBuilder or you can update them directly on a behavior.</p>
<h3 id="getdemands"><code>getDemands()</code></h3>
<ul>
<li>Kotlin: <code>demands</code></li>
<li>returns: <code>Set&lt;Resource&gt;?</code></li>
<li><em>read only property</em></li>
</ul>
<p>The current set of all Resources which the behavior demands.</p>
<h3 id="getextent"><code>getExtent()</code></h3>
<ul>
<li>Kotlin: <code>extent</code></li>
<li>returns: <code>Extent</code></li>
<li><em>read only property</em></li>
</ul>
<p>A behavior always has an Extent with which it is created.</p>
<h3 id="setdynamicdemands"><code>setDynamicDemands()</code></h3>
<ul>
<li>param: <code>newDemands: Demandable...</code></li>
<li>or param: <code>newDemands: List&lt;? extends Demandable&gt;?</code></li>
</ul>
<p>Provide an array of Demandables.
The complete set of demands for this behavior will be the ones it is defined with (static demands) plus this additional set. Calling this multiple times will replace the set of dynamic demands, it will not continue to add demands.</p>
<p>Providing <code>null</code> or no demands is equivalent to saying there are only static demands.</p>
<h3 id="setdynamicsupplies"><code>setDynamicSupplies()</code></h3>
<ul>
<li>param: <code>newSupplies: Resource...</code></li>
<li>or param: <code>newSupplies: List&lt;Resource&gt;?</code></li>
</ul>
<p>Provide an array of Resources to supply.
The complete set of supplies for this behavior will be the ones it is defined with (static supplies) plus this additional set. CAlling this multiple times will replace the set of dynamic supplies, it will not continue to add supplies.</p>
<p>Providing <code>null</code> or no supplies is equivalent to saying there are only static supplies.</p>
<h3 id="getsupplies"><code>getSupplies()</code></h3>
<ul>
<li>Kotlin: <code>supplies</code></li>
<li>returns: <code>Set&lt;Resource&gt;?</code></li>
<li><em>read only property</em></li>
</ul>
<p>The current set of all Resources which the behavior supplies.</p>
<h2 id="behaviorbuildert"><code>BehaviorBuilder&lt;T&gt;</code></h2>
<p>BehaviorBuilder provides fluent API for constructing instances of a Behavior.
You create an instance of a BehaviorBuilder using the <code>behavior()</code> method on Extent.
All methods except <code>runs()</code> return the same instance of BehaviorBuilder so you can chain multiple optional clauses.</p>
<p>Generic type T is the Extent subtype BehaviorBuilder is created with.</p>
<!-- Behavior-1 -->
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// Create a single behavior with one demand and one supply.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">var</span> <span style="color:#000">moment1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000">var</span> <span style="color:#000">moment2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000">var</span> <span style="color:#000">moment3</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">moment1</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">moment2</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">moment3</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">moment1</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">||</span> <span style="color:#000">moment2</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdatedTo</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#ce5c00;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">moment3</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<h3 id="demands"><code>demands()</code></h3>
<ul>
<li>param: <code>demands: Demandable...</code></li>
<li>or param: <code>demands: List&lt;? extends Demandable&gt;</code></li>
<li>returns: <code>BehaviorBuilder&lt;T&gt;</code></li>
</ul>
<p>Provide a list of static demands this behavior will link to.</p>
<h3 id="dynamicdemands"><code>dynamicDemands()</code></h3>
<ul>
<li>param: <code>switches: Demandable[]</code> or <code>switches: List&lt;? extends Demandable&gt;</code></li>
<li>optional param: <code>relinkingOrder: RelinkingOrder</code></li>
<li>param: <code>links: (ext: T, demands: MutableList&lt;? extends Demandable?&gt;) -&gt; void</code></li>
<li>returns: <code>BehaviorBuilder&lt;T&gt;</code></li>
</ul>
<p>This clause updates the dynamicDemands of this behavior based on the updating of other resources, the switches.
When the switches update, the links parameter will be called. The provided code should add any additional resources to the <code>demands</code> MutableList.</p>
<p>We permit <code>nulls</code> in the list to make for easier logic and they will be filtered out. Adding nothing to the demands list is equivalent to saying there are no dynamicDemands.</p>
<p><code>relinkingOrder</code> parameter can optionally be set to <code>RelinkingOrder.relinkingOrderSubsequent</code> which will update the demands <em>after</em> the runs block is run. The default is <code>RelinkingOrder.relinkingOrderPrior</code>.</p>
<!-- Behavior-2 -->
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// This behavior will automatically demand the deleteButton resource of
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// the currentChild extent whenever it changes.
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">var</span> <span style="color:#000">currentChild</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">dynamicDemands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Demandable</span><span style="color:#ce5c00;font-weight:bold">[]</span> <span style="color:#ce5c00;font-weight:bold">{</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">currentChild</span> <span style="color:#ce5c00;font-weight:bold">},</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">demands</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">currentChild</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">demands</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">currentChild</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">deleteButton</span><span style="color:#ce5c00;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">currentChild</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">currentChild</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">deleteButton</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#8f5902;font-style:italic">// do something in response
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<h3 id="dynamicsupplies"><code>dynamicSupplies()</code></h3>
<ul>
<li>param: <code>switches: Demandable[]</code> or <code>switches: List&lt;? extends Demandable&gt;</code></li>
<li>optional param: <code>relinkingOrder: RelinkingOrder</code></li>
<li>param: <code>links: (ext: T, supplies: MutableList&lt;Resource&gt;) -&gt; void</code></li>
<li>returns: <code>BehaviorBuilder&lt;T&gt;</code></li>
</ul>
<p>This clause updates the dynamicSupplies. Please see <code>dynamicDemands()</code> for additional details and example.</p>
<h3 id="runs"><code>runs()</code></h3>
<ul>
<li>param: <code>block: (ext: T) -&gt; void</code></li>
<li>returns: <code>Behavior</code></li>
</ul>
<p>This clause sets the block of code which will run at some point after this behavior is activated.
The parameter <code>ext</code> will be the instance of the Extent&rsquo;s generic type this behavior was created on.</p>
<p><code>runs()</code> will return the created behavior which will typically be ignored.</p>
<h3 id="supplies"><code>supplies()</code></h3>
<ul>
<li>param: <code>supplies: Resource...</code></li>
<li>or param: <code>supplies: List&lt;Resource&gt;?</code></li>
<li>returns: <code>BehaviorBuilder&lt;T&gt;</code></li>
</ul>
<p>Provide a list of static supplies this behavior will link to.</p>
<h2 id="extentt"><code>Extent&lt;T&gt;</code></h2>
<p>Extents are collections of resources and behaviors.
You will create your own Extent subclasses to define your Behavior Graph functionality.</p>
<!-- Extent-1 -->
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// Define extent that toggles state on a switch
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">MyExtent</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">MyExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Moment</span> <span style="color:#000">toggleSwitch</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Boolean</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">currentState</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">MyExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">toggleSwitch</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">currentState</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#000">currentState</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(!</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">currentState</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// Create instance of MyExtent and add it to the graph
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">var</span> <span style="color:#000">myGraph</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Graph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#000">var</span> <span style="color:#000">myExtent</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">MyExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">myGraph</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">myExtent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addToGraphWithAction</span><span style="color:#ce5c00;font-weight:bold">();</span></span></span></code></pre></div>
<h3 id="action"><code>action()</code></h3>
<ul>
<li>optional param: <code>debugName: String</code></li>
<li>param: <code>action: (ext: T) -&gt; void</code></li>
</ul>
<p>Calls the <code>action()</code> method on the underlying Graph object.
Contains an additional <code>ext</code> parameter which will be the Extent&rsquo;s generic type T instance.</p>
<h3 id="actionasync"><code>actionAsync()</code></h3>
<ul>
<li>optional param: <code>debugName: String</code></li>
<li>param: <code>action: (ext: T) -&gt; void</code></li>
</ul>
<p>Calls the <code>actionAsync()</code> method on the underlying Graph object.
Contains an additional <code>ext</code> parameter which will be the Extent&rsquo;s generic type T instance.</p>
<h3 id="addchildlifetime"><code>addChildLifetime()</code></h3>
<ul>
<li>param: <code>extent: Extent</code></li>
</ul>
<p>Adds the parameter to list of child lifetimes.
An extent with child lifetimes is guaranteed to be part of the graph for at least as long as the child is.
Behaviors in child extents are permitted to have static links to resources in the parent.</p>
<h3 id="getdidadd"><code>getDidAdd()</code></h3>
<ul>
<li>Kotlin: <code>didAdd</code></li>
<li>returns <code>State&lt;Boolean&gt;</code></li>
<li><em>read only</em> property</li>
</ul>
<p>Every extent comes with this state resource.
It updates to <code>true</code> during the event the extent is added to the graph.
Behaviors can demand it to ensure they are activated when they are added.</p>
<h3 id="addtograph"><code>addToGraph()</code></h3>
<p>Adds this extent to the graph.
Behavior Graph will only interact with resources and behaviors after their extent has been added.</p>
<h3 id="addtographwithaction"><code>addToGraphWithAction()</code></h3>
<ul>
<li>optional param: <code>debugName: String</code></li>
</ul>
<p>Syntactic sugar for creating a new action and calling <code>addToGraph()</code>.
<code>debugName</code> is passed to the action.</p>
<h3 id="behavior-1"><code>behavior()</code></h3>
<p>Creates a BehaviorBuilder instance.</p>
<h3 id="getdebugname"><code>getDebugName()</code></h3>
<ul>
<li>Kotlin: <code>debugName</code></li>
<li>returns: <code>String?</code></li>
<li><em>read write</em> property</li>
</ul>
<p>You can define a runtime debugName for your instances to aid in debugging.
It defaults to the name of your Extent subclass.</p>
<h3 id="setdebugname"><code>setDebugName()</code></h3>
<ul>
<li>Kotlin: <code>debugName</code></li>
<li>param: <code>debugName: String?</code></li>
<li><em>read write</em> property</li>
</ul>
<p>Overrides default subclass name.</p>
<h3 id="new-extent"><code>new Extent()</code></h3>
<ul>
<li>param: <code>graph: Graph</code></li>
<li>constructor</li>
</ul>
<p>An Extent must be initialized with a Graph.
You must call super() with the graph in your overridden constructor.</p>
<h3 id="getgraph"><code>getGraph()</code></h3>
<ul>
<li>Kotlin: <code>graph</code></li>
<li>returns <code>Graph</code></li>
<li><em>read only</em> property</li>
</ul>
<p>The graph on which this extent was created.</p>
<h3 id="moment"><code>moment()</code></h3>
<ul>
<li>optional param: <code>debugName: String?</code></li>
</ul>
<p>Factory method to create a moment resource.
By default the <code>debugName</code> will be the name of the property that points to this resource.</p>
<h3 id="removefromgraph"><code>removeFromGraph()</code></h3>
<ul>
<li>optional param: <code>strategy: ExtentRemoveStrategy</code></li>
</ul>
<p>Default is <code>ExtentRemoveStrategy.ExtentOnly</code></p>
<p>After an extent is removed from the graph its resource and behaviors will no longer interact with other extents in the graph.</p>
<p>Extents must be removed in a manner that is consistent with their lifetimes.</p>
<ul>
<li>All extents with a unified lifetime must be removed during the same event.</li>
<li>All extents that have a parent lifetime must not remain in the graph longer than their parent.</li>
</ul>
<p>The default value <code>ExtentOnly</code> will just try to remove the receiver extent.</p>
<p>Providing <code>ExtentRemoveStrategy.removeContainedLifetimes</code> as the strategy parameter will automatically remove all extents with the unified or child lifetimes.</p>
<h3 id="removefromgraphwithaction"><code>removeFromGraphWithAction()</code></h3>
<ul>
<li>optional param: <code>strategy: ExtentRemoveStrategy</code></li>
<li>optional param: <code>debugName: string</code></li>
</ul>
<p>Syntactic sugar for creating a new action and calling <code>removeFromGraph()</code>.
<code>debugName</code> is passed to the action. <code>strategy</code> is passed to <code>removeFromGraph()</code>.</p>
<h3 id="resource"><code>resource()</code></h3>
<ul>
<li>optional param: <code>debugName: String?</code></li>
</ul>
<p>Factory method to create a resource.
By default the <code>debugName</code> will be the name of the property that points to this resource.</p>
<p>In general, you should prefer <code>state()</code>, <code>moment()</code>, or <code>typedMoment()</code>. This &ldquo;abstract&rdquo; resource is typically only useful for ensuring proper ordering between two behaviors.</p>
<h3 id="setcontext"><code>setContext()</code></h3>
<ul>
<li>Kotlin: <code>context</code></li>
<li>param: <code>context: T</code></li>
<li><em>read write property</em></li>
</ul>
<p>The generic type parameter T on Extent is typically an Extent subclass. This is the easiest option.
However, it is not strictly necessary.</p>
<p>We can define our separate type and call <code>setContext()</code> to pair our extent with an instance of this separate type.
This &ldquo;context&rdquo; object will be provided in the various lambdas provided by Extent.</p>
<h3 id="sideeffect"><code>sideEffect()</code></h3>
<ul>
<li>optional param: <code>debugName: String?</code></li>
<li>param: <code>block: (ext: T) -&gt; void</code></li>
</ul>
<p>Calls the <code>sideEffect()</code> method on the underlying Graph object.
Contains an additional <code>ext</code> parameter</p>
<h3 id="statet"><code>state&lt;T&gt;()</code></h3>
<ul>
<li>param: <code>initialState: T</code></li>
<li>optional param: <code>debugName: String?</code></li>
</ul>
<p>Factory method to create a state resource.
By default the <code>debugName</code> will be the name of the property that points to this resource.</p>
<h3 id="typedmomentt"><code>typedMoment&lt;T&gt;()</code></h3>
<ul>
<li>optional param: <code>debugName: String?</code></li>
</ul>
<p>Creates a <code>TypedMoment</code> instance similar to <code>Moment</code> except that it contains additional data of type <code>T</code>.</p>
<h3 id="unifylifetime"><code>unifyLifetime()</code></h3>
<ul>
<li>param: <code>extent: Extent</code></li>
</ul>
<p>Combines the lifetime of this extent with that of the parameter.
Extents with unified lifetimes are guaranteed to be part of the graph for the same period of time.
They are permitted to have static links between them.</p>
<h2 id="graph">Graph</h2>
<p>The core construct that represents the graph of behavior and resource nodes. As many graphs can exist in the same program as you like; however nodes in one graph cannot directly link to nodes in another graph.</p>
<h3 id="action-1"><code>action()</code></h3>
<ul>
<li>optional param: <code>debugName: String</code></li>
<li>param: <code>thunk: () -&gt; void</code></li>
</ul>
<p>Creates a synchronous action on the graph.
This means that all behaviors and side effects which will run because of this action will necessarily complete before the completion of this method call.</p>
<p>By default the debugName will be derived from the set of resources that are updated inside the action block.</p>
<h3 id="actionasync-1"><code>actionAsync()</code></h3>
<ul>
<li>optional param: <code>debugName: String</code></li>
<li>param: <code>block: () -&gt; void</code></li>
</ul>
<p>Creates an action that will run asynchronously.
This means that the behaviors and side effects which will run because of this action <em>may not</em> necessarily complete before the completion of this method call.</p>
<h3 id="getcurrentbehavior"><code>getCurrentBehavior()</code></h3>
<ul>
<li>Kotlin: <code>currentBehavior</code></li>
<li>returns <code>Behavior?</code></li>
<li><em>read only</em> property</li>
</ul>
<p>Returns the currently running behavior or null if otherwise.</p>
<h3 id="getcurrentevent"><code>getCurrentEvent()</code></h3>
<ul>
<li>Kotlin: <code>currentEvent</code></li>
<li>returns <code>Event?</code></li>
<li><em>read only</em> property</li>
</ul>
<p>Returns the current Event if the graph is running an event or null otherwise.</p>
<h3 id="dateprovider"><code>dateProvider</code></h3>
<ul>
<li>returns: <code>GraphDateProvider</code></li>
<li><em>read write</em> property</li>
</ul>
<p>The default dateProvider returns <code>Date.now()</code> which is the source of <code>timestamp</code> on GraphEvent instances.
Overriding is primarily useful for controlling values during testing.</p>
<h3 id="debugcycleforbehavior"><code>debugCycleForBehavior()</code></h3>
<ul>
<li>param: <code>behavior: Behavior</code></li>
<li>returns: <code>List≤Resource&gt;</code></li>
</ul>
<p>Used during debugging as an aid when there are dependency cycles.
The returned list contains the sequence of Resource objects which will result in a dependency cycle including this behavior.
The array will be empty if there is not a cycle.</p>
<h3 id="getlastevent"><code>getLastEvent()</code></h3>
<ul>
<li>Kotlin: <code>lastEvent</code></li>
<li>returns <code>Event</code></li>
<li><em>read only</em> property</li>
</ul>
<p>Returns the last Event that completed.
It starts as <code>Event.InitialEvent</code>.</p>
<h3 id="new-graph">`new Graph()</h3>
<ul>
<li>optional param: <code>dateProvider: DateProvider</code></li>
</ul>
<p>Graph uses the platform default to get the current timestamp when creating new Events.
We can provide an optional dateProvider object which will return a user defined timestamp.
This is particularly useful for automated testing.</p>
<h3 id="sideeffect-1"><code>sideEffect()</code></h3>
<ul>
<li>optional param: <code>debugName: String</code></li>
<li>param: <code>thunk: () =&gt; void</code></li>
</ul>
<p>Creates a block of code that will run during the side effect phase of the event.
Side effects are run in the order they are created.
Side effects do not run until after all behaviors have been run.</p>
<h3 id="setvalidatedependencies"><code>setValidateDependencies()</code></h3>
<ul>
<li>Kotlin: <code>validateDependencies</code></li>
<li>param: <code>validate: boolean</code></li>
</ul>
<p>True by default. This will ensure that a code inside a behavior only accesses resources specified in its demands and supplies clauses.</p>
<p>Validating dependencies is a runtime check that is useful during development and debugging but does incur some runtime costs. It can be practical to disable this for production builds.</p>
<h3 id="setvalidatelifetimes"><code>setValidateLifetimes()</code></h3>
<ul>
<li>Kotlin: <code>validateLifetimes</code></li>
<li>param: <code>validate: boolean</code></li>
</ul>
<p>True by default. This will ensure that behaviors are not linked to resources that may no longer be part of the graph (and vice versa).</p>
<p>Validating lifetimes is a runtime check that is useful during development and debugging but does incur some runtime costs. It can be practical to disable this for production builds.</p>
<h2 id="event">Event</h2>
<h3 id="getsequence"><code>getSequence()</code></h3>
<ul>
<li>Kotlin: <code>sequence</code></li>
<li>returns: <code>long</code></li>
<li><em>read only</em> property</li>
</ul>
<p>Each Event is assigned a monotonically increasing number for each event run on the graph.
You can use this information to quickly determine the order resources update.</p>
<h3 id="gettimestamp"><code>getTimestamp()</code></h3>
<ul>
<li>Kotlin: <code>timestamp</code></li>
<li>returns: <code>long</code></li>
<li><em>read only</em> property</li>
</ul>
<p>Each Event is given a timestamp according to the registered DateProvider given to a graph instance.
It defaults to <code>currentTimeMillis()</code>.</p>
<h2 id="moment-and-typedmomentt">Moment and TypedMoment<T></h2>
<p><em>extends Resource</em></p>
<p>A Moment is a type of Resource for tracking information that exists at a moment in time.
Button presses are examples of Moments.</p>
<p>TypedMoments are moments that have values associated with them.
A network call return would be a TypedMoment. The data returned from that call is a possible value.</p>
<h3 id="event-1"><code>event()</code></h3>
<ul>
<li>Kotlin: <code>event</code></li>
<li>returns <code>Event?</code></li>
<li><em>read only</em> property</li>
</ul>
<p>Returns the Event of the most recent time the moment was updated.
It is <code>null</code> if it has never been updated.</p>
<h3 id="justupdated"><code>justUpdated()</code></h3>
<ul>
<li>Kotlin: <code>justUpdated</code></li>
<li>returns: <code>boolean</code></li>
<li><em>read only</em> property</li>
</ul>
<p>Returns true if the moment updated during this event.</p>
<h3 id="justupdatedto"><code>justUpdatedTo()</code></h3>
<ul>
<li><em>TypedMoment only</em></li>
<li>param <code>value: T</code></li>
<li>returns <code>boolean</code></li>
</ul>
<p>Returns true if the moment was justUpdated and the value <code>.equals()</code> the parameter.
If you wish to use something different than <code>.equals()</code> you can implement your own check as this method is syntactic sugar.</p>
<h3 id="update"><code>update()</code></h3>
<ul>
<li><em>TypedMoment only</em> param <code>value: T</code></li>
</ul>
<p>Marks the moment as justUpdated.
If a value is provided, it will be set on the moment for reading.</p>
<h3 id="updatewithaction"><code>updateWithAction()</code></h3>
<ul>
<li><em>TypedMoment only</em> param <code>value: T | undefined</code></li>
<li>optional param <code>debugName : String?</code></li>
</ul>
<p>Syntactic sugar for calling <code>action()</code> on the underlying graph and calling <code>update()</code> on the moment.</p>
<h3 id="value"><code>value()</code></h3>
<ul>
<li><em>TypedMoment only</em></li>
<li>Kotlin: <code>value</code></li>
<li>returns <code>T</code></li>
<li><em>read only</em> property</li>
</ul>
<p>Returns the value stored in the TypedMoment if it was updated during this event.
Throws exception if the moment was not updated this event.</p>
<h2 id="resource-1">Resource</h2>
<p>The base class for State, Moment, and TypedMoment.
Prefer those types in almost all circumstances.
Wherever you see &ldquo;resource&rdquo; in this document, assume we are referring to instances of State and Moment and TypedMoment as well.</p>
<p>Resource has minimal functionality.
Using instances of this base class directly is useful when forcing a certain ordering relationship between behaviors.</p>
<h3 id="getdebugname-1"><code>getDebugName()</code></h3>
<ul>
<li>Kotlin: <code>debugName</code></li>
<li>returns <code>String?</code></li>
<li><em>read write</em> property</li>
</ul>
<p>Assignable name for use during debugging.</p>
<h3 id="getextent-1"><code>getExtent()</code></h3>
<ul>
<li>Kotlin: <code>extent</code></li>
<li>returns <code>Extent</code></li>
<li><em>read only</em> property</li>
</ul>
<p>All resources belong to an Extent.</p>
<h3 id="getgraph-1"><code>getGraph()</code></h3>
<ul>
<li>Kotlin: <code>graph</code></li>
<li>returns <code>Graph</code></li>
<li><em>read only</em> property</li>
</ul>
<p>All resources belong to a Graph.</p>
<h3 id="order"><code>order()</code></h3>
<ul>
<li>Kotlin: <code>order</code></li>
<li>returns <code>Demandable</code></li>
<li><em>read only</em> property</li>
</ul>
<p>A behavior can also demand <code>resource.order()</code> which tells the behavior not to activate when the resource updates.
All resource subclasses have this option as well.</p>
<h3 id="getsuppliedby"><code>getSuppliedBy()</code></h3>
<ul>
<li>Kotlin: <code>suppliedBy</code></li>
<li>returns <code>Behavior?</code></li>
<li><em>read only</em> property</li>
</ul>
<p>If the resource is supplied by a behavior it will be returned, null otherwise.</p>
<h2 id="statet-1">State<T></h2>
<p><em>extends Resource</em></p>
<p>A State is a type of resource for storing information over a period of time.
Its value will persist into the future until it is updated.</p>
<p>All States must be given an initial value when created.</p>
<h3 id="getevent"><code>getEvent()</code></h3>
<ul>
<li>Kotlin <code>event</code></li>
<li>returns <code>Event</code></li>
<li><em>read only</em> property</li>
</ul>
<p>The last time the State was updated.
Will return <code>Event.InitialEvent</code> for its initial value before it has been updated.</p>
<p>A behavior must demand or supply a state resource to access this property.</p>
<h3 id="justupdated-1"><code>justUpdated()</code></h3>
<ul>
<li>Kotlin <code>justUpdated</code></li>
<li>returns <code>boolean</code></li>
<li><em>read only</em> property</li>
</ul>
<p>Returns true if the state was updated during this event.</p>
<p>A behavior must demand or supply a state resource to access this property.</p>
<h3 id="justupdatedto-1"><code>justUpdatedTo()</code></h3>
<ul>
<li>param: <code>toState: T</code></li>
<li>returns: <code>boolean</code></li>
</ul>
<p>Returns true if the state was updated during this event and toState parameter <code>.equals()</code> value.</p>
<p>A behavior must demand or supply a state resource to access this property.</p>
<h3 id="justupdatedfrom"><code>justUpdatedFrom()</code></h3>
<ul>
<li>param: <code>fromState: T</code></li>
<li>returns: <code>boolean</code></li>
</ul>
<p>Returns true if the state was updated during this event and the fromState parameter <code>.equals()</code> the value it had before updating.</p>
<p>A behavior must demand or supply a state resource to access this property.</p>
<h3 id="justupdatedtofrom"><code>justUpdatedToFrom()</code></h3>
<ul>
<li>param: <code>toState: T</code></li>
<li>param: <code>fromState: T</code></li>
<li>returns: <code>boolean</code></li>
</ul>
<p>A combination of <code>justUpdatedTo()</code> and <code>justUpdatedFrom()</code></p>
<p>A behavior must demand or supply a state resource to access this property.</p>
<h3 id="traceevent"><code>traceEvent()</code></h3>
<ul>
<li>Kotlin: <code>traceEvent</code></li>
<li>returns: <code>Event</code></li>
<li><em>read only</em> property</li>
</ul>
<p>What was the value of the <code>event</code> property at the beginning of the current event.</p>
<p>A behavior <strong>does not</strong> need to demand or supply a resource to access this property.</p>
<h3 id="tracevalue"><code>traceValue()</code></h3>
<ul>
<li>Kotlin: <code>traceValue</code></li>
<li>returns: <code>T</code></li>
<li><em>read only</em> property</li>
</ul>
<p>What was the value of the <code>value</code> property at the beginning of the current event.</p>
<p>A behavior <strong>does not</strong> need to demand or supply a resource to access this property.</p>
<h3 id="updatewithaction-1"><code>updateWithAction()</code></h3>
<ul>
<li>param: <code>newValue: T</code></li>
<li>optional param: <code>debugName: String</code></li>
</ul>
<p>Equivalent to calling <code>action()</code> on the underlying Graph instance and <code>update()</code> on the State object.</p>
<h3 id="update-1"><code>update()</code></h3>
<ul>
<li>param: <code>newValue: T</code></li>
</ul>
<p>Checks to see if the newValue parameter <code>!equals()</code> the current value, and if so updates it to that new value.</p>
<p>A behavior must supply this resource in order to call this method.</p>
<p>State resources may also be updated inside an action if they are not supplied by any behavior.</p>
<h3 id="updateforce"><code>updateForce()</code></h3>
<ul>
<li>param: <code>newValue: T</code></li>
</ul>
<p>Updates value to the newValue even if they are <code>.equals()</code>.
This means that any demanding behaviors will be activated.</p>
<h3 id="value-1"><code>value()</code></h3>
<ul>
<li>Kotlin: <code>value</code></li>
<li>returns: <code>T</code></li>
<li><em>read only</em> property</li>
</ul>
<p>The current underlying value.</p>
<h1 id="interfaces">Interfaces</h1>
<h2 id="demandable">Demandable</h2>
<p>What a behavior can demand. A sealed opaque type which includes:</p>
<ul>
<li>Instances of Resource and its subclasses State and Moment</li>
<li>The object returned by <code>.order</code> on an instance of Resource</li>
</ul>
<p>There are no other Demandable types and it is not open for extension.</p>
<h2 id="dateprovider-1">DateProvider</h2>
<p>Optional override for default <code>dateProvier</code> on Graph instance.</p>
<p>Implement a type with a single method:</p>
<p><code>now(): long</code></p>
<p>The default implementation returns <code>currentTimeMillis()</code></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fac1ee0e7dbde78e1c81a6017bf959e1">4 - Tutorial 1 - Basics</h1>
    
	<p>Here we will introduce the essentials to get you started quickly using Behavior Graph.</p>
<p>The recommended way to get started is to use our <a href="https://replit.com/@slevin1/Behavior-Graph-Java-Tutorial-1?v=1">preconfigured tutorial site</a>.</p>
<p>If you prefer to set up your own environment please see the <a href="https://yahoo.github.io/bgdocs/docs/jvm/quickstart/">Getting Started page</a>.
Make sure to open up the Java console.
That is where we will generate our output.</p>
<h2 id="hello-world">Hello, World!</h2>
<p>Type in the following into the editor.
You will gain more by typing it, as it compels you to think about each line.</p>
<p>Inside the <code>Main.java</code> file add the following lines of code.
We&rsquo;ve created the basic outline for you.
(We&rsquo;ve combined both classes into the same file to simplify this tutorial.)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">behaviorgraph.*</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Main</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">static</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">main</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">[]</span> <span style="color:#000">args</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Graph</span> <span style="color:#000">g</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Graph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000">Extent</span> <span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">person</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Nobody&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">((</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello, &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;!&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addToGraphWithAction</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">action</span><span style="color:#ce5c00;font-weight:bold">(()</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;World&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span></span></span></code></pre></div>
<p>Run the code.
In the console you should see</p>
<pre tabindex="0"><code>&#34;Hello, World!&#34;
</code></pre><h3 id="the-parts">The Parts</h3>
<p>Let&rsquo;s review this in pieces.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">behaviorgraph.*</span><span style="color:#ce5c00;font-weight:bold">;</span></span></span></code></pre></div>
<p>This is a standard Java import.
You may need to adjust it depending on your Java environment which is beyond the scope of this tutorial.
Behavior Graph is available though <a href="https://search.maven.org/artifact/com.yahoo.behaviorgraph/bgjvm">Maven Central</a>.
See the <a href="https://yahoo.github.io/bgdocs/docs/jvm/quickstart/">Getting Started page</a> for more information.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">Graph</span> <span style="color:#000">g</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Graph</span><span style="color:#ce5c00;font-weight:bold">();</span></span></span></code></pre></div>
<p>We put our code directly in <code>main</code> to keep this tutorial simple.
You must create an instance of a <code>Graph</code>.
You may have more than one instance, but all Behavior Graph elements are associated with a specific instance.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">Extent</span> <span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">);</span></span></span></code></pre></div>
<p>Next we create an instance of an <code>Extent</code>.
Extents are collections of graph elements.
We will use it to create those elements.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">person</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Nobody&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span></span></span></code></pre></div>
<p><code>person</code> is a <strong>Resource</strong>.
Resources are containers for information.
This specifically is a <strong>State</strong> resource.
State resources contain persistent information, i.e. it may be used in the future.
You create state resources with the <code>.state()</code> factory method on an extent.
State resources always have an initial value.
Our <code>person</code> resource has an initial value of <code>&quot;Nobody&quot;</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">((</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello, &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;!&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>This is a <strong>Behavior</strong>.
Behaviors are units of functionality.
We create them with the <code>.behavior()</code> factory method on an extent that uses a fluent <a href="https://yahoo.github.io/bgdocs/docs/jvm/api/"><code>BehaviorBuilder</code></a> API.</p>
<p>This behavior has two parts.
The <code>.demands()</code> clause states that this behavior depends on the resource <code>person</code>.</p>
<p>The <code>.runs()</code> clause is the code that gets run whenever one (or more) of the demands is updated (has new information).
This one prints our greeting using <code>person.value()</code>.
The <code>.value()</code> property returns the contents of our <code>person</code> state resource.
A behavior must demand a resource in order to access its <code>.value()</code> property.</p>
<p>(Note: it can also access <code>.value()</code> if it <code>.supplies()</code> the resource as well which we will get to later.)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addToGraphWithAction</span><span style="color:#ce5c00;font-weight:bold">();</span></span></span></code></pre></div>
<p>We have a state resource and a behavior, but they are not part of the graph yet.
Calling <code>addToGraphWithAction()</code> takes all the elements that are part of this extent and makes them part of our behavior graph.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">action</span><span style="color:#ce5c00;font-weight:bold">(()</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;World&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>Here we create a new Action using <code>.action()</code> on our Graph instance.
Action blocks are how we introduce new information from the outside.
In this case, we are providing the person&rsquo;s name by calling <code>.update()</code> on our <code>person</code> state resource.</p>
<h3 id="how-it-works">How it works</h3>
<p>This call to <code>.action()</code> will start a series of steps.</p>
<ol>
<li>It will run the lambda given as a parameter.</li>
<li><code>person.update()</code> will tell the graph to mark any demanding behaviors as activated.
In this case there is the only one demanding behavior.</li>
<li>The anonymous function will complete.</li>
<li>The graph will call the <code>runs</code> block on the one activated behavior.</li>
<li>That runs block prints out &ldquo;Hello, World!&rdquo; by accessing the <code>.value()</code> of <code>person</code> which is the value we passed into the <code>.update()</code> method.</li>
<li>The <code>.action()</code> method completes and the program continues.</li>
</ol>
<p>All of these steps together make up a single Behavior Graph <strong>Event</strong>.</p>
<h2 id="doing-more">Doing More</h2>
<p>While this may seem like a tedious implementation of &ldquo;Hello, World&rdquo;, we have already established a foundation that will let this program grow to arbitrary complexity.
The computer can use these components to support us throughout the development process.</p>
<p>Let&rsquo;s introduce a second reason why we may need to print our greeting.</p>
<p><em>The highlighted lines will always be the new or updated lines</em></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">person</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Nobody&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">greeting</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Greetings&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">((</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;, &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;!&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>First we create a second state resource, <code>greeting</code>.
Then we add <code>greeting</code> as an additional demand.
We must add it as a demand because we access its <code>.value()</code> getter.
Behavior Graph will raise an error if we do not.
This explicitness is by design.
Finally we modify our message to use <code>greeting.value()</code>.</p>
<p>When we run our program now it should produce</p>
<pre tabindex="0"><code>&#34;Greetings, World!&#34;
</code></pre><p>If we want to get back to our original message we can add more to our action.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">action</span><span style="color:#ce5c00;font-weight:bold">(()</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;World&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>Now we have</p>
<pre tabindex="0"><code>&#34;Hello, World!&#34;
</code></pre><h3 id="multiple-updates">Multiple Updates</h3>
<p>This illustrates an important distinction between Behavior Graph and many reactive libraries.
Our behavior demands multiple resources.
That means whenever either <code>person</code> or <code>greeting</code> <strong>or both</strong> update our behavior should run.
However it doesn&rsquo;t run immediately, it is only <strong>activated</strong>.</p>
<p>Inside our action we update both <code>person</code> and <code>greeting</code>.
Our behavior that demands them will not run until the entire action block has completed.
All updates inside a single action are treated as if they happened at the same time.
This means our behavior runs only once.</p>
<p>We aren&rsquo;t required to update both just because we demand both.
State resources persist their value from action to action.
Let&rsquo;s add an additional action to see this.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">action</span><span style="color:#ce5c00;font-weight:bold">(()</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;World&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">action</span><span style="color:#ce5c00;font-weight:bold">(()</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Goodbye&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>Now in our console it should print</p>
<pre tabindex="0"><code>&#34;Hello, World!&#34;
&#34;Goodbye, World!&#34;
</code></pre><p>&ldquo;World&rdquo; persisted into the second event. While &ldquo;Goodbye&rdquo; replaced the previous greeting.</p>
<h2 id="moments">Moments</h2>
<p>Not all information persists.
Sometimes things just happen.
A button press is a typical example.
We can model this information with <strong>Moment</strong> resources.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">person</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Nobody&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">greeting</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Greetings&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#000">Moment</span> <span style="color:#000">button</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">button</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">((</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">button</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;, &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;!&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>First we create a <code>button</code> resource.
We create it with a <code>.moment()</code> factory method on our Extent instance.
Then we add it to our behavior&rsquo;s list of demands so it runs when <code>button</code> updates.</p>
<p>Inside our runs block, we&rsquo;ve gated our log statement by checking against <code>button.justUpdated()</code>.
This will be true only if some other part of our code called <code>button.update()</code> during the same event.</p>
<h3 id="press-the-button">Press the Button</h3>
<p>If you run the program now you will get no output.
This is because we only update the <code>person</code> and <code>greeting</code> resources and our <code>println</code> statement only runs when <code>button.justUpdated()</code> is true.</p>
<p>So lets add some additional lines to simulate a button press.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">action</span><span style="color:#ce5c00;font-weight:bold">(()</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;World&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Hello&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">action</span><span style="color:#ce5c00;font-weight:bold">(()</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Goodbye&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">action</span><span style="color:#ce5c00;font-weight:bold">(()</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">button</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>Now our program outputs:</p>
<pre tabindex="0"><code>&#34;Goodbye, World!&#34;
</code></pre><p>The first two actions only update the state resources.
Our behavior is run but the <code>if (button.justUpdated())</code> check prevents anything from happening.
The third action causes the behavior to run as well.
This time the <code>if</code> check passes and it logs the message based on prior updates.</p>
<p>Of course they don&rsquo;t need to be in separate actions.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">action</span><span style="color:#ce5c00;font-weight:bold">(()</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">button</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Nevermind&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>Will output:</p>
<pre tabindex="0"><code>&#34;Nevermind, World!&#34;
</code></pre><p>The message changed because both <code>button</code> updated as well as <code>greeting</code> in that same action.
The order in which they were updated inside the action is irrelevant to any demanding behaviors.
That&rsquo;s one of the main benefits of Behavior Graph, <strong>it let&rsquo;s you explicitly define when you do and do not care about sequencing</strong>.</p>
<h2 id="a-graph">A Graph</h2>
<p>With only one behavior, it is difficult to call it a behavior <em>graph</em>.
The real power of Behavior Graph comes with the ability to incrementally introduce related functionality.
Behaviors will often depend on information provided by other behaviors.</p>
<h3 id="supplies">Supplies</h3>
<p>Imagine, for security&rsquo;s sake, that we would like to introduce logging into our &ldquo;Hello, World&rdquo; program.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">Moment</span> <span style="color:#000">button</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">message</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">button</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">((</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;, &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;!&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">button</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We add a new state resource, <code>message</code>, to save the current message.
We add this resource to a new supplies clause of our behavior definition with <code>.supplies()</code>.
<strong>Supplies</strong> are resources that this behavior is solely responsible for.
It means that a behavior can both read a resource&rsquo;s <code>.value()</code> and <code>.update()</code> it as well.</p>
<p>We call <code>message.update()</code> with the text contents of the greeting to save them for later.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Rule</h4>

    <p>A resource can only be supplied by one behavior.
A behavior can supply multiple resources.
It is an error to call <code>.update()</code> on a resource inside a behavior if it does not appear in the supplies clause.</p>
<p>Actions can call <code>.update()</code> on a resource without specifying that they do so.
Actions cannot <code>.update()</code> a resource if it is also supplied by a behavior.</p>


</div>

<h3 id="logging-behavior">Logging Behavior</h3>
<p>We can introduce the logging functionality by adding an additional behavior.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">button</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">((</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Message changed to: &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>This new behavior demands <code>message</code>.
This means it will run whenever <code>message</code> updates.
Our output shows this result:</p>
<pre tabindex="0"><code>&#34;Message changed to: Hello, World!&#34;
&#34;Message changed to: Goodbye, World!&#34;
&#34;Nevermind, World!&#34;
&#34;Message changed to: Nevermind, World!&#34;
</code></pre><p>As you can see our new logging behavior runs and generates output each time the message changes.</p>
<h2 id="events">Events</h2>
<p>In Behavior Graph we call a single pass through the graph (from the start of an action to the last output) an <a href="https://yahoo.github.io/bgdocs/docs/jvm/api/#graphevent"><strong>Event</strong></a>.
Our current output is the result of three events.</p>
<p><strong>First Event:</strong></p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph LR
  a[&#34;Action:&lt;br /&gt;person=&gt;World&lt;br /&gt;greeting=&gt;Hello&#34;] --&gt; b[&#34;Behavior 1:&lt;br /&gt;message=&gt;Hello, World!&#34;] --&gt; c[&#34;Behavior 2:&lt;br /&gt;message change logged&#34;]
</code></pre><p><strong>Second Event:</strong></p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph LR
  a[&#34;Action:&lt;br /&gt;greeting=&gt;Goodbye&#34;] --&gt; b[&#34;Behavior 1:&lt;br /&gt;message=&gt;Goodbye, World!&#34;] --&gt; c[&#34;Behavior 2:&lt;br /&gt;message change logged&#34;]
</code></pre><p><strong>Third Event:</strong></p>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph LR
  a[&#34;Action:&lt;br /&gt;button updates&lt;br /&gt;greeting=&gt;Nevermind&#34;] --&gt; b[&#34;Behavior 1:&lt;br /&gt;message=&gt;Nevermind, World!&lt;br /&gt;message printed&#34;] --&gt; c[&#34;Behavior 2:&lt;br /&gt;message change logged&#34;]
</code></pre><h3 id="the-same-event">The Same Event</h3>
<p>Every time a resource is updated, it is assigned the current event.
So in the <strong>First Event</strong> example above, when <code>person</code> and <code>greeting</code> update, they get pointers to that same event in their <code>.event</code> property.
Then when <code>message</code> updates in the first behavior it also gets a pointer to this same event.</p>
<p>We can access this event inside any behavior that we demand (or supply).
This can use this to append a timestamp to our log messages.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">((</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Message changed to: &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34; at &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">event</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getTimestamp</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>You should now see something similar to the lines below</p>
<pre tabindex="0"><code>Message changed to: Hello, World! at 1662685021685
Message changed to: Goodbye, World! at 1662685021788
Nevermind, World!
Message changed to: Nevermind, World! at 1662685021789
</code></pre><h3 id="what-just-happened">What Just Happened?</h3>
<p>Using <code>.justUpdated()</code> is a powerful tool for organizing our code into related functionality.
We will add additional logging to see how this works.
First we will track when we send the message.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">message</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#000">Moment</span> <span style="color:#000">sentMessage</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">sentMessage</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">button</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">((</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;, &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;!&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">button</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#000">sentMessage</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We create a moment resource for <code>sentMessage</code>.
Sending the message is a one off, not state that persists, so we keep track of that with a moment.
We will be calling <code>.update()</code> on <code>sentMessage</code> so we need to add it to the list of supplies.
We call <code>sentMessage.update()</code> right after the <code>println</code> call to track when we actually print out our message.</p>
<p>Note that a behavior can supply more than one resource.
This is a common pattern that lets us group related logic together without having to jump through hoops to avoid duplication.</p>
<p>Next we modify our logging message to demand this additional resource.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">sentMessage</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">((</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Message changed to: &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34; at &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">event</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getTimestamp</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">sentMessage</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Message sent: &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34; at &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">sentMessage</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">event</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getTimestamp</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>This behavior now demands <code>sentMessage</code> which means it will run whenever that resource is updated.
Inside our run block we check to see which resource was updated and generate the correct log message.
It may be the case that either one or both is updated.</p>
<p>You will find yourself using this &ldquo;what just happened?&rdquo; pattern in many of your behaviors.</p>
<p>Running your program should looks like this:</p>
<pre tabindex="0"><code>Message changed to: Hello, World! at 1662687841592
Message changed to: Goodbye, World! at 1662687841693
Nevermind, World!
Message changed to: Nevermind, World! at 1662687841694
Message sent: Nevermind, World! at 1662687841694
</code></pre><h2 id="challenge">Challenge</h2>
<p>Can you introduce a single resource that turns on or off our newly added logging?
Try to do this challenge before looking at the answer.</p>
<p>Here&rsquo;s some hints:</p>
<ul>
<li>Try adding a state resource.</li>
<li>You&rsquo;ll need to demand it in a behavior and introduce some additional logic.</li>
</ul>
<h3 id="answer">Answer</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">Moment</span> <span style="color:#000">sentMessage</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Boolean</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">loggingEnabled</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">sentMessage</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">button</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">((</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;, &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">person</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34;!&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">button</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">sentMessage</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">sentMessage</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">loggingEnabled</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">((</span><span style="color:#000">ext</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">loggingEnabled</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Message changed to: &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34; at &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">event</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getTimestamp</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">sentMessage</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">System</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">out</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">println</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Message sent: &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#4e9a06">&#34; at &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">sentMessage</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">event</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">getTimestamp</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>          
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p><code>loggingEnabled</code> is our new resource.
We want it to persist so we use a state resource.
It defaults to <code>true</code> meaning logging is on.</p>
<p>We then need to demand it inside our logging behavior in order to access its <code>.value</code> property.
If we try to access <code>.value</code> without demanding it, Behavior Graph will raise an error.</p>
<p>We can modify our last action to see it work.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">action</span><span style="color:#ce5c00;font-weight:bold">(()</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">button</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">greeting</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Nevermind&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">loggingEnabled</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>After adding this additional line, running our code looks like this.</p>
<pre tabindex="0"><code>Message changed to: Hello, World! at 1662688113911
Message changed to: Goodbye, World! at 1662688114015
Nevermind, World!
</code></pre><p>We no longer log the last two messages because logging was turned off in the same action.
Notice how even though <code>loggingEnabled.update(false)</code> comes after our updates, we still disable logging for the same event.
If you were to do this without Behavior Graph, using status quo method calls and property updates, you would need to ensure that <code>loggingEnabled</code> changes to <code>false</code> <em>before</em> the other updates.
It would be a different result if you updated it <em>after</em>.
<em>The ability to remove the hidden complexity that comes with sequencing is a programming superpower.</em>
Behavior Graph gives you this feature for free.</p>
<h3 id="ordering-resources">Ordering Resources</h3>
<p>You may notice that although <code>loggingEnabled</code> is a demand, we don&rsquo;t actually need it to to be a reason for our logging behavior to run.
We only need to check its <code>.value</code>.
Behavior Graph lets us lighten this constraint.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">message</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">sentMessage</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">loggingEnabled</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">order</span><span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(()</span> <span style="color:#ce5c00;font-weight:bold">=&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">loggingEnabled</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">message</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span></span></span></code></pre></div>
<p>We can add <code>.order</code> to any resource inside our demands clause.
When we do this, updating that resource will not activate this behavior.
This can give us some additional accuracy when specifying how our behaviors are linked.</p>
<h2 id="complete">Complete</h2>
<p>Congratulations! You have completed this first tutorial.
You can see the <a href="https://replit.com/@slevin1/Behavior-Graph-Java-Tutorial-1#Main.java_completed">finished tutorial code here</a> in the <code>Main.java_completed</code> file.</p>
<p>While you may feel that there were many new concepts introduced, we have already covered the majority of them.
You will find they come naturally with some practice.
The remaining tutorials give you a taste for how Behavior Graph works inside real interactive programs.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-909a12945f3d5c13544a2ba04f6be058">5 - Tutorial 2 - IO</h1>
    
	<p>This tutorial will show how Behavior Graph interacts with real inputs and outputs to produce a working application.
In this case we will build the control system for a thermostat, the device in your house that controls the heat.</p>
<p><img src="/bgdocs/docs/images/thermostat-ui.png" alt="Thermostat"></p>
<p>This simplified thermostat has two buttons, <strong>Up</strong> and <strong>Down</strong> for raising and lowering the desired temperature.
It also periodically gets external updates of the current temperature.
If the desired temperature is above the current temperature, we will turn on the heat.
And once they are the same, the heat will turn off.</p>
<h2 id="initial-code">Initial Code</h2>
<p>The recommended way to get started is to use our <a href="https://replit.com/@slevin1/Behavior-Graph-Java-Tutorial-2?v=1">preconfigured tutorial site</a>.</p>
<p>You should use that for this tutorial.</p>
<p>It has some existing Swing code to represent the Thermostat&rsquo;s user interface.
If you wish to use your own environment you will need to copy the three <code>.java</code> files from our tutorial site.</p>
<p>The initial setup code has been provided for you.
There is a <code>Main.java</code> which creates the core objects.
There is also a <code>TutorialUI.java</code> file which contains the Swing UI code.
(It is just simple enough to let us explore Behavior Graph features.
Do not use it as an ideal example of a Swing application).</p>
<p>The bulk of our application will exist inside our <code>Thermostat.java</code> file. It contains a subclass of <code>Extent</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">behaviorgraph.Extent</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">behaviorgraph.Graph</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">behaviorgraph.Moment</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">behaviorgraph.State</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Thermostat</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Thermostat</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">TutorialUI</span> <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">Thermostat</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Graph</span> <span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">TutorialUI</span> <span style="color:#000">uiParam</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ui</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">uiParam</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span></span></span></code></pre></div>
<p>Note here that we subclass Extent.
In the previous tutorial we used an Extent instance directly.
The standard approach is to build your application out of Extent subclasses like we do here.</p>
<p>Also note that Extent takes a type parameter of our subclass.
In this case it is <code>Thermostat</code>.
This gives us a more convenient API to work with.
You should follow this in your own subclasses.</p>
<p>We also store a reference to the user interface object passed in to our constructor.</p>
<h2 id="desired-temperature">Desired Temperature</h2>
<p>The first part of our logic will focus on setting the desired temperature.
The related elements look something like this.</p>
<p><img src="/bgdocs/docs/images/thermostat-temp.svg" alt="Desired Temperature"></p>
<p>First we need a state resource to track our desired temperature and a behavior to supply it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Thermostat</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Thermostat</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Integer</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">desiredTemperature</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">60</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">Thermostat</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Graph</span> <span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">TutorialUI</span> <span style="color:#000">uiParam</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ui</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">uiParam</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#8f5902;font-style:italic">// desired temperature logic will go here
</span></span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#8f5902;font-style:italic"></span>      <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span></span></span></code></pre></div>
<p>We create a <code>desiredTemperature</code> property and initialize it using the <code>state()</code> factory method on <code>Extent</code> which we subclass. <code>desiredTemperature</code> is a state resource with an initial value of 60.
It has a generic type of <code>Integer</code>.
(Remember that Java can only do generic on object types, but it will do autoboxing for us.)
We want a state resource because it is information we intend to use in the future.
Our new behavior supplies this resource because we plan on calling <code>desiredTemperature.update()</code> inside the runs block.</p>
<h3 id="button-presses">Button Presses</h3>
<p>Our thermostat will need to respond to the button press events that come from our Swing UI buttons.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Thermostat</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Thermostat</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">TutorialUI</span> <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Integer</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">desiredTemperature</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">60</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">Moment</span> <span style="color:#000">up</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span></span></span></code></pre></div>
<p>We create an <code>up</code> moment resource to track when the Up button is pressed.
It is a <strong>Moment</strong> resource type (as opposed to <strong>State</strong>) because we are tracking a one off event, the pressing of a button.
It is no longer relevent once we&rsquo;ve finished responding to it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">Thermostat</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Graph</span> <span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">TutorialUI</span> <span style="color:#000">uiParam</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ui</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">uiParam</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">upButton</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addActionListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#000">up</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span></span></span></code></pre></div>
<p>Then we use standard Swing functionality to respond to the button click action.
We call <code>up.updateWithAction()</code> to track this event in our moment resource.</p>
<p><code>.updateWithAction()</code> is syntactic sugar for creating a new action and calling <code>.update()</code>.
It is the same as if we typed this instead:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">upButton</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addActionListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">action</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">up</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<h3 id="responding-to-the-button">Responding to the Button</h3>
<p>We need to modify our behavior to respond to this update.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">up</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">up</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">1</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We add <code>up</code> to our list of demands.
This ensures that this behavior activates whenever <code>up</code> is updated.
Inside the run block we check for <code>.justUpdated()</code>.
If so, we update the <code>desiredTemperature</code> by incrementing it from its previous <code>.value()</code>.</p>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">Access Rules</h4>

    <ol>
<li>You can only access <code>.justUpdated()</code> inside behaviors that demand (or supply) that resource.
Otherwise Behavior Graph will raise an error.</li>
<li>You can only access <code>.value()</code> inside behaviors that demand (or supply) that resource.
Otherwise Behavior Graph will raise an error.</li>
<li>You can only call <code>.update()</code> inside a behavior that supplies that resource.
A resource can only be supplied by one behavior.
Behavior Graph will raise an error if you do this incorrectly.</li>
</ol>


</div>

<p>These rules are essential to allowing Behavior Graph to ensure your resources are always in a consistent state.</p>
<h3 id="output">Output</h3>
<p>At this point our <code>desiredTemperature</code> changes when you press the Up button.
But we don&rsquo;t update the display, yet.</p>
<p>We will add that here.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">up</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">up</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">1</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">desiredTemp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">toString</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>This behavior creates a <strong>Side Effect</strong> block.
Inside that block we use standard Swing methods to update the temperature.
Now if you run this and click on the Up button you will see the temperature field appear and increment.</p>
<p>Side effects are the correct way to generate output from inside a behavior.
Although a side effect is created inside a behavior, it will only run after all other behaviors have completed running.
This ensures that all our internal state has settled before calling code that may potentially access it.</p>
<p>Side effects do not have a restriction on what resources they can access, unlike the behavior in which they are defined.</p>
<h3 id="down">Down</h3>
<p>We can handle our Down button in a similar way.
We add a <code>down</code> moment to track the button.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Thermostat</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Thermostat</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">TutorialUI</span> <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Integer</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">desiredTemperature</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">60</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">Moment</span> <span style="color:#000">up</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">Moment</span> <span style="color:#000">down</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span></span></span></code></pre></div>
<p>Then a Swing listener to create an action.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">upButton</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addActionListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">up</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">downButton</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addActionListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#000">down</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>And modify our behavior to respond.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">up</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">down</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">up</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">1</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">down</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">1</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span></span></span></code></pre></div>
<p>Note that we added <code>down</code> to the list of demands.
And we added additional logic to decrement our desired temperature when the down button is pressed.</p>
<p>Run the program.
Clicking on the Up and Down buttons should now move the desired temperature display up and down.</p>
<h3 id="run-when-added">Run when Added</h3>
<p>You may have noticed that the desired temperature display doesn&rsquo;t show up until after we&rsquo;ve tapped on one of the buttons.
This is because our behavior only runs when one of its demands is updated.
What we would like to do is also run it once at the beginning.</p>
<p>The <code>getDidAdd()</code> method on extent returns a special resource associated with that extent.
We add it to our list of demands.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">.</span><span style="color:#000">supplies</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">desiredTemperature</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#000;font-weight:bold">.</span><span style="color:#000">demands</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">up</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">down</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000;font-weight:bold">.</span><span style="color:#000">runs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">up</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">justUpdated</span><span style="color:#000;font-weight:bold">())</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">desiredTemperature</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">update</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">desiredTemperature</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">);</span></span></span></code></pre></div>
<p>Now when you run the code you will see that the temperature also appears at the beginning.</p>
<p><code>getDidAdd()</code> is a getter method on Extent (which we subclass). It returns a <code>State&lt;Boolean&gt;</code> resource that becomes <code>true</code> during the event that the extent is added to the graph. We add this resource to our list of demands.
So our behavior will also run once at the beginning.</p>
<p><code>getDidAdd()</code> returns a normal resource.
You can use it anywhere in your behavior&rsquo;s logic as well, such as checking <code>getDidAdd().justUpdated()</code> to customize your logic.</p>
<h2 id="heat">Heat</h2>
<p>Now we need to introduce a separate bit of functionality to control the heating equipment.
This logic compares the current temperature to the desired temperature and turns on or off the heating equipment accordingly.</p>
<p><img src="/bgdocs/docs/images/thermostat-heat.svg" alt="Current Temperature"></p>
<h3 id="current-temperature">Current Temperature</h3>
<p>First we need a state resource to track the current temperature,</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Integer</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">desiredTemperature</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">60</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Integer</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">currentTemperature</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">60</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">Moment</span> <span style="color:#000">up</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span></span></span></code></pre></div>
<p>and a new behavior to update the UI when that resource updates.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">desiredTemp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">toString</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">currentTemperature</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">currentTemp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">currentTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">toString</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>Like with <code>desiredTemperature</code> this behavior runs whenever <code>currentTemperature</code> updates as well as once when it is added.
It uses a side effect to update our Swing UI.</p>
<h3 id="heat-on">Heat On</h3>
<p>Next we need a resource to track if the heat is on or not.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Integer</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">currentTemperature</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">60</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Boolean</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">heatOn</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">Moment</span> <span style="color:#000">up</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">moment</span><span style="color:#ce5c00;font-weight:bold">();</span></span></span></code></pre></div>
<p>By default the <code>heatOn</code> state resource is <code>false</code> indicating that it is off.</p>
<p>Now we want to add another behavior to determine if the heat is on.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">currentTemp</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">currentTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">toString</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">heatOn</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">currentTemperature</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">on</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">currentTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">heatOn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">on</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>This new behavior is responsible for updating <code>heatOn</code> so we add it as a supply.
It uses both <code>currentTemperature</code> and <code>desiredTemperature</code> for its logic, so both are demands.
When it runs, it updates <code>heatOn</code> to true if our <code>currentTemperature</code> is too low.</p>
<h3 id="heat-display">Heat Display</h3>
<p>We want our display to update alongside the <code>heatOn</code>.
So we add that logic to our new behavior.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">heatOn</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">currentTemperature</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">boolean</span> <span style="color:#000">on</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">desiredTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">currentTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">heatOn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">on</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">heatStatus</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Heat &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">heatOn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">?</span> <span style="color:#4e9a06">&#34;On&#34;</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Off&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We demand <code>getDidAdd()</code> to ensure we update the display when the thermostat starts.
We also add a side effect to update the UI.</p>
<p>Run it. Now when you click the Up and Down buttons you should see the heating display change based on <code>desiredTemperature</code> changes.</p>
<h3 id="heating-equipment">Heating Equipment</h3>
<p>In a real thermostat, whenever <code>heatOn</code> changes, we would send a signal to real heating equipment somewhere else in the house.
Since we don&rsquo;t have that available, we will simulate our own heat and demonstrate how we can mix in other asynchronous elements.</p>
<p>We&rsquo;ll add a new behavior.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">heatStatus</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Heat &#34;</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">heatOn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">?</span> <span style="color:#4e9a06">&#34;On&#34;</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Off&#34;</span><span style="color:#ce5c00;font-weight:bold">));</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">heatOn</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">heatOn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdatedTo</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#8f5902;font-style:italic">// turn heat on
</span></span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">heatOn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdatedTo</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#ce5c00;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#8f5902;font-style:italic">// turn heat off
</span></span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>This new behavior responds to <code>heatOn</code> updates.
It uses <code>.justUpdatedTo()</code> to differentiate changing to true or false.</p>
<p>At this point we want to make an important point about the way state resources work.
Even though the behavior that supplies <code>heatOn</code> calls <code>.update()</code> every time it runs, it doesn&rsquo;t necessarily update the state resource.
Inside <code>.update()</code>, Behavior Graph uses <code>.equals()</code> to check if the new value is different from the starting value.
If they are the same, the state resource does not actually update.
Therefore, demanding behaviors are not activated.</p>
<p>As an example, if <code>heatOn.value()</code> is currently <code>false</code>, calling <code>heatOn.update(true)</code> will update the resource and activate demanding behaviors. However, if in the next event we also call <code>heatOn.update(true)</code>, Behavior Graph will see that it is already <code>true</code> and therefore will not actually update or activate demanding behaviors.</p>
<h4 id="turning-on">Turning On</h4>
<p>We aren&rsquo;t controlling actual heating equipment.
But our ThermostatUI object has some API to simulate this functionality by gradually increasing our heat over time.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">heatOn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdatedTo</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#ce5c00;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">turnOnHeat</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">effect</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>              <span style="color:#000">currentTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">currentTemperature</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">1</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">heatOn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdatedTo</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#ce5c00;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">{</span></span></span></code></pre></div>
<p>This branch creates a side effect which calls a heating API.
In this case the API starts a timer and makes callbacks to our provided lambda.</p>
<p>When the timer fires, we create an <strong>action</strong> to bring new information into Behavior Graph.
In this case, the new information is that <code>currentTemperature</code> has increased by 1.</p>
<p>Note we are accessing <code>currentTemperature.value()</code> outside of a behavior.
Unlike many reactive frameworks, this is fine.
We maintain the integrity of our state by manipulating control flow, not by restricting access.</p>
<h4 id="turning-off">Turning Off</h4>
<p>If you run this program now, the heat will start incrementing but it won&rsquo;t stop once the heat turns off.
We will add an additional side effect for this.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">heatOn</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdatedTo</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#ce5c00;font-weight:bold">))</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">e</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">ui</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">turnOffHeat</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">}</span></span></span></code></pre></div>
<p>This side effect calls our API which cancels the timer when the heat turns off.</p>
<p>Now run the code and turn the desired temperature up a few degrees from the current temperature and wait.
You will see the current temperature slowly increase until they equal and the heat will turn off.</p>
<h2 id="behavior-graph-programming">Behavior Graph Programming</h2>
<p>This code is typical Behavior Graph programming style.
The path we went through to get here is typical of the Behavior Graph programming process.
The important step is learning how to organize code into behaviors.</p>
<h3 id="control-flow-for-free">Control Flow for Free</h3>
<p>Behaviors are never called directly, which can feel like a lack of control.
This is a fair intuition, but also incorrect.
Behavior Graph improves our ability to express the intent of our code.
We do not think in terms of &ldquo;do this now&rdquo;.
Instead we think, &ldquo;here are the reasons why this should run&rdquo;.</p>
<p>Behavior Graph determines the behavior that should run next based on which behaviors have been activated and their dependencies.
A behavior that may influence another behavior will always run first.</p>
<p>Looking a the behaviors in our Thermostat program and their linked resources we can figure out exactly how things will run.
Here&rsquo;s the sequence of steps when we click the Up button.</p>
<ol>
<li>Action: <code>up.update()</code>, activate Behavior 1</li>
<li>Behavior 1: <code>desiredTemperature.update(61)</code>, activate Behavior 2, create Side Effect 1</li>
<li>Behavior 2: <code>heatOn.update(true)</code>, activate Behavior 3, create Side Effect 2</li>
<li>Behavior 3: create Side Effect 3</li>
<li>Side Effect 1: <code>desiredTemperature</code> Swing label&rsquo;s text changes to &ldquo;61&rdquo;</li>
<li>Side Effect 2: <code>heatStatus</code> Swing label&rsquo;s text changes to &ldquo;Heat On&rdquo;</li>
<li>Side Effect 3: Create simulated &ldquo;heating&rdquo; timer</li>
</ol>
<p>The status quo approach of organizing around method calls leaves us open to potential errors as dependencies change.
With Behavior Graph, if we introduce a new dependency for Behavior 1, the rest of the control flow adapts.
Everything will continue to run in the correct order.
This is Behavior Graph doing the work for you.</p>
<h3 id="incremental-adoption">Incremental Adoption</h3>
<p>Behavior Graph is not the solution to all programming problems.
It is a tool for structuring the event driven logic portion of your software.
Feel free to use it as much or as little as you like.</p>
<p>When introducing it incrementally to an exiting codebase, it is easiest to work back from the output.</p>
<ol>
<li>Find a place were you update the UI, start an animation, or make a network call.</li>
<li>Wrap that up in a side effect inside a behavior.</li>
<li>Then figure out what new information should cause that behavior to run.</li>
<li>Turn that information into resources.</li>
<li>Either update those resources inside action blocks or write new behaviors to supply them.</li>
<li>Repeat.</li>
</ol>
<h2 id="congratulations">Congratulations</h2>
<p>Congratulations! You have completed the second tutorial.
You can see the <a href="https://replit.com/@slevin1/Behavior-Graph-Java-Tutorial-2#Thermostat.java_completed">finished tutorial code here</a>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c4acf1226b172bb0f4dcbd476150b87a">6 - Tutorial 3 - Extents</h1>
    
	<p>In this tutorial we will create a simple todo list.</p>
<p><img src="/bgdocs/docs/images/todolist.png" alt="Todo List"></p>
<p>A todo list is interesting because it has user interface elements with <strong>independent lifetimes</strong>.
When we start, our list is empty.
The visible interface elements are the header for adding new items and a footer for the remaining items.
After we click Save, a new item will appear with a checkbox for completing it, and a button for deleting it.
The list as a whole has a longer lifetime than the individual items.</p>
<p>We will implement this by adding and removing Extents from the graph as we add and remove items from our list.
This is a powerful and practical technique that gives Behavior Graph a unique expressiveness in the state management realm.</p>
<h2 id="initial-code">Initial Code</h2>
<p>The recommended way to get started is to use our <a href="https://replit.com/@slevin1/Behavior-Graph-Java-Tutorial-3?v=1">preconfigured tutorial site</a>.</p>
<p>It has some simple Swing code to represent the Todo List&rsquo;s user interface.
If you wish to use your own environment you will need to copy the java files from this project to your environment.</p>
<p><code>Main.java</code> sets up the project, creates the Graph, ListExtent, and UI objects.</p>
<p><code>ListUI.java</code> and <code>ItemUI.java</code> contain the majority of the Swing code we will use to interact with the UI.</p>
<p><code>ListExtent.java</code> will contain the logic for the whole list. We&rsquo;ve created the stub for you. It uses the Extent subclass pattern.</p>
<p><code>ItemExtent.java</code> will contain logic for each item.</p>
<h2 id="adding-items">Adding Items</h2>
<p><em>New code for you to add or modify will always be highlighted.</em></p>
<p>We&rsquo;ll start off by adding logic for adding a new item inside <code>ListExtent.java</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">ListExtent</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ListExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">TypedMoment</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">save</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">typedMoment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">ListExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Graph</span> <span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">ListUI</span> <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addActionListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">actionEvent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">newItemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getText</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#8f5902;font-style:italic">// add item here
</span></span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#8f5902;font-style:italic"></span>      <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span></span></span></code></pre></div>
<p>We create a <code>save</code> moment resource to model the interaction of clicking on the Save button after typing in something into the input box.
This moment is a <code>TypedMoment</code>, however.
These model the same temporary interactions as moments, but they carry additional information.
Our <code>save</code> moment will have a <code>String</code> value in which we will store the text of the new todo list item.</p>
<p>We use a normal Swing action listener logic to call <code>save.updateWithAction()</code> when the button it pressed.
Into it we pass the contents of the input field.</p>
<p>Next we create an empty behavior, demanding the <code>save</code> resource.
When <code>save</code> is updated, we want this behavior to create a list item and update the UI.</p>
<h3 id="what-is-an-item">What is an Item?</h3>
<p>A typical way to represent a list item is to create a data structure or object with the relevant data.
We can do something similar with a second Extent subclass, <code>ItemExtent</code> which we will define in <code>ItemExtent.java</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">ItemExtent</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">ListExtent</span> <span style="color:#000">list</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">ItemUI</span> <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">itemText</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Graph</span> <span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">inText</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">ListExtent</span> <span style="color:#000">inList</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">inList</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">itemUI</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemUI</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">itemText</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">inText</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span></span></span></code></pre></div>
<p>The starter template contains much of this already.</p>
<p>We define a new <code>ItemExtent</code> subclass and pass in some information into its constructor.</p>
<ol>
<li>A required <code>Graph</code> instance</li>
<li>A pointer to the parent <code>ListExtent</code> instance which we will use later</li>
<li>The text of the new todo list item which we will store in an <code>itemText</code> state resource using the initial value</li>
</ol>
<h3 id="creating-an-itemextent">Creating an ItemExtent</h3>
<p>Now that we have a basic <code>ItemExtent</code> defined, we can create one back in our <code>ListExtent</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">var</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">addChildLifetime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addToGraph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We check if the <code>save</code> button was clicked via <code>save.justUpdated()</code>.
If so, we create the new item with the contents of the text field, <code>save.value()</code>.
Then we call <code>.addChildLifetime(item)</code>.
This lets Behavior Graph know that our <code>ListExtent</code> instance will always be around longer than any individual <code>ItemExtent</code>.
We will see more on lifetimes later.</p>
<p>Next we call <code>item.addToGraph()</code>.
Adding an extent to the graph is a necessary step.
Until we do this, any behaviors or resources in that extent will not perform their expected roles.</p>
<h3 id="collecting-the-items">Collecting the Items</h3>
<p>We also need a way to keep track of these items as they are added.
First we add a state resource to hold these individual items.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">ListExtent</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ListExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">TypedMoment</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">save</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">typedMoment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ArrayList</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">allItems</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ArrayList</span><span style="color:#ce5c00;font-weight:bold">&lt;&gt;());</span></span></span></code></pre></div>
<p><code>allItems</code> is a state resource initialized with an empty ArrayList.</p>
<p>Next we modify our saving behavior to update this list.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">var</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">addChildLifetime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addToGraph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateForce</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We add a <code>.supplies()</code> clause which includes <code>allItems</code> because we will be updating it inside this behavior.
Whenever we create a new item we will append that <code>ItemExtent</code> instance to the end of its ArrayList via its <code>.value()</code> property and the built in <code>.add()</code> method.
It is typical when working with extents that come and go to store them in a state resource or a collection inside a state resource.</p>
<p>Lastly, we call <code>.updateForce()</code> with the same array list instance.
<code>.updateForce()</code> says, I don&rsquo;t care if what I&rsquo;m putting in here is the same as it was before, I still want you to notify any demanding behaviors.</p>
<p>We cannot just call <code>.update()</code> because even though the contents of the array list have changed, it is still the same array list instance.
<code>.update()</code> automatically filters out updates when the old value <code>.equals()</code> the new value.
This is usually what we want, but sometimes we need something different.
<code>.updateForce()</code> works identically but ignores this equality check.
This is a common pattern when storing mutable collections inside a resource.</p>
<h3 id="updating-the-ui">Updating the UI</h3>
<p>Adding an item still doesn&rsquo;t update the UI to match.
Inside our <code>ItemExtent</code> we already created an instance <code>ItemUI</code> which contains the Swing code for an individual item.</p>
<p>So now we need to tell our list ui object about this new component.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addToGraph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateForce</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addItem</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemUI</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">newItemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We create a side effect because we are making external changes.
This side effect calls <code>.addItem()</code> which just inserts the item into the correct place in the view heirarchy.
It also clears the text field so we can add additional items.</p>
<p>Run it.
Try adding some items by typing in the box and clicking Save.
It seems to add items but we only see empty text.</p>
<p>We can fix that by using a <code>getDidAdd()</code> built in resource.</p>
<p>Inside <code>ItemExtent.java</code> we create a new behavior.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">itemUI</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemUI</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">itemText</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">inText</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemText</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>Looking at the <code>demands()</code> clause we can see this behavior will run when the <code>ItemExtent</code> is added to the graph and whenever <code>itemText</code> changes.
The side effect tells the UI label to update to the correct text.
Now running our code and adding a few items will show our list correctly.</p>
<h3 id="completing-items">Completing Items</h3>
<p>There&rsquo;s a checkbox to complete a todo list item.
Checking it at this point does nothing.
Let&rsquo;s fix that.</p>
<p>Inside <code>ItemExtent</code> we&rsquo;ll add a new state resource to track if an item is completed.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#000">ItemUI</span> <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">itemText</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Boolean</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">completed</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Graph</span> <span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">inText</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">ListExtent</span> <span style="color:#000">inList</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span></span></span></code></pre></div>
<p>Then inside our constructor</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">itemUI</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemUI</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">itemText</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">inText</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">completed</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">completedCheckbox</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addItemListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemEvent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#000">completed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemEvent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getStateChange</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">ItemEvent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">SELECTED</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We initialize our <code>completed</code> state resource which defaults to false.
We also use standard Swing API to connect the checkbox element to an action which will update our state resource.</p>
<p>(Note, you may prefer to design your UI classes with more or less encapsulation.
There are many approaches.
Our goal here is to keep behavior graph related functionality together so it is easier to see.)</p>
<p>And we add an additional behavior inside <code>ItemExtent</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>          <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">completed</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCompleted</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">completed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>This behavior creates a side effect which updates the UI with our completed state.
This uses the Swing API&rsquo;s to strike-through a completed todo item.
We also include <code>getDidAdd()</code> as an additional demand.
It is not strictly necessary at this point because all todo items start off as not completed.
However, it is good practice to use it in behaviors that generate side effects to reflect the current state.
If we were to introduce functionality later for saving and restoring todo lists, we may have items that start in a completed state.</p>
<p>Running this and checking/unchecking todo list items should update the UI accordingly.</p>
<h2 id="dynamic-behaviors">Dynamic Behaviors</h2>
<p>We will now introduce functionality that takes advantage of Behavior Graph&rsquo;s ability to dynamically adjust demands and supplies.</p>
<h3 id="remaining-items">Remaining Items</h3>
<p>The &ldquo;Remaining Items&rdquo; footer of the UI does not update currently.
First we need it to respond when adding items.</p>
<p>Inside <code>ListExtent</code> we add a new behavior.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-javascript" data-lang="javascript"><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#000">demands</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#000">runs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">sideEffect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">allItems</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">itemExtent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">itemExtent</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">completed</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">()).</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">listUI</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">setRemainingCount</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000;font-weight:bold">});</span></span></span></code></pre></div>
<p>This behavior will create a side effect to update the remaining items text at the bottome to match the current number of non-completed items in the list.
<code>allItems</code> is a demand because we want to run it whenever we add a new item to the list.
<code>getDidAdd()</code> is also a demand because we want it to run once at the beginning.
Inside the side effect we use some logic to count the items whose <code>.value</code> of their <code>completed</code> state resource is true.</p>
<p>Now try adding a few items to the list and you will see the remaining items count increment.</p>
<h3 id="updating-remaining-items">Updating Remaining Items</h3>
<p>If you try to complete an item however our remaining items count does not change.
This is because our new behavior does not demand the <code>completed</code> resource from our <code>ItemExtent</code> instances.
So it won&rsquo;t run when they change.
However, we cannot just add it inside the list of demands because the set of <code>ItemExtent</code> instances changes over time.</p>
<p>Behaviors have another clause for handling these situations.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">dynamicDemands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Demandable</span><span style="color:#ce5c00;font-weight:bold">[]</span> <span style="color:#ce5c00;font-weight:bold">{</span> <span style="color:#000">allItems</span> <span style="color:#ce5c00;font-weight:bold">},</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">demands</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ItemExtent</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">demands</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">completed</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">stream</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">filter</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemExtent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">itemExtent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">completed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()).</span><span style="color:#c4a000">count</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setRemainingCount</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">count</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p><code>.dynamicDemands()</code> is another clause when creating a behavior that lets you specify an additional list of demands that can change.
It takes two parameters.
The first is an array of resources (Specifically <code>Demandable</code> which is an interface resources implement).
Whenever any of those update, it will run the anonymous function in the second parameter.
That function includes a <code>demands</code> ArrayList parameter to which we can add any additional demands this behavior should have.</p>
<p>Here our dynamic demands clause will add the <code>completed</code> resource from each <code>ItemExtent</code> instance.
So each time we add a new item, our behavior will adapt so that it will run when the <code>completed</code> resource for that item updates.</p>
<p>Now try running the code.
You will see that adding new items updates the remaining items count.
And you will see that checking and unchecking the box on those items affects the remaining count as well.</p>
<h3 id="remaining-items-revisited">Remaining Items Revisited</h3>
<p>Its worth a little extra effort to consider what we just did.
The <em>entire</em> remaining items feature is defined by this single behavior.</p>
<p>Let&rsquo;s compare this with a status quo implementation: methods, properties, and objects.
First we might have a method similar to our run block to update the UI</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// Hypothetical Code -- Don&#39;t type this in
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">updateRemainingCount</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">stream</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">filter</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemExtent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">itemExtent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">completed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()).</span><span style="color:#c4a000">count</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setRemainingCount</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">count</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><p>That seems reasonable, but its not enough.
We need to go inside another method somewhere else in this same class to ensure this gets called when we add a new item.
Perhaps it might look like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// Hypothetical Code -- Don&#39;t type this in
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">saveButtonPressed</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">text</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">var</span> <span style="color:#000">save</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Item</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">text</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateRemainingCount</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><p>Ok, so the &ldquo;Remaining Count&rdquo; feature is in two places.
That&rsquo;s manageable.
Unfortunately, to handle completing, we still need to call in from another place in the code inside the Item class.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// Hypothetical Code -- Don&#39;t type this in
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">completeChecked</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">checked</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">completed</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">checked</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">list</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateRemainingCount</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><p>Now our feature is spread across multiple classes.
And when we add a way to remove items we will need to involve another code-path.
This type of spread out logic is a real challenge for developers.
It is incredibly easy to miss a case.
Most developers are swimming in control flows like this.</p>
<p>But, as we said above, the Behavior Graph implementation combines the remaining count functionality into a single block of code.
Behavior Graph lets us collect the &ldquo;what&rdquo; <em>and</em> the &ldquo;why&rdquo; together in the same behavior.</p>
<h2 id="deleting-items">Deleting Items</h2>
<p>We also have a Delete button on each list item which does nothing currently.
We will fix that now.</p>
<p>Inside <code>ItemExtent</code> we add some button click handling.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>      <span style="color:#000">completed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemEvent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getStateChange</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">ItemEvent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">SELECTED</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemDelete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addActionListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">actionEvent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#000">list</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">removeItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemText</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#ce5c00;font-weight:bold">())</span></span></span></code></pre></div>
<p>This handles a Swing event and updates the <code>removeItem</code> resource on <code>ListExtent</code> (which we haven&rsquo;t added yet).
It is common to interact with resources on other extents.
Here we are saying, &ldquo;this list item is requesting to be removed.&rdquo;</p>
<p>Note that each <code>ItemExtent</code>&rsquo;s Delete button updates the same <code>list.removeItem</code> resource.
We are allowed to update resources from multiple actions because only one action will happen during a single event.</p>
<p>Now, inside <code>ListExtent</code> we add our <code>removeItem</code> resource,</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ArrayList</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">allItems</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ArrayList</span><span style="color:#ce5c00;font-weight:bold">&lt;&gt;());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">TypedMoment</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">removeItem</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">typedMoment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">ListExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Graph</span> <span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">ListUI</span> <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">);</span></span></span></code></pre></div>
<p>It is a <code>TypedMoment</code> because it models something happening once (a button press) and we want to transmit which <code>ItemExtent</code> we want to remove.</p>
<p>And next we will modify the behavior that maintains <code>allItems</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">removeItem</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">var</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">addChildLifetime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addToGraph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateForce</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addItem</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemUI</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">newItemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">removeItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">var</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">removeItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">removeFromGraph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">remove</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateForce</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>              <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">removeItem</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemUI</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>First we add <code>removeItem</code> as an additional demand on our <code>allItems</code> behavior.
This causes the behavior to run when a user clicks on a Delete button.</p>
<p>It is common to refer to behaviors by the resources they supply.
This is because a behavior uniquely supplies those resources.
In this case we call this the <code>allItems</code> behavior.</p>
<p>We are modifying this behavior because removing an item affects the list in <code>allItems</code>.
We could not put this logic in another behavior because a resource can only be supplied by one behavior.
Updating a resource can only happen in the one behavior that supplies it.</p>
<p>Inside the runs block we add a new check for <code>removeItem.justUpdated()</code>.
It is a common pattern to iterate through <code>.justUpdated()</code> checks of the various demands to determine what happened.</p>
<p>Then we get the <code>ItemExtent</code> we want removed and remove it from our <code>allItems</code> list.
We need to call <code>.forceUpdate()</code> again because we are mutating the same instance of our list.
Also note that we call<code>.removeFromGraph()</code> on the removed <code>ItemExtent</code>.
Extents should always be removed from the graph if they are no longer needed otherwise their behaviors will continue to run.
Lastly our side effect ensures that the UI updates as well.</p>
<h3 id="remaining-items-re-revisited">Remaining Items Re-revisited</h3>
<p>You may also notice that the remaining items count now goes down if you remove an item that hasn&rsquo;t been completed yet.
We get this for free because we defined the remaining items on the <code>allItems</code> list.
If we were just using method calls to implement delete, we very likely would have removed the item from our list directly and then had to remember to call some <code>updateRemainingCount()</code> which could have easily been forgotten.</p>
<p>This ability to make changes without introducing additional complexity is a hallmark of programming with Behavior Graph.
Once you&rsquo;ve experienced it a few times you will find it difficult to give up.</p>
<h2 id="editing">Editing</h2>
<p>Now we will introduce some editing functionality.
This will cover some additional uses of dynamic behaviors.
We will allow the user to click on a particular todo list item to select it.
While selected, the user can edit the text inside the main text field.</p>
<h3 id="selecting">Selecting</h3>
<p>The first step is to use a Swing event to identify when we have selected a particular item.</p>
<p>Inside <code>ItemExtent</code> add another handler.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemDelete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addActionListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">actionEvent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">list</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">removeItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addMouseListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">MouseAdapter</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#5c35cc;font-weight:bold">@Override</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">mouseClicked</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">MouseEvent</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">list</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p><code>selectRequest</code> (which is a resource we haven&rsquo;t yet added on our <code>ListExtent</code>) updates with the list item that was clicked as its <code>.value()</code>. (<code>ItemExtent.this</code> let&rsquo;s us point to the outer <code>this</code>, not the <code>MouseAdapter</code> <code>this</code>.)</p>
<p>Inside <code>ListExtent</code> we add the related resources and a corresponding behavior.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ArrayList</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">allItems</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ArrayList</span><span style="color:#ce5c00;font-weight:bold">&lt;&gt;());</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">TypedMoment</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">removeItem</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">typedMoment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">TypedMoment</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">selectRequest</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">typedMoment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">selected</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">);</span></span></span></code></pre></div>
<p>We have two resrouces. <code>selectRequest</code> was the list item we clicked on.
<code>selected</code> is the list item that is currently selected.
<code>null</code> means we have no selected item.</p>
<p>Next we add a behavior that updates <code>selected</code> based on which item we clicked on.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>Clicking on an item sets our new <code>selected</code> resource as the item that was just clicked.
Although we can&rsquo;t tell it is working yet.</p>
<h3 id="selected">Selected</h3>
<p>Now we want our items to visually reflect when they are selected.
We can do this by demanding this resource in a behavior in each item.
Add the following code inside <code>ItemExtent</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>          <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCompleted</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">completed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">list</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">selected</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">var</span> <span style="color:#000">selected</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">list</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSelected</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>When the <code>selected</code> state resource inside <code>ListExtent</code> updates, this behavior on every item will run.
They each demand <code>list.selected</code>.
Each one will check to see if it is the one selected and we change the UI accordingly.</p>
<p>We want to refer back to the beginning where we called <code>.addChildLifetime(item)</code> inside <code>ListExtent</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemExtent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">save</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">addChildLifetime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">item</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">addToGraph</span><span style="color:#000;font-weight:bold">();</span></span></span></code></pre></div>
<p>This line says that the list will always be around when the item is.
This gives us permission to add <code>list.selected</code>, a resource in <code>ListExtent</code>, as a demand on the behavior inside each <code>ItemExtent</code>.
Behavior Graph ensures that we don&rsquo;t link to resources that may no longer be part of the graph and it uses lifetimes as a way to manage that.</p>
<p>You can now try out this code by clicking on different items.</p>
<p>Notice that we can take a list of many items and click on different ones and watch it switch.
Each time, one of those behaviors calls the Swing UI logic to change the background color.</p>
<h3 id="deselect">Deselect</h3>
<p>Its easy enough to introduce deselecting by clicking on the already selected element.</p>
<p>Inside <code>ListExtent</code> we modify our <code>selected</code> behavior.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>              <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We check if the currently selected item is the one that was just clicked on and set it to <code>null</code> in that case.
This communicates that nothing should be selected.
Try running now and clicking on an item multiple times.</p>
<p>That was too easy.
You don&rsquo;t need to make space for new control flow.
This is because of the way behavior Behavior Graph functionality composes.</p>
<h3 id="updating-the-text-field">Updating The Text Field</h3>
<p>Now we want to introduce editing.
Let&rsquo;s try updating the main text field when we select an item so we can edit it.
Continuing to edit our <code>selected</code> behavior in <code>ListExtent</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>              <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSelected</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>Whenever <code>selected</code> updates, we run this new side effect.
It copies over the text of the item into the text field.
It also updates the UI to indicate that we are editing and not adding.
Conversely, when <code>selected</code> updates to <code>null</code>, it puts our UI state back to an Add mode.</p>
<p>In many reactive libraries, a reactive block of code can only output the new state.
Any downstream effects need to be somewhere else.
With Behavior Graph we can mutate our state and create any related side effects in the same block of code.</p>
<p>Run the program and you will see how selecting an item updates the header to an editing mode.</p>
<h3 id="preventing-adding">Preventing Adding</h3>
<p>When we are in editing mode, the save button should cause the text in our item to update.
However right now it will still create a new item.
We want to prevent that from happening when we are in editing mode.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">removeItem</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">traceValue</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">var</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">addChildLifetime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addToGraph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span></span></span></code></pre></div>
<p>At the time we click the Save button, we want to know if we are in editing mode or not.
We could check <code>selected.value()</code> to see if it is null (ie not editing).
However, here we use <code>selected.traceValue()</code> instead.
<code>.traceValue()</code> is the value of the resource <em>at the beginning of the graph event</em> (the instant the action started).
So if <code>selected</code> updates this event, <code>.traceValue()</code> will still return what it was before it changed.</p>
<p>This also removes the requirement that we demand <code>selected</code> in this behavior.
Here we care if an item is &ldquo;already selected&rdquo;, not that something was &ldquo;just selected&rdquo;.
So we don&rsquo;t need it as a demand.
<code>.traceValue()</code> of any resource is always accessible by any behavior without demanding (or supplying) it.</p>
<p>The <code>if</code> check ignores the <code>save</code> click when there&rsquo;s something already selected.</p>
<h3 id="making-changes">Making Changes</h3>
<p>Now we can add a new behavior inside <code>ListExtent</code> that responds to our save and updates the text of the selected item.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSelected</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">dynamicSupplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Demandable</span><span style="color:#ce5c00;font-weight:bold">[]</span> <span style="color:#ce5c00;font-weight:bold">{</span> <span style="color:#000">allItems</span> <span style="color:#ce5c00;font-weight:bold">},</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">supplies</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ItemExtent</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">supplies</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemText</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">})</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">traceValue</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">traceValue</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">itemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>This new behavior uses <code>.dyanmicSupplies()</code>.
This is a clause we haven&rsquo;t seen before.
It works similarly to <code>.dynamicDemands()</code>.
In this behavior, we update our supplies to be the <code>itemText</code> resource from each <code>ItemExtent</code> instance.
Whenever we add our remove an item, this behavior will adjust to include or remove the corresponding <code>itemText</code> state resource.</p>
<p>We will supply all of them because any one of them might become selected.
When the user clicks the Save button, this behavior will update the <code>itemText</code> on the selected item to whats inside the text field.</p>
<p>Notice that we use <code>selected.traceValue()</code> again here, so it is not part of the demands.
We want which item was selected at the time <code>save</code> was updated (as opposed to after we&rsquo;re done saving).
We also do not need this behavior to run when <code>selected</code> updates.</p>
<p>Notice that all we do is update <code>itemText</code>.
We already have a behavior that knows how to change that UI when we change the text.
It is common to make these kinds of changes and see everything work as expected.</p>
<p>Run the code and you will see your working todo list.</p>
<h2 id="challenge">Challenge</h2>
<p>After saving our changes, the item remains selected.
It might be a better user experience to exit editing mode after saving.
Can you implement this?</p>
<p>Try your best before looking at the answer.</p>
<p>Hints:</p>
<ol>
<li>You can do this by modifying a single behavior.</li>
<li>Which behavior is responsible for <code>selected</code>?</li>
<li>Which resource updates when we click the Save button?</li>
</ol>
<h3 id="answer-clearing-post-save">Answer: Clearing Post Save</h3>
<p>We can modify our <code>selected</code> behavior inside <code>ListExtent</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span></span></span></code></pre></div>
<p>Now our <code>selected</code> behavior also runs and deselects the current item when the Save button is pressed.
Here see again the common pattern of checking various resources&rsquo; <code>.justUpdated()</code> inside a behavior.</p>
<p>Just before adding this feature we used <code>selected.traceValue</code> in a few behaviors.
This change here is an additional motivation for that.
If we used <code>selected.value</code> in those behaviors it means they would demand <code>selected</code> which is supplied by this behavior.
Which means they would run <em>after</em> this behavior.
Which means by they time they ran, <code>selected.value</code> would be null.
We don&rsquo;t want what <code>selected</code> changes to, we want what it was at the start.
This is what <code>traceValue</code> provides.</p>
<h2 id="congratulations">Congratulations</h2>
<p>Congratulations! You have completed the third tutorial.
You can see the <a href="https://replit.com/@slevin1/Behavior-Graph-JVM-Tutorial-3#Completed/ListExtent.java_completed">finished tutorial code here</a>.</p>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Yahoo All Rights Reserved</small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>


<script src="https://cdn.jsdelivr.net/npm/mermaid@8.13.4/dist/mermaid.min.js" integrity="sha512-JERecFUBbsm75UpkVheAuDOE8NdHjQBrPACfEQYPwvPG+fjgCpHAz1Jw2ci9EXmd3DdfiWth3O3CQvcfEg8gsA==" crossorigin="anonymous"></script>




<script src='/bgdocs/docs/js/tabpane-persist.js'></script>


















<script src="/bgdocs/docs/js/main.min.5502966e44e76d09efb092d4e61f653fa0b492b7bc6e75bab1ce6752810dde8d.js" integrity="sha256-VQKWbkTnbQnvsJLU5h9lP6C0kre8bnW6sc5nUoEN3o0=" crossorigin="anonymous"></script>




  </body>
</html>
