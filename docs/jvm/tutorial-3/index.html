<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.97.3" />
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="/bgdocs/docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/bgdocs/docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/bgdocs/docs/favicons/android-192x192.png" sizes="192x192">

<title>Tutorial 3 - Extents | Behavior Graph</title>
<meta name="description" content="In this tutorial we will create a simple todo list.

A todo list is interesting because it has user interface elements with independent lifetimes. â€¦">
<meta property="og:title" content="Tutorial 3 - Extents" />
<meta property="og:description" content="In this tutorial we will create a simple todo list.
A todo list is interesting because it has user interface elements with independent lifetimes. When we start, our list is empty. The visible interface elements are the header for adding new items and a footer for the remaining items. After we click Save, a new item will appear with a checkbox for completing it, and a button for deleting it. The list as a whole has a longer lifetime than the individual items." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yahoo.github.io/bgdocs/docs/jvm/tutorial-3/" /><meta property="article:section" content="jvm" />

<meta property="article:modified_time" content="2022-10-05T16:08:24-07:00" /><meta property="og:site_name" content="Behavior Graph" />

<meta itemprop="name" content="Tutorial 3 - Extents">
<meta itemprop="description" content="In this tutorial we will create a simple todo list.
A todo list is interesting because it has user interface elements with independent lifetimes. When we start, our list is empty. The visible interface elements are the header for adding new items and a footer for the remaining items. After we click Save, a new item will appear with a checkbox for completing it, and a button for deleting it. The list as a whole has a longer lifetime than the individual items.">
<meta itemprop="dateModified" content="2022-10-05T16:08:24-07:00" />
<meta itemprop="wordCount" content="4037">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Tutorial 3 - Extents"/>
<meta name="twitter:description" content="In this tutorial we will create a simple todo list.
A todo list is interesting because it has user interface elements with independent lifetimes. When we start, our list is empty. The visible interface elements are the header for adding new items and a footer for the remaining items. After we click Save, a new item will appear with a checkbox for completing it, and a button for deleting it. The list as a whole has a longer lifetime than the individual items."/>




<link rel="preload" href="/bgdocs/docs/scss/main.min.209ee91954d0f2f182770e6c71011a5580360636bcf2a9bcf7f1c3da478784ff.css" as="style">
<link href="/bgdocs/docs/scss/main.min.209ee91954d0f2f182770e6c71011a5580360636bcf2a9bcf7f1c3da478784ff.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-page">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/bgdocs/docs/">
		<span class="navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="font-weight-bold">Behavior Graph</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"></div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            
<div id="td-sidebar-menu" class="td-sidebar__inner">
  <form class="td-sidebar__search d-flex align-items-center">
    
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-bgdocsdocs-li">
  <a href="/bgdocs/docs/" title="Behavior Graph" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-bgdocsdocs"><span class="">Documentation</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-bgdocsdocsjs-and-typescript-li">
  <a href="/bgdocs/docs/js-and-typescript/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-bgdocsdocsjs-and-typescript"><span class="">JS and Typescript</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-bgdocsdocsjs-and-typescriptquickstart-li">
  <a href="/bgdocs/docs/js-and-typescript/quickstart/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsjs-and-typescriptquickstart"><span class="">Getting Started</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-bgdocsdocsjs-and-typescriptcode-example-li">
  <a href="/bgdocs/docs/js-and-typescript/code-example/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsjs-and-typescriptcode-example"><span class="">Code Example</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-bgdocsdocsjs-and-typescriptapi-li">
  <a href="/bgdocs/docs/js-and-typescript/api/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsjs-and-typescriptapi"><span class="">API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-bgdocsdocsjs-and-typescripttutorial-1-li">
  <a href="/bgdocs/docs/js-and-typescript/tutorial-1/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsjs-and-typescripttutorial-1"><span class="">Tutorial 1 - Basics</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-bgdocsdocsjs-and-typescripttutorial-2-li">
  <a href="/bgdocs/docs/js-and-typescript/tutorial-2/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsjs-and-typescripttutorial-2"><span class="">Tutorial 2 - IO</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-bgdocsdocsjs-and-typescripttutorial-3-li">
  <a href="/bgdocs/docs/js-and-typescript/tutorial-3/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsjs-and-typescripttutorial-3"><span class="">Tutorial 3 - Extents</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-bgdocsdocsjvm-li">
  <a href="/bgdocs/docs/jvm/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-bgdocsdocsjvm"><span class="">JVM and Android</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-bgdocsdocsjvmquickstart-li">
  <a href="/bgdocs/docs/jvm/quickstart/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsjvmquickstart"><span class="">Getting Started</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-bgdocsdocsjvmcode-example-li">
  <a href="/bgdocs/docs/jvm/code-example/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsjvmcode-example"><span class="">Code Example</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-bgdocsdocsjvmapi-li">
  <a href="/bgdocs/docs/jvm/api/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsjvmapi"><span class="">API</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-bgdocsdocsjvmtutorial-1-li">
  <a href="/bgdocs/docs/jvm/tutorial-1/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsjvmtutorial-1"><span class="">Tutorial 1 - Basics</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-bgdocsdocsjvmtutorial-2-li">
  <a href="/bgdocs/docs/jvm/tutorial-2/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsjvmtutorial-2"><span class="">Tutorial 2 - IO</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-bgdocsdocsjvmtutorial-3-li">
  <a href="/bgdocs/docs/jvm/tutorial-3/" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsjvmtutorial-3"><span class="td-sidebar-nav-active-item">Tutorial 3 - Extents</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-bgdocsdocsrelatedwork-li">
  <a href="/bgdocs/docs/relatedwork/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsrelatedwork"><span class="">Related Work</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-bgdocsdocsquestions-li">
  <a href="/bgdocs/docs/questions/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-bgdocsdocsquestions"><span class="">Questions and Feedback</span></a>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a id="print" href="https://yahoo.github.io/bgdocs/docs/jvm/_print/"><i class="fa fa-print fa-fw"></i> Print entire section</a>

</div>

            


<div class="td-toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#initial-code">Initial Code</a></li>
    <li><a href="#adding-items">Adding Items</a>
      <ul>
        <li><a href="#what-is-an-item">What is an Item?</a></li>
        <li><a href="#creating-an-itemextent">Creating an ItemExtent</a></li>
        <li><a href="#collecting-the-items">Collecting the Items</a></li>
        <li><a href="#updating-the-ui">Updating the UI</a></li>
        <li><a href="#completing-items">Completing Items</a></li>
      </ul>
    </li>
    <li><a href="#dynamic-behaviors">Dynamic Behaviors</a>
      <ul>
        <li><a href="#remaining-items">Remaining Items</a></li>
        <li><a href="#updating-remaining-items">Updating Remaining Items</a></li>
        <li><a href="#remaining-items-revisited">Remaining Items Revisited</a></li>
      </ul>
    </li>
    <li><a href="#deleting-items">Deleting Items</a>
      <ul>
        <li><a href="#remaining-items-re-revisited">Remaining Items Re-revisited</a></li>
      </ul>
    </li>
    <li><a href="#editing">Editing</a>
      <ul>
        <li><a href="#selecting">Selecting</a></li>
        <li><a href="#selected">Selected</a></li>
        <li><a href="#deselect">Deselect</a></li>
        <li><a href="#updating-the-text-field">Updating The Text Field</a></li>
        <li><a href="#preventing-adding">Preventing Adding</a></li>
        <li><a href="#making-changes">Making Changes</a></li>
      </ul>
    </li>
    <li><a href="#challenge">Challenge</a>
      <ul>
        <li><a href="#answer-clearing-post-save">Answer: Clearing Post Save</a></li>
      </ul>
    </li>
    <li><a href="#congratulations">Congratulations</a></li>
  </ul>
</nav></div>



            

	
		
			
				
			
			



  
  

		
			
				
			
			



  
  

		
	

          </aside>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="https://yahoo.github.io/bgdocs/docs/jvm/">JVM and Android</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">
    <a href="https://yahoo.github.io/bgdocs/docs/jvm/tutorial-3/">Tutorial 3 - Extents</a>
  </li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>Tutorial 3 - Extents</h1>
	
	<header class="article-meta">
		

  
    
      


    
      


    
  

		
	</header>    
	<p>In this tutorial we will create a simple todo list.</p>
<p><img src="/bgdocs/docs/images/todolist.png" alt="Todo List"></p>
<p>A todo list is interesting because it has user interface elements with <strong>independent lifetimes</strong>.
When we start, our list is empty.
The visible interface elements are the header for adding new items and a footer for the remaining items.
After we click Save, a new item will appear with a checkbox for completing it, and a button for deleting it.
The list as a whole has a longer lifetime than the individual items.</p>
<p>We will implement this by adding and removing Extents from the graph as we add and remove items from our list.
This is a powerful and practical technique that gives Behavior Graph a unique expressiveness in the state management realm.</p>
<h2 id="initial-code">Initial Code</h2>
<p>The recommended way to get started is to use our <a href="https://replit.com/@slevin1/Behavior-Graph-Java-Tutorial-3?v=1">preconfigured tutorial site</a>.</p>
<p>It has some simple Swing code to represent the Todo List&rsquo;s user interface.
If you wish to use your own environment you will need to copy the java files from this project to your environment.</p>
<p><code>Main.java</code> sets up the project, creates the Graph, ListExtent, and UI objects.</p>
<p><code>ListUI.java</code> and <code>ItemUI.java</code> contain the majority of the Swing code we will use to interact with the UI.</p>
<p><code>ListExtent.java</code> will contain the logic for the whole list. We&rsquo;ve created the stub for you. It uses the Extent subclass pattern.</p>
<p><code>ItemExtent.java</code> will contain logic for each item.</p>
<h2 id="adding-items">Adding Items</h2>
<p><em>New code for you to add or modify will always be highlighted.</em></p>
<p>We&rsquo;ll start off by adding logic for adding a new item inside <code>ListExtent.java</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">ListExtent</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ListExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">TypedMoment</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">save</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">typedMoment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">ListExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Graph</span> <span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">ListUI</span> <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addActionListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">actionEvent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">newItemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getText</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#8f5902;font-style:italic">// add item here
</span></span></span><span style="display:flex; background-color:#dfdfdf"><span><span style="color:#8f5902;font-style:italic"></span>      <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span></span></span></code></pre></div>
<p>We create a <code>save</code> moment resource to model the interaction of clicking on the Save button after typing in something into the input box.
This moment is a <code>TypedMoment</code>, however.
These model the same temporary interactions as moments, but they carry additional information.
Our <code>save</code> moment will have a <code>String</code> value in which we will store the text of the new todo list item.</p>
<p>We use a normal Swing action listener logic to call <code>save.updateWithAction()</code> when the button it pressed.
Into it we pass the contents of the input field.</p>
<p>Next we create an empty behavior, demanding the <code>save</code> resource.
When <code>save</code> is updated, we want this behavior to create a list item and update the UI.</p>
<h3 id="what-is-an-item">What is an Item?</h3>
<p>A typical way to represent a list item is to create a data structure or object with the relevant data.
We can do something similar with a second Extent subclass, <code>ItemExtent</code> which we will define in <code>ItemExtent.java</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">ItemExtent</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">ListExtent</span> <span style="color:#000">list</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">ItemUI</span> <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">itemText</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Graph</span> <span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">inText</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">ListExtent</span> <span style="color:#000">inList</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">list</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">inList</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">itemUI</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemUI</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">itemText</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">inText</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span></span></span></code></pre></div>
<p>The starter template contains much of this already.</p>
<p>We define a new <code>ItemExtent</code> subclass and pass in some information into its constructor.</p>
<ol>
<li>A required <code>Graph</code> instance</li>
<li>A pointer to the parent <code>ListExtent</code> instance which we will use later</li>
<li>The text of the new todo list item which we will store in an <code>itemText</code> state resource using the initial value</li>
</ol>
<h3 id="creating-an-itemextent">Creating an ItemExtent</h3>
<p>Now that we have a basic <code>ItemExtent</code> defined, we can create one back in our <code>ListExtent</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">var</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">addChildLifetime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addToGraph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We check if the <code>save</code> button was clicked via <code>save.justUpdated()</code>.
If so, we create the new item with the contents of the text field, <code>save.value()</code>.
Then we call <code>.addChildLifetime(item)</code>.
This lets Behavior Graph know that our <code>ListExtent</code> instance will always be around longer than any individual <code>ItemExtent</code>.
We will see more on lifetimes later.</p>
<p>Next we call <code>item.addToGraph()</code>.
Adding an extent to the graph is a necessary step.
Until we do this, any behaviors or resources in that extent will not perform their expected roles.</p>
<h3 id="collecting-the-items">Collecting the Items</h3>
<p>We also need a way to keep track of these items as they are added.
First we add a state resource to hold these individual items.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">ListExtent</span> <span style="color:#204a87;font-weight:bold">extends</span> <span style="color:#000">Extent</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ListExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">TypedMoment</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">save</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">typedMoment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ArrayList</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">allItems</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ArrayList</span><span style="color:#ce5c00;font-weight:bold">&lt;&gt;());</span></span></span></code></pre></div>
<p><code>allItems</code> is a state resource initialized with an empty ArrayList.</p>
<p>Next we modify our saving behavior to update this list.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">var</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">addChildLifetime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addToGraph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateForce</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We add a <code>.supplies()</code> clause which includes <code>allItems</code> because we will be updating it inside this behavior.
Whenever we create a new item we will append that <code>ItemExtent</code> instance to the end of its ArrayList via its <code>.value()</code> property and the built in <code>.add()</code> method.
It is typical when working with extents that come and go to store them in a state resource or a collection inside a state resource.</p>
<p>Lastly, we call <code>.updateForce()</code> with the same array list instance.
<code>.updateForce()</code> says, I don&rsquo;t care if what I&rsquo;m putting in here is the same as it was before, I still want you to notify any demanding behaviors.</p>
<p>We cannot just call <code>.update()</code> because even though the contents of the array list have changed, it is still the same array list instance.
<code>.update()</code> automatically filters out updates when the old value <code>.equals()</code> the new value.
This is usually what we want, but sometimes we need something different.
<code>.updateForce()</code> works identically but ignores this equality check.
This is a common pattern when storing mutable collections inside a resource.</p>
<h3 id="updating-the-ui">Updating the UI</h3>
<p>Adding an item still doesn&rsquo;t update the UI to match.
Inside our <code>ItemExtent</code> we already created an instance <code>ItemUI</code> which contains the Swing code for an individual item.</p>
<p>So now we need to tell our list ui object about this new component.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addToGraph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateForce</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addItem</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemUI</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">newItemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We create a side effect because we are making external changes.
This side effect calls <code>.addItem()</code> which just inserts the item into the correct place in the view heirarchy.
It also clears the text field so we can add additional items.</p>
<p>Run it.
Try adding some items by typing in the box and clicking Save.
It seems to add items but we only see empty text.</p>
<p>We can fix that by using a <code>getDidAdd()</code> built in resource.</p>
<p>Inside <code>ItemExtent.java</code> we create a new behavior.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">itemUI</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemUI</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">itemText</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">inText</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemText</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>Looking at the <code>demands()</code> clause we can see this behavior will run when the <code>ItemExtent</code> is added to the graph and whenever <code>itemText</code> changes.
The side effect tells the UI label to update to the correct text.
Now running our code and adding a few items will show our list correctly.</p>
<h3 id="completing-items">Completing Items</h3>
<p>There&rsquo;s a checkbox to complete a todo list item.
Checking it at this point does nothing.
Let&rsquo;s fix that.</p>
<p>Inside <code>ItemExtent</code> we&rsquo;ll add a new state resource to track if an item is completed.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#000">ItemUI</span> <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">String</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">itemText</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">Boolean</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">completed</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Graph</span> <span style="color:#000">g</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">String</span> <span style="color:#000">inText</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">ListExtent</span> <span style="color:#000">inList</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span></span></span></code></pre></div>
<p>Then inside our constructor</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">itemUI</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemUI</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">itemText</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">inText</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">completed</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">completedCheckbox</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addItemListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemEvent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#000">completed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemEvent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getStateChange</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">ItemEvent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">SELECTED</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We initialize our <code>completed</code> state resource which defaults to false.
We also use standard Swing API to connect the checkbox element to an action which will update our state resource.</p>
<p>(Note, you may prefer to design your UI classes with more or less encapsulation.
There are many approaches.
Our goal here is to keep behavior graph related functionality together so it is easier to see.)</p>
<p>And we add an additional behavior inside <code>ItemExtent</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>          <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">completed</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCompleted</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">completed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>This behavior creates a side effect which updates the UI with our completed state.
This uses the Swing API&rsquo;s to strike-through a completed todo item.
We also include <code>getDidAdd()</code> as an additional demand.
It is not strictly necessary at this point because all todo items start off as not completed.
However, it is good practice to use it in behaviors that generate side effects to reflect the current state.
If we were to introduce functionality later for saving and restoring todo lists, we may have items that start in a completed state.</p>
<p>Running this and checking/unchecking todo list items should update the UI accordingly.</p>
<h2 id="dynamic-behaviors">Dynamic Behaviors</h2>
<p>We will now introduce functionality that takes advantage of Behavior Graph&rsquo;s ability to dynamically adjust demands and supplies.</p>
<h3 id="remaining-items">Remaining Items</h3>
<p>The &ldquo;Remaining Items&rdquo; footer of the UI does not update currently.
First we need it to respond when adding items.</p>
<p>Inside <code>ListExtent</code> we add a new behavior.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-javascript" data-lang="javascript"><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#000">demands</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000;font-weight:bold">.</span><span style="color:#000">runs</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">sideEffect</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">allItems</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">stream</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">filter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">itemExtent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">itemExtent</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">completed</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">()).</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">listUI</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">setRemainingCount</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">count</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000;font-weight:bold">});</span></span></span></code></pre></div>
<p>This behavior will create a side effect to update the remaining items text at the bottome to match the current number of non-completed items in the list.
<code>allItems</code> is a demand because we want to run it whenever we add a new item to the list.
<code>getDidAdd()</code> is also a demand because we want it to run once at the beginning.
Inside the side effect we use some logic to count the items whose <code>.value</code> of their <code>completed</code> state resource is true.</p>
<p>Now try adding a few items to the list and you will see the remaining items count increment.</p>
<h3 id="updating-remaining-items">Updating Remaining Items</h3>
<p>If you try to complete an item however our remaining items count does not change.
This is because our new behavior does not demand the <code>completed</code> resource from our <code>ItemExtent</code> instances.
So it won&rsquo;t run when they change.
However, we cannot just add it inside the list of demands because the set of <code>ItemExtent</code> instances changes over time.</p>
<p>Behaviors have another clause for handling these situations.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">dynamicDemands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Demandable</span><span style="color:#ce5c00;font-weight:bold">[]</span> <span style="color:#ce5c00;font-weight:bold">{</span> <span style="color:#000">allItems</span> <span style="color:#ce5c00;font-weight:bold">},</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">demands</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ItemExtent</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">demands</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">completed</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">stream</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">filter</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemExtent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">itemExtent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">completed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()).</span><span style="color:#c4a000">count</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setRemainingCount</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">count</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p><code>.dynamicDemands()</code> is another clause when creating a behavior that lets you specify an additional list of demands that can change.
It takes two parameters.
The first is an array of resources (Specifically <code>Demandable</code> which is an interface resources implement).
Whenever any of those update, it will run the anonymous function in the second parameter.
That function includes a <code>demands</code> ArrayList parameter to which we can add any additional demands this behavior should have.</p>
<p>Here our dynamic demands clause will add the <code>completed</code> resource from each <code>ItemExtent</code> instance.
So each time we add a new item, our behavior will adapt so that it will run when the <code>completed</code> resource for that item updates.</p>
<p>Now try running the code.
You will see that adding new items updates the remaining items count.
And you will see that checking and unchecking the box on those items affects the remaining count as well.</p>
<h3 id="remaining-items-revisited">Remaining Items Revisited</h3>
<p>Its worth a little extra effort to consider what we just did.
The <em>entire</em> remaining items feature is defined by this single behavior.</p>
<p>Let&rsquo;s compare this with a status quo implementation: methods, properties, and objects.
First we might have a method similar to our run block to update the UI</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// Hypothetical Code -- Don&#39;t type this in
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">updateRemainingCount</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">long</span> <span style="color:#000">count</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">stream</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">filter</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemExtent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">itemExtent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">completed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()).</span><span style="color:#c4a000">count</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setRemainingCount</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">count</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><p>That seems reasonable, but its not enough.
We need to go inside another method somewhere else in this same class to ensure this gets called when we add a new item.
Perhaps it might look like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// Hypothetical Code -- Don&#39;t type this in
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">saveButtonPressed</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">text</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">var</span> <span style="color:#000">save</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Item</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">text</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateRemainingCount</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><p>Ok, so the &ldquo;Remaining Count&rdquo; feature is in two places.
That&rsquo;s manageable.
Unfortunately, to handle completing, we still need to call in from another place in the code inside the Item class.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">// Hypothetical Code -- Don&#39;t type this in
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">completeChecked</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">checked</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">completed</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">checked</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">list</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateRemainingCount</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><p>Now our feature is spread across multiple classes.
And when we add a way to remove items we will need to involve another code-path.
This type of spread out logic is a real challenge for developers.
It is incredibly easy to miss a case.
Most developers are swimming in control flows like this.</p>
<p>But, as we said above, the Behavior Graph implementation combines the remaining count functionality into a single block of code.
Behavior Graph lets us collect the &ldquo;what&rdquo; <em>and</em> the &ldquo;why&rdquo; together in the same behavior.</p>
<h2 id="deleting-items">Deleting Items</h2>
<p>We also have a Delete button on each list item which does nothing currently.
We will fix that now.</p>
<p>Inside <code>ItemExtent</code> we add some button click handling.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>      <span style="color:#000">completed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemEvent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">getStateChange</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">ItemEvent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">SELECTED</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemDelete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addActionListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">actionEvent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#000">list</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">removeItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">itemText</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#ce5c00;font-weight:bold">())</span></span></span></code></pre></div>
<p>This handles a Swing event and updates the <code>removeItem</code> resource on <code>ListExtent</code> (which we haven&rsquo;t added yet).
It is common to interact with resources on other extents.
Here we are saying, &ldquo;this list item is requesting to be removed.&rdquo;</p>
<p>Note that each <code>ItemExtent</code>&rsquo;s Delete button updates the same <code>list.removeItem</code> resource.
We are allowed to update resources from multiple actions because only one action will happen during a single event.</p>
<p>Now, inside <code>ListExtent</code> we add our <code>removeItem</code> resource,</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ArrayList</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">allItems</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ArrayList</span><span style="color:#ce5c00;font-weight:bold">&lt;&gt;());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">TypedMoment</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">removeItem</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">typedMoment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">ListExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Graph</span> <span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">ListUI</span> <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">super</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">);</span></span></span></code></pre></div>
<p>It is a <code>TypedMoment</code> because it models something happening once (a button press) and we want to transmit which <code>ItemExtent</code> we want to remove.</p>
<p>And next we will modify the behavior that maintains <code>allItems</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">removeItem</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">var</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">addChildLifetime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addToGraph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateForce</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addItem</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemUI</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">newItemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setText</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">removeItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">var</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">removeItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">removeFromGraph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">remove</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateForce</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>              <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">removeItem</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemUI</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>First we add <code>removeItem</code> as an additional demand on our <code>allItems</code> behavior.
This causes the behavior to run when a user clicks on a Delete button.</p>
<p>It is common to refer to behaviors by the resources they supply.
This is because a behavior uniquely supplies those resources.
In this case we call this the <code>allItems</code> behavior.</p>
<p>We are modifying this behavior because removing an item affects the list in <code>allItems</code>.
We could not put this logic in another behavior because a resource can only be supplied by one behavior.
Updating a resource can only happen in the one behavior that supplies it.</p>
<p>Inside the runs block we add a new check for <code>removeItem.justUpdated()</code>.
It is a common pattern to iterate through <code>.justUpdated()</code> checks of the various demands to determine what happened.</p>
<p>Then we get the <code>ItemExtent</code> we want removed and remove it from our <code>allItems</code> list.
We need to call <code>.forceUpdate()</code> again because we are mutating the same instance of our list.
Also note that we call<code>.removeFromGraph()</code> on the removed <code>ItemExtent</code>.
Extents should always be removed from the graph if they are no longer needed otherwise their behaviors will continue to run.
Lastly our side effect ensures that the UI updates as well.</p>
<h3 id="remaining-items-re-revisited">Remaining Items Re-revisited</h3>
<p>You may also notice that the remaining items count now goes down if you remove an item that hasn&rsquo;t been completed yet.
We get this for free because we defined the remaining items on the <code>allItems</code> list.
If we were just using method calls to implement delete, we very likely would have removed the item from our list directly and then had to remember to call some <code>updateRemainingCount()</code> which could have easily been forgotten.</p>
<p>This ability to make changes without introducing additional complexity is a hallmark of programming with Behavior Graph.
Once you&rsquo;ve experienced it a few times you will find it difficult to give up.</p>
<h2 id="editing">Editing</h2>
<p>Now we will introduce some editing functionality.
This will cover some additional uses of dynamic behaviors.
We will allow the user to click on a particular todo list item to select it.
While selected, the user can edit the text inside the main text field.</p>
<h3 id="selecting">Selecting</h3>
<p>The first step is to use a Swing event to identify when we have selected a particular item.</p>
<p>Inside <code>ItemExtent</code> add another handler.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemDelete</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addActionListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">actionEvent</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>      <span style="color:#000">list</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">removeItem</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addMouseListener</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">MouseAdapter</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#5c35cc;font-weight:bold">@Override</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">mouseClicked</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">MouseEvent</span> <span style="color:#000">e</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">list</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">updateWithAction</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p><code>selectRequest</code> (which is a resource we haven&rsquo;t yet added on our <code>ListExtent</code>) updates with the list item that was clicked as its <code>.value()</code>. (<code>ItemExtent.this</code> let&rsquo;s us point to the outer <code>this</code>, not the <code>MouseAdapter</code> <code>this</code>.)</p>
<p>Inside <code>ListExtent</code> we add the related resources and a corresponding behavior.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ArrayList</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;&gt;</span> <span style="color:#000">allItems</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ArrayList</span><span style="color:#ce5c00;font-weight:bold">&lt;&gt;());</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">TypedMoment</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">removeItem</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">typedMoment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">TypedMoment</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">selectRequest</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">typedMoment</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>  <span style="color:#000">State</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">selected</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">state</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">);</span></span></span></code></pre></div>
<p>We have two resrouces. <code>selectRequest</code> was the list item we clicked on.
<code>selected</code> is the list item that is currently selected.
<code>null</code> means we have no selected item.</p>
<p>Next we add a behavior that updates <code>selected</code> based on which item we clicked on.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>Clicking on an item sets our new <code>selected</code> resource as the item that was just clicked.
Although we can&rsquo;t tell it is working yet.</p>
<h3 id="selected">Selected</h3>
<p>Now we want our items to visually reflect when they are selected.
We can do this by demanding this resource in a behavior in each item.
Add the following code inside <code>ItemExtent</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>          <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setCompleted</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">completed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">list</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">selected</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">getDidAdd</span><span style="color:#ce5c00;font-weight:bold">())</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">var</span> <span style="color:#000">selected</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">list</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">;</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#000">itemUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSelected</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>      <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>When the <code>selected</code> state resource inside <code>ListExtent</code> updates, this behavior on every item will run.
They each demand <code>list.selected</code>.
Each one will check to see if it is the one selected and we change the UI accordingly.</p>
<p>We want to refer back to the beginning where we called <code>.addChildLifetime(item)</code> inside <code>ListExtent</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemExtent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">save</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">addChildLifetime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">item</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">addToGraph</span><span style="color:#000;font-weight:bold">();</span></span></span></code></pre></div>
<p>This line says that the list will always be around when the item is.
This gives us permission to add <code>list.selected</code>, a resource in <code>ListExtent</code>, as a demand on the behavior inside each <code>ItemExtent</code>.
Behavior Graph ensures that we don&rsquo;t link to resources that may no longer be part of the graph and it uses lifetimes as a way to manage that.</p>
<p>You can now try out this code by clicking on different items.</p>
<p>Notice that we can take a list of many items and click on different ones and watch it switch.
Each time, one of those behaviors calls the Swing UI logic to change the background color.</p>
<h3 id="deselect">Deselect</h3>
<p>Its easy enough to introduce deselecting by clicking on the already selected element.</p>
<p>Inside <code>ListExtent</code> we modify our <code>selected</code> behavior.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>              <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>We check if the currently selected item is the one that was just clicked on and set it to <code>null</code> in that case.
This communicates that nothing should be selected.
Try running now and clicking on an item multiple times.</p>
<p>That was too easy.
You don&rsquo;t need to make space for new control flow.
This is because of the way behavior Behavior Graph functionality composes.</p>
<h3 id="updating-the-text-field">Updating The Text Field</h3>
<p>Now we want to introduce editing.
Let&rsquo;s try updating the main text field when we select an item so we can edit it.
Continuing to edit our <code>selected</code> behavior in <code>ListExtent</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>              <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSelected</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>Whenever <code>selected</code> updates, we run this new side effect.
It copies over the text of the item into the text field.
It also updates the UI to indicate that we are editing and not adding.
Conversely, when <code>selected</code> updates to <code>null</code>, it puts our UI state back to an Add mode.</p>
<p>In many reactive libraries, a reactive block of code can only output the new state.
Any downstream effects need to be somewhere else.
With Behavior Graph we can mutate our state and create any related side effects in the same block of code.</p>
<p>Run the program and you will see how selecting an item updates the header to an editing mode.</p>
<h3 id="preventing-adding">Preventing Adding</h3>
<p>When we are in editing mode, the save button should cause the text in our item to update.
However right now it will still create a new item.
We want to prevent that from happening when we are in editing mode.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">removeItem</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ext</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">traceValue</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">var</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">ItemExtent</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">graph</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">(),</span> <span style="color:#204a87;font-weight:bold">this</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">addChildLifetime</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">addToGraph</span><span style="color:#ce5c00;font-weight:bold">();</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">);</span></span></span></code></pre></div>
<p>At the time we click the Save button, we want to know if we are in editing mode or not.
We could check <code>selected.value()</code> to see if it is null (ie not editing).
However, here we use <code>selected.traceValue()</code> instead.
<code>.traceValue()</code> is the value of the resource <em>at the beginning of the graph event</em> (the instant the action started).
So if <code>selected</code> updates this event, <code>.traceValue()</code> will still return what it was before it changed.</p>
<p>This also removes the requirement that we demand <code>selected</code> in this behavior.
Here we care if an item is &ldquo;already selected&rdquo;, not that something was &ldquo;just selected&rdquo;.
So we don&rsquo;t need it as a demand.
<code>.traceValue()</code> of any resource is always accessible by any behavior without demanding (or supplying) it.</p>
<p>The <code>if</code> check ignores the <code>save</code> click when there&rsquo;s something already selected.</p>
<h3 id="making-changes">Making Changes</h3>
<p>Now we can add a new behavior inside <code>ListExtent</code> that responds to our save and updates the text of the selected item.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">listUI</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">setSelected</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">});</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">dynamicSupplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">new</span> <span style="color:#000">Demandable</span><span style="color:#ce5c00;font-weight:bold">[]</span> <span style="color:#ce5c00;font-weight:bold">{</span> <span style="color:#000">allItems</span> <span style="color:#ce5c00;font-weight:bold">},</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">supplies</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ItemExtent</span> <span style="color:#000">item</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">allItems</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">supplies</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">item</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">itemText</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">})</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">traceValue</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">traceValue</span><span style="color:#ce5c00;font-weight:bold">().</span><span style="color:#c4a000">itemText</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">});</span></span></span></code></pre></div>
<p>This new behavior uses <code>.dyanmicSupplies()</code>.
This is a clause we haven&rsquo;t seen before.
It works similarly to <code>.dynamicDemands()</code>.
In this behavior, we update our supplies to be the <code>itemText</code> resource from each <code>ItemExtent</code> instance.
Whenever we add our remove an item, this behavior will adjust to include or remove the corresponding <code>itemText</code> state resource.</p>
<p>We will supply all of them because any one of them might become selected.
When the user clicks the Save button, this behavior will update the <code>itemText</code> on the selected item to whats inside the text field.</p>
<p>Notice that we use <code>selected.traceValue()</code> again here, so it is not part of the demands.
We want which item was selected at the time <code>save</code> was updated (as opposed to after we&rsquo;re done saving).
We also do not need this behavior to run when <code>selected</code> updates.</p>
<p>Notice that all we do is update <code>itemText</code>.
We already have a behavior that knows how to change that UI when we change the text.
It is common to make these kinds of changes and see everything work as expected.</p>
<p>Run the code and you will see your working todo list.</p>
<h2 id="challenge">Challenge</h2>
<p>After saving our changes, the item remains selected.
It might be a better user experience to exit editing mode after saving.
Can you implement this?</p>
<p>Try your best before looking at the answer.</p>
<p>Hints:</p>
<ol>
<li>You can do this by modifying a single behavior.</li>
<li>Which behavior is responsible for <code>selected</code>?</li>
<li>Which resource updates when we click the Save button?</li>
</ol>
<h3 id="answer-clearing-post-save">Answer: Clearing Post Save</h3>
<p>We can modify our <code>selected</code> behavior inside <code>ListExtent</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#000">behavior</span><span style="color:#ce5c00;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">supplies</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">demands</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">runs</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>              <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selectRequest</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">value</span><span style="color:#ce5c00;font-weight:bold">());</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">save</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>            <span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">update</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">null</span><span style="color:#ce5c00;font-weight:bold">);</span>
</span></span><span style="display:flex; background-color:#dfdfdf"><span>          <span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">selected</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#c4a000">justUpdated</span><span style="color:#ce5c00;font-weight:bold">())</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000">sideEffect</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">ctx1</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">{</span></span></span></code></pre></div>
<p>Now our <code>selected</code> behavior also runs and deselects the current item when the Save button is pressed.
Here see again the common pattern of checking various resources&rsquo; <code>.justUpdated()</code> inside a behavior.</p>
<p>Just before adding this feature we used <code>selected.traceValue</code> in a few behaviors.
This change here is an additional motivation for that.
If we used <code>selected.value</code> in those behaviors it means they would demand <code>selected</code> which is supplied by this behavior.
Which means they would run <em>after</em> this behavior.
Which means by they time they ran, <code>selected.value</code> would be null.
We don&rsquo;t want what <code>selected</code> changes to, we want what it was at the start.
This is what <code>traceValue</code> provides.</p>
<h2 id="congratulations">Congratulations</h2>
<p>Congratulations! You have completed the third tutorial.
You can see the <a href="https://replit.com/@slevin1/Behavior-Graph-JVM-Tutorial-3#Completed/ListExtent.java_completed">finished tutorial code here</a>.</p>

	
	
	
</div>


          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Yahoo All Rights Reserved</small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>


<script src="https://cdn.jsdelivr.net/npm/mermaid@8.13.4/dist/mermaid.min.js" integrity="sha512-JERecFUBbsm75UpkVheAuDOE8NdHjQBrPACfEQYPwvPG+fjgCpHAz1Jw2ci9EXmd3DdfiWth3O3CQvcfEg8gsA==" crossorigin="anonymous"></script>




<script src='/bgdocs/docs/js/tabpane-persist.js'></script>


















<script src="/bgdocs/docs/js/main.min.5502966e44e76d09efb092d4e61f653fa0b492b7bc6e75bab1ce6752810dde8d.js" integrity="sha256-VQKWbkTnbQnvsJLU5h9lP6C0kre8bnW6sc5nUoEN3o0=" crossorigin="anonymous"></script>




  </body>
</html>